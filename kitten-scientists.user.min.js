window.run=function(){const c="V15.97";const u="小猫珂学家版本"+c;const g={zh:{"option.observe":"观测天文现象","option.festival":"举办节日","option.praise":"赞美太阳","option.autofeed":"献祭死灵兽","option.hunt":"派出猎人","option.crypto":"黑币交易","option.embassies":"建造大使馆","option.style":"占满屏幕","option.useWorkers":"启用后台满速珂学家","filter.build":"建筑","filter.craft":"工艺制作","filter.space":"太空相关","filter.upgrade":"工坊升级","filter.research":"科学研究","filter.policy":"政策","filter.upgBld":"营火建筑升级","filter.trade":"贸易","filter.embassy":"大使馆","filter.hunt":"狩猎","filter.praise":"赞美太阳","filter.adore":"赞美群星","filter.transcend":"次元超越","filter.sacrifice":"献祭","filter.faithBld":"太阳教团","filter.accelerate":"光阴似箭","filter.time.skip":"时间跳转","filter.festival":"举办节日","filter.star":"天文现象","filter.distribute":"猫猫分配","filter.leader":"领袖相关","filter.misc":"喵喵喵","dispose.necrocorn":"小猫帮你处理掉了影响效率的多余死灵兽","act.feed":"小猫向利维坦献上祭品。古神很高兴","blackcoin.buy":"小猫花掉 {1} 遗物，加仓了 {0} 黑币","blackcoin.sell":"小猫抛售 {1} 黑币，套现了 {0} 遗物","act.observe":"小猫观测了天文现象{0}","act.hunt":"{0} 波{1}去打猎","act.hunt.unicorn":"小猫急着派出猎人帮独角兽配种，呜呼十连爪ฅ ฅ","act.hunt.trade":"小猫贸易后决定去打猎","act.hunt.mint":"毛皮或羊皮纸处于低储量","act.build":"小猫建造了一个 {0}","act.builds":"小猫建造了 {1} 个新的 {0}","act.craft":" {0} {1}","act.trade":" {1} 交易 {0} 次","upgrade.space.mission":"小猫执行了 {0} 的任务","upgrade.space":"小猫执行了 {0}","upgrade.race":"小猫探险遇到了新的文明：{0}","upgrade.upgrade":"{1}发明了 {0}","upgrade.limited":"优化 {0}","upgrade.unlimited":"全部 {0}","upgrade.tech":"{1}研究了 {0}","upgrade.policy":"小猫通过了 {0} 法案","festival.hold":"呜呼，小猫开趴了","festival.extend":"小猫加了一年钟","build.embassy":"在 {1} 设立了 {0} 个大使馆","build.embassies":"在 {1} 设立了 {0} 个大使馆","act.praise":"赞美太阳! 消耗了 {0} 信仰转化成 {1} 的虔诚","praise.trigger.set":"输入新的赞美太阳的触发值，取值范围为 0 到 1的纯小数\n 当为0.98时且点出太阳革命，若虔诚太少小猫每天赞美太阳","summary.praise.msg":"虔诚的小猫每天都会赞美太阳，直到太阳革命加成大于 {0} %<br>说你了虔诚太低了! (虔诚滚猫咪越滚越虔诚","act.sun.discover":"小猫在宗教祷告了 {0} ","act.sun.discovers":"小猫在宗教祷告了 {0} {1} 次","act.sun.discovers.leader":"哲学家小猫在宗教祷告了 {0} {1} 次","ui.items":"项目","ui.disable.all":"全部禁用","ui.enable.all":"全部启用","ui.craft.resources":"资源","ui.trigger":"触发条件","ui.trigger.set":"输入新的 {0} 触发条件，取值范围为 0 到 1 的小数。\n\n 触发条件：当前触发资源数量 / 触发资源的上限数量\n鼠标移动到该项目名字上能看到触发资源","ui.trigger.resource":"触发资源为","ui.none":"无","ui.limit":"限制","ui.tradeLimit":"AI计算","ui.distributeLimit":"超过MAX","ui.craftLimit":"AI平衡","ui.upgradesLimit":"优选","ui.trigger.filterGame.set":"设置游戏日志数量上限","ui.trigger.missions.set":"输入一个新的 探索星球 触发值,取值范围为 0 到 13 的整数。\n分别对应13颗星球。\n\n默认优先碧池探索，会暂时跳过沙丘","ui.trigger.crypto.set":"输入一个新的 {0} 触发值，\n支持3个参数：-符号隔开数字参数\n第一个数字：当遗物数量大于触发值才会进行黑币交易\n第二个数字：买入的最高价（超过这价格就不会买了）\n第三个数字：卖出最低的价格。（低于这价格就不会卖出）\n默认1000000-881-1060","ui.engine":"启用小猫珂学家","ui.build":"营火","ui.space":"太空","ui.craft":"工艺","ui.upgrade":"升级","ui.trade":"贸易","ui.faith":"宗教","ui.time":"时间","ui.options":"小喵杂项","ui.filter":"日志过滤","ui.distribute":"喵喵管理","ui.max":"Max: {0}","msg.catnip":"如果寒冬猫薄荷产量低于0，连续寒冷的天气，小猫会饿死<br>小猫珂学家会留下过寒冬的猫薄荷","ui.upgrade.upgrades":"工坊升级","ui.upgrade.techs":"科学科技","ui.upgrade.races":"探险者出发!","ui.upgrade.missions":"探索星球","ui.upgrade.buildings":"升级建筑","ui.upgrade.policies":"政策","ui.upgrade.policies.load":"读取","ui.upgrade.policies.show":"列表","ui.faith.addtion":"宗教附加","option.faith.best.unicorn":"自动最佳独角兽建筑","option.faith.best.unicorn.desc":"自动献祭独角兽，并会以独角兽或象牙来决定建造独角兽牧场~象牙塔...太阳尖顶<br>当象牙不足时会切换成象牙模式具体可以点击小猫总结看到(概览还未更新象牙模式)",unicornSacrifice:"小猫让 {0} 个独角兽群返回了天上的维度，收集了 {1} 滴独角兽的眼泪","option.faith.transcend":"自动最佳次元超越","summary.transcend.catnip":"喵喵喵，你也不想次元超越再赞美群星后让小喵饿死吧？（猫薄荷产量将是：{0}）","act.transcend":"消耗 {0} 顿悟，达到次元超越 {1}","summary.transcend":"次元超越了 {0} 次","option.faith.adore":"赞美群星","act.adore":"赞美群星! 消耗了 {0} 虔诚转化成 {1} 顿悟","act.adore.last":"下次小猫赞美群星，会等到虔诚大于 {0} ","summary.adore":"赞美群星了 {0} 次，共积累了 {1} 顿悟","summary.adore.catnip":"喵喵喵，你也不想赞美群星后让小喵饿死吧？（猫薄荷产量将是：{0}）","summary.adore.solar":"聪明的小猫已经会算期望了，当太阳革命加成到达：{0}% 后才会赞美群星","summary.adore.last":"下次赞美群星会等到虔诚大于{0} ","adore.trigger.set":"赞美群星再赞美太阳后的太阳革命加成 ≥ 触发条件 * 1000%，\n触发条件取值范围为 0 到 1 的小数（0.001为自动模式）\n\n同时满足以下条件珂学家将自动赞美群星。\n1. 当前信仰 / 信仰上限 ≥ 0.98(赞美太阳触发条件设置0.98配合使用)\n2.有月球前哨\n3.赞美群星后的猫薄荷产量＞0。\n推荐启用该功能多放几个农民，喵喵保护协会不允许饿死喵喵喵\n优先次元超越 => 赞美群星 => 赞美太阳","resources.add":"添加资源","resources.clear.unused":"清除未使用","resources.stock":"库存: {0}","resources.consume":"消耗率: {0}","resources.del":"删除","resources.stock.set":"设置 {0} 的库存","resources.consume.set":"设置 {0} 的消耗率","resources.del.confirm":"确定要取消 {0} 的库存控制?","status.ks.enable":"神说，要有猫猫珂学家!","status.ks.disable":"太敬业了，该歇了","status.sub.enable":"启用 {0}","status.auto.enable":"启用自动化 {0}","status.sub.disable":"禁用 {0}","status.auto.disable":"禁用自动化 {0}","time.game":"猫珂学家等待游戏处理{0} 毫秒","time.ks":"可爱小喵珂学家一共为你服务了 {0} 次，珂学家处理共耗时 {1} 毫秒，平均耗时 {2} 毫秒","trade.limited":"贸易获得数量大于产量时才与 {0} 贸易，次数自动限制","trade.limitedTitle":"根据产量和贸易获得数量","trade.unlimited":"{1}与 {0} 的 贸易","trade.seasons":"季节","trade.season.enable":"启用在 {1} 与 {0} 的贸易","trade.season.disable":"停止在 {1} 与 {0} 的贸易","trade.catnip":"ฅ'ω'ฅ，你也不想让小喵饿死吧？与鲨鱼贸易喽","filter.enable":"过滤 {0}","filter.disable":"取消过滤 {0}","craft.force":"为了研究{1}，喵喵偷偷拿了资源合成了{0}，呐呐呐，她才不会心痛了","craft.CacheSteel":"小猫急急急，存材料点工坊升级{0}","craft.forceSteel":"小猫为了工坊升级{0}，偷偷用了亿点点材料合成了钢<br>喵喵了?! 喵喵已经逃跑了 ﾚ(ﾟ∀ﾟ;)ﾍ=3=3 !","craft.limited":"平衡{0}（理解为小猫AI控制触发条件、消耗率，挂机效率会比较高）","craft.limitedTitle":"根据原材料和目标材料的数量","craft.unlimited":"触发资源：{1}{0}","distribute.limited":"分配 {0} 的数量不会超过Max","distribute.leaderJob":"领袖工作为 {0} ","distribute.leaderTrait":"领袖的特质为 {0} ","distribute.unlimited":"总Max数量分配完后， {0} 的数量允许超过MAX","distribute.makeLeader":"分配领袖","act.distribute":"抓住一只空闲猫猫分配为 {0}","act.distribute.catnip":"担心你的猫猫没有猫薄荷吸并强制分配到农民","act.distributeLeader":"分配一只 {0} 猫猫领袖","ui.max.set":"设置 {0} 的最大值","summary.distribute":"帮助 {0} 只偷吃猫薄荷的猫猫找到工作","set.leader":"{0}，喵喵喵！","option.promote":"提拔领袖小猫","act.promote":"花费了 {1} 黄金，小猫领袖被提拔到 {0} 级","summary.promote":"提拔领袖 {0} 次","ui.trigger.useWorkers.alert":"比如玩别的游戏或者在干别的事情，浏览器可能会慢10倍的速度运行\n勾选后将会在后台满速运行，注意会导致使用内存增多，性能消耗增加。\n电脑不好、内存< 8G的建议禁用\n推荐过滤全部日志会减少性能的消耗。\n\n需满足浏览器支持且游戏选项的web worker启用。\n确认后会自动重新勾选启用珂学家","ui.timeCtrl":"时间操纵","option.accelerate":"光阴似箭","act.accelerate":"固有时制御，二倍速!","act.accelerate.acl":"抓稳了，猫猫要开始加速了!","act.accelerate.slow":"不行了，猫猫要减速了","act.accelerate.fine":"没关系，{0}已经很厉害了","summary.accelerate":"小猫加速时间 {0} 次","option.time.skip":"时间跳转","act.time.skip":"燃烧时间水晶, 跳过接下来的 {0} 年!","ui.cycles":"周期","ui.maximum":"单次数量","time.skip.cycle.enable":"启用在 {0} 跳转时间并允许跳过该周期","time.skip.cycle.disable":"停止在 {0} 跳转时间并禁止跳过该周期","time.skip.season.enable":"启用在 {0} 跳转时间","time.skip.season.disable":"停止在 {0} 跳转时间","time.skip.trigger.set":"拥有时间水晶数量大于该触发值才会燃烧时间水晶，取值范围为正整数。\n注意会计算时间水晶库存\n周期默认全勾就行，珂学家会自动判断是否停在红月\n每2秒烧水晶次数固定为 0.04x时计炉(无千禧年0.02)，故单次数量进一法就行\n如果资源回复后资源一直是满的，建议过滤大部分日志\n\n故长挂推荐：触发条件200，单次数量1，周期全勾","summary.time.skip":"跳过 {0} 年","option.time.reset":"重启时间线 (弃用)","status.reset.check.enable":"在重启时间线前检查 {0}","status.reset.check.disable":"在重启时间线前不检查 {0}","ui.min":"Min: {0}","reset.check.trigger.set":"为 {0} 设置新的触发值.\n-1 表示必须将此建筑建造至超过资源上限为止","reset.check":"{0} 的触发值: {1}, 现在共有 {2}","reset.checked":"所有条件都已满足，时间线将在几秒后重启!","reset.tip":'你可以通过取消 "启用小猫珂学家" 或 "时间操控" 或 "重启时间线" 以取消此次重启',"reset.countdown.10":"10 - 正在收获猫薄荷","reset.countdown.9":"&nbsp;9 - 正在献祭独角兽","reset.countdown.8":"&nbsp;8 - 正在放生蜥蜴","reset.countdown.7":"&nbsp;7 - 正在拆解电磁炮","reset.countdown.6":"&nbsp;6 - 正在启动时间引擎","reset.countdown.5":"&nbsp;5 - 正在融化黑币","reset.countdown.4":"&nbsp;4 - 正在关闭卫星","reset.countdown.3":"&nbsp;3 - 正在打开时空裂隙","reset.countdown.2":"&nbsp;2 - 正在启动时间锻造","reset.countdown.1":"&nbsp;1 - 时间引擎已启动!","reset.countdown.0":"&nbsp;0 - 时空裂缝已打开!","reset.last.message":"我们下个庞加莱回归再见","reset.after":"初次见面，可爱的猫猫珂学家为您服务","reset.cancel.message":"重启时间线计划取消.","reset.cancel.activity":"喵斯顿，我们有麻烦了.","summary.time.reset.title":"过去 {0} 个时间线的总结","summary.time.reset.content":"获得 {0} 业.<br>获得 {1} 领导力.","ui.close":"关闭","auto.countdown":"{0} 秒后将会自动启用珂学家","auto.tip":'你可以通过取消 "首次自动启用珂学家" 以取消此次自动开启',"option.fix.cry":"修复冷冻仓","act.fix.cry":"小猫修复了 {0} 个冷冻仓","summary.fix.cry":"修复了 {0} 个冷冻仓","summary.auto.academy":"小猫当科学快满了才会继续建造研究院","summary.auto.apocripha":"超越喵喵极限，新约外传才有用捏","summary.auto.aqueduct":"心中无水渠，发展自然神，除非它给的猫薄荷实在太多了","summary.auto.biolab":"小猫为了节省合金发展，轨道测地学前不建造，太空制造前生物实验室优先级降低","summary.auto.bls":"小猫存眼泪准备搅拌这悲伤的液体","summary.auto.biology":"喵喵喵只因你镁有钛，跳过困难的生物学","summary.auto.broadcastTower":"小猫知道你缺钛，等钛上限时才会建造更多的广播塔","summary.auto.caravanserai":"储存黄金为了商队驿站。~打败斑马的第一步","summary.auto.changeLeader":"同时勾选提拔领袖小猫、喵喵管理、分配领袖，小喵服务时自会动切换对应领袖特质，发展会快很多的喵<br>科学和工坊升级换到科学家领袖，比如神学的科学价格变为19K等等","summary.auto.craftCatnip":"呐呐呐，你也不想让寒冬时小喵饿死吧？喵粮上交","summary.auto.craftLimited":"每次运行都会合成工艺(即无视触发条件)，数量AI自动。挂机发展速度会远大于触发条件的。","summary.auto.crossbow":"铁当然是要来用来改良弩，喵用喵说好","summary.auto.defaultPriest":"默认无限制牧师，如需要限制请更改max","summary.auto.drama":"喵力产量低，羊皮纸库存低，聪明的小猫就不勾栏听曲啦","summary.auto.factory":"有了更多钛的后，小猫下次一定造工厂","summary.auto.geologist":"黄金和煤有点缺，就多了亿点点搬砖的地质学家","summary.auto.harbor":"港口需要的金属板太多，小猫会少造亿点点(一定是斑马的阴谋","summary.auto.hunter":"未发明弩和导航学，小猫当猎人欲望降低","summary.auto.ironFactory":"如果钢的合成数量偏少，推荐关闭煅烧炉的自动化","summary.auto.ironwood":"喵喵喵把铁收起来，希望住上向往的铁木小屋","summary.auto.kittens":"计划生育! 猫粮产量不够了 ovo","summary.auto.ksHelp":"为了游戏可玩性，没有给萌新开放过多智能项目，<br>你点珂学家这些按钮没用捏，因为我只是一只猫，自己多点点游戏捏<br>随着猫猫的发展珂学家初始设置好默认配置下会越来越智能快速效率喵","summary.auto.ksHelp2":"如有你特意想点的项目可以在 工艺 => 资源 => 库存,比如重置前要点猫口建筑设置木材 100K,就会永远留100K的木材让你手点","summary.auto.ksHelp3":"不更改默认设置下纯自动大概340年左右 130猫口 + 新约外传","summary.auto.ksHelp4":"小喵选项 => 恢复初始默认配置，可以恢复到初始推荐的配置","summary.auto.lag":"喵喵砖家提示你，燃烧时间水晶：最好不要设置工程师、在挑战页面挂机可以减少卡顿","summary.auto.leader":"喵喵自觉顶替领袖，做特质相关项目。（领袖特质的具体效果可以参考右下角：百科-游戏标签-村庄-猫口普查）","summary.auto.leaderGold":"猫猫领袖贪污点黄金自用","summary.auto.leaderPriest":"已经是成熟的小猫了，该学会好好念经了，领袖职业改为牧师","summary.auto.logHouse":"为了喵喵的幸福，需要更多剧场来上演[所有的狗去天堂]的节目","summary.auto.lower":"未研究轨道测地学，小猫是懂发展的，故降低牧场、水渠、图书馆、研究院、粮仓、港口、油井、仓库的优先度","summary.auto.lumberMill":"喵喵觉得木头已经发展好了，减少木材厂的建造","summary.auto.magnetos":"也许没有石油了导致磁电机自动关机，小猫还是选择打开了它","summary.auto.marker":"没有黑金字塔小猫拒绝了神印的建造","summary.auto.mansion":"小猫为了节省钛和钢用来发展，宅邸优先度降低（2倍多资源）","summary.auto.moonBase":"难得素~男德素存到80%，小猫才会有力气造月球基地","summary.auto.oxidation":"别急，你先别急，小猫为了氧化反应把钢全存起来了","summary.auto.parchment":"还未研究地质学，小猫咪用不了那么多毛皮，毛皮存起来了","summary.auto.pasture":"喵喵喵嫌弃了牧场，木材还是用来发展的好（真的是最后1个了","summary.auto.physics":"艺术猫咪觉得物理学救不了猫咪","summary.auto.railgun":"喵喵想用电磁炮了，就多了亿点点猎人","summary.auto.religion":"大教堂前继续限制神殿和交易所","summary.auto.reinforcedSaw":"用铁给木材厂升级换成加强锯，更加锋利的捏","summary.auto.rotaryKiln":"猫猫看上了<s>回转炉</s>? 减肥旋转滚轮!","summary.auto.sattelite":"小猫足够虔诚，于是会先造卫星回回血","summary.auto.scholar":"科学产量可能有点不够，学者猫咪数量上限增至24~","summary.auto.scienceBld":"天文台、研究院、生物实验室科学上限快满了才会建造","summary.auto.ship":"斑马的屈服第二步，小目标:先制作 {0} 个贸易船<br>⊂(‘ω’⊂ ),斑马拿铁辅料钛","summary.auto.shipGeodesy":"小猫嗅到了黄金的味道喵 ^ ω ^，来点船船抄斑马的家","summary.auto.smelter":"冶炼专精的小猫会根据木材和矿物产量来控制熔炉上限","summary.auto.spaceStation":"黑暗天空会缺电，小猫贴心替你点了关闭空间站","summary.auto.spaceStationStar":"小猫咪再等等亿点点时间就会造空间站了，小猫是懂星图的","summary.auto.spaceTrigger":"小猫发展飞快，把星图留给探索碧池星","summary.auto.steamworks":"小猫曰：蒸汽工房要与磁电机成双成对","summary.auto.steelAxe":"存着钢换个喵喵自用的精钢斧","summary.auto.steelSaw":"小喵存着钢给木材厂换精钢锯，更加锋利了喵","summary.auto.templars":"没有足够的黄金和铁产量拿什么祷告圣殿骑士呢","summary.auto.temple":"祷告太阳革命后才会建造神殿，真的不是偷懒喵","summary.auto.titaniumGeodesy":"小猫打败斑马的最后一步，存着钛点测地学。","summary.auto.tradepost":"祷告太阳革命前，交易所的建设开摆","summary.auto.tear":"小喵都做了什么?! 独角兽的眼泪加小猫幸福度的捏","summary.auto.unicorn":"最佳独角兽建筑：{0}","summary.auto.upgPasture":"当勾选太阳能发电站了，并钛爆仓、且缺电、且猫薄荷产量足够高时，小猫会贴心的帮你卖出全部牧场后，升级太阳能发电站!","summary.auto.upgAqueduct":"当勾选水电站了，有太阳能发电站、且缺电、且猫薄荷产量足够高时，小猫会贴心的帮你卖出全部水渠后，升级水电站!","summary.auto.upgLibrary":"当勾选数据中心了，概要数量大于 150X图书馆数量 时，小猫会贴心的帮你卖出全部图书馆后，升级数据中心!","summary.auto.upgAmphitheatre":"当有贸易船或者钛产量足够高时，小猫会贴心的帮你卖出全部剧场后，升级广播塔!","summary.auto.workshop":"工坊只是解锁升级的 猫玩具罢了，现在小猫只愿意造1个工坊哦","summary.auto.debug":"{0}","summary.upgrade.building.pasture":"卖出牧场 并升级为 太阳能发电站 !","summary.upgrade.building.aqueduct":"卖出水渠 并升级为 水电站 !","summary.upgrade.building.library":"卖出图书馆 并升级为 数据中心!","summary.upgrade.building.amphitheatre":"卖出剧场 并升级为 广播塔!","summary.resource":"小猫自动调整资源: {0} 的消耗率","summary.moon":"小猫停在红月周期散热 {0} 次","summary.time.skip.moon":"由于燃烧时间水晶支出大于收入，停留在红月周期 {0} 次! (可以获得更多的难得素)","summary.blackcoin.buy":"小猫出售遗物并买入 {0} 次黑币","summary.blackcoin.sell":"小猫出售黑币并买入了 {0} 次遗物","summary.accelerator":"电量寄了，大概只有加速器能关闭了（不会影响库存","summary.catnip":"呐，你的猫猫没有猫薄荷吸并强制分配 {0} 个农民","summary.calciner":"小猫因为你工坊升级了钢铁工厂，故关闭了煅烧炉自动化（其效果铁和煤转化钢没有100%~具体右下角参考百科）（她真的好温柔，😭）","summary.mint":"秋梨膏别开铸币厂了（其转化效率与喵力上限有关，打猎会获得更多的毛皮，具体右下角参考百科 游戏标签-其它建筑-铸币厂，）","summary.pumpjack":"小猫担心冬季电不够并关闭了 {0} 次油井自动化","summary.biolab":"小猫担心冬季电不够并关闭了 {0} 个生物实验室(关了后科学上限和科学加成还会加成)","summary.biolab.test":" {0} 个生物实验室(非常没用的工坊升级)","summary.temporalAccelerator":"小猫担心卡顿打开了时空加速器的自动化","summary.reactor":"小猫向反应堆投入了铀开始发光呐，资源产量变多了","summary.factory":"小猫为了空间的发展，把工厂全部启用呐","summary.steamworks":"小猫向蒸汽工房加了煤开始排蒸汽呐，资源产量变多了","summary.breweryOn":"已举办文化节，喵星人重新打开了酿酒厂~嗝","summary.breweryOff":"节日或者香料没呐，小猫拒奢守俭，暂时关闭了酿酒厂","summary.brewery":"小猫根据节日调整了 {0} 次酿酒厂","summary.chronocontrolOn":"小猫开启了时间操纵延长时间悖论的持续天数","summary.chronocontrolOff":"小猫关闭了时间操纵节省电力","summary.chronocontrol":"小猫根据时间悖论调整了 {0} 次时间操纵","summary.festival":"举办了 {0} 次节日","summary.stars":"观测了 {0} 次天文事件","summary.praise":"赞美太阳了 {0} 次，共积累了 {1} 虔诚","summary.hunt":"派出了 {0} 批可爱的小猫","summary.hunt.manager":"管理者领袖派出了 {0} 批可爱的小猫","summary.embassy":"设立了 {0} 个大使馆","summary.feed":"向利维坦献祭 {0} 只死灵兽","summary.tech":"{0}","summary.upgrade":"{0}","summary.build":"建造了 {0} 个 {1}","summary.faith":"{1} {0} 次","summary.craft":"制作了{0} 个 {1}","summary.craftLeader":"工匠制作了 {0} 个 {1}","summary.craftManuscript":"小猫偷偷使用了 {0} 次材料合成手稿，为了科学","summary.craftCompedium":"小猫偷偷使用了 {0} 次材料合成概要，为了科学","summary.craftBlueprint":"小猫偷偷使用了 {0} 次材料合成蓝图，为了科学","summary.trade":"{1} 贸易了 {0} 次","summary.year":"年","summary.years":"年","summary.separator":" ","summary.day":"天","summary.days":"天","summary.head":"你醒啦，看看你的猫国过去 {0} 的总结","summary.show":"小猫总结"}};const te=function(e,t){if(e[0]==="$"){return $I(e.slice(1))}let a=g["zh"][e];if(typeof a==="undefined"){if(!ce("debug")){game.msg(e)}}if(t){for(let e=0;e<t.length;e++){a=a.replace("{"+e+"}",t[e])}}return a};const ae={debug:false,interval:2e3,msgcolor:"#aa50fe",summarycolor:"#009933",activitycolor:"#E65C00",stockwarncolor:"#DD1E00",copyTrait:false,countdown:120,renderTime:0,consume:.6,auto:{engine:{enabled:false},unicorn:{items:{unicornPasture:{require:false,enabled:true,variant:"zp",label:te("$buildings.unicornPasture.label"),checkForReset:true,triggerForReset:-1},unicornTomb:{require:false,enabled:true,variant:"z",label:te("$religion.zu.unicornTomb.label"),checkForReset:true,triggerForReset:-1},ivoryTower:{require:false,enabled:true,variant:"z",label:te("$religion.zu.ivoryTower.label"),checkForReset:true,triggerForReset:-1},ivoryCitadel:{require:false,enabled:true,variant:"z",label:te("$religion.zu.ivoryCitadel.label"),checkForReset:true,triggerForReset:-1},skyPalace:{require:false,enabled:true,variant:"z",label:te("$religion.zu.skyPalace.label"),checkForReset:true,triggerForReset:-1},unicornUtopia:{require:"gold",enabled:true,variant:"z",label:te("$religion.zu.unicornUtopia.label"),checkForReset:true,triggerForReset:-1},sunspire:{require:"gold",enabled:true,variant:"z",label:te("$religion.zu.sunspire.label"),checkForReset:true,triggerForReset:-1}}},faith:{enabled:false,trigger:0,transcendCatnip:0,adoreCatnip:0,addition:{bestUnicornBuilding:{enabled:true,misc:true,label:te("option.faith.best.unicorn"),confirm:0},autoPraise:{enabled:true,misc:true,label:te("option.praise"),subTrigger:.98,msg:0,time:0,expect:0},adore:{enabled:true,misc:true,label:te("option.faith.adore"),subTrigger:.001},transcend:{enabled:true,misc:true,label:te("option.faith.transcend")}},items:{marker:{require:"unobtainium",enabled:false,max:-1,variant:"z",checkForReset:true,triggerForReset:-1},unicornGraveyard:{require:false,enabled:false,max:-1,variant:"z",checkForReset:true,triggerForReset:-1},unicornNecropolis:{require:false,enabled:false,max:-1,variant:"z",checkForReset:true,triggerForReset:-1},blackPyramid:{require:"unobtainium",enabled:true,max:-1,variant:"z",checkForReset:true,triggerForReset:-1},solarchant:{require:"faith",enabled:true,max:-1,variant:"s",checkForReset:true,triggerForReset:-1},scholasticism:{require:"faith",enabled:true,max:3,variant:"s",checkForReset:true,triggerForReset:-1},goldenSpire:{require:"faith",enabled:true,max:-1,variant:"s",checkForReset:true,triggerForReset:-1},sunAltar:{require:"faith",enabled:true,max:-1,variant:"s",checkForReset:true,triggerForReset:-1},stainedGlass:{require:"faith",enabled:true,max:1,variant:"s",checkForReset:true,triggerForReset:-1},solarRevolution:{require:"faith",enabled:true,max:1,variant:"s",checkForReset:true,triggerForReset:-1},basilica:{require:"faith",enabled:true,max:5,variant:"s",checkForReset:true,triggerForReset:-1},templars:{require:"faith",enabled:true,max:6,variant:"s",checkForReset:true,triggerForReset:-1},apocripha:{require:"faith",enabled:true,max:1,variant:"s",checkForReset:true,triggerForReset:-1},transcendence:{require:"faith",enabled:true,max:1,variant:"s",checkForReset:true,triggerForReset:-1},blackObelisk:{require:false,enabled:false,max:-1,variant:"c",checkForReset:true,triggerForReset:-1},blackNexus:{require:false,enabled:false,max:-1,variant:"c",checkForReset:true,triggerForReset:-1},blackCore:{require:false,enabled:false,max:-1,variant:"c",checkForReset:true,triggerForReset:-1},singularity:{require:false,enabled:false,max:-1,variant:"c",checkForReset:true,triggerForReset:-1},blackLibrary:{require:false,enabled:false,max:-1,variant:"c",checkForReset:true,triggerForReset:-1},blackRadiance:{require:false,enabled:false,max:-1,variant:"c",checkForReset:true,triggerForReset:-1},blazar:{require:false,enabled:false,max:-1,variant:"c",checkForReset:true,triggerForReset:-1},darkNova:{require:false,enabled:false,max:-1,variant:"c",checkForReset:true,triggerForReset:-1},holyGenocide:{require:false,enabled:false,max:-1,variant:"c",checkForReset:true,triggerForReset:-1}}},build:{enabled:false,trigger:0,items:{field:{require:"catnip",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},workshop:{require:"minerals",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},hut:{require:"wood",enabled:false,max:-1,checkForReset:true,triggerForReset:-1},logHouse:{require:"minerals",enabled:false,max:-1,checkForReset:true,triggerForReset:-1},mansion:{require:"titanium",enabled:false,max:-1,checkForReset:true,triggerForReset:-1},steamworks:{require:false,enabled:true,max:-1,checkForReset:true,triggerForReset:-1},magneto:{require:false,enabled:true,max:-1,checkForReset:true,triggerForReset:-1},reactor:{require:"titanium",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},smelter:{require:"minerals",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},calciner:{require:"titanium",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},mine:{require:"wood",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},lumberMill:{require:"minerals",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},oilWell:{require:"coal",enabled:true,max:200,checkForReset:true,triggerForReset:-1},factory:{require:"titanium",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},observatory:{require:"iron",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},biolab:{require:"science",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},library:{require:"wood",enabled:true,max:-1,stage:0,checkForReset:true,triggerForReset:-1},dataCenter:{require:false,enabled:true,max:150,stage:1,name:"library",checkForReset:true,triggerForReset:-1},academy:{require:"wood",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},pasture:{require:"catnip",enabled:true,max:150,stage:0,checkForReset:true,triggerForReset:-1},solarFarm:{require:"titanium",enabled:true,max:-1,stage:1,name:"pasture",checkForReset:true,triggerForReset:-1},aqueduct:{require:"minerals",enabled:true,max:250,stage:0,checkForReset:true,triggerForReset:-1},hydroPlant:{require:"titanium",enabled:true,max:-1,stage:1,name:"aqueduct",checkForReset:true,triggerForReset:-1},amphitheatre:{require:"minerals",enabled:true,max:60,stage:0,checkForReset:true,triggerForReset:-1},broadcastTower:{require:"titanium",enabled:true,max:-1,stage:1,name:"amphitheatre",checkForReset:true,triggerForReset:-1},quarry:{require:false,enabled:true,max:300,checkForReset:true,triggerForReset:-1},chapel:{require:"minerals",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},temple:{require:"gold",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},mint:{require:"gold",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},tradepost:{require:"gold",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},ziggurat:{require:false,enabled:true,max:110,checkForReset:true,triggerForReset:-1},chronosphere:{require:"unobtainium",enabled:false,max:-1,checkForReset:true,triggerForReset:-1},aiCore:{require:false,enabled:false,max:-1,checkForReset:true,triggerForReset:-1},brewery:{require:false,enabled:true,max:-1,checkForReset:true,triggerForReset:-1},barn:{require:"wood",enabled:true,max:15,checkForReset:true,triggerForReset:-1},harbor:{require:false,enabled:true,max:200,checkForReset:true,triggerForReset:-1},warehouse:{require:false,enabled:true,max:200,checkForReset:true,triggerForReset:-1},accelerator:{require:"titanium",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},zebraOutpost:{require:"bloodstone",enabled:false,max:-1,checkForReset:true,triggerForReset:-1},zebraWorkshop:{require:"bloodstone",enabled:false,max:-1,checkForReset:true,triggerForReset:-1},zebraForge:{require:"bloodstone",enabled:false,max:-1,checkForReset:true,triggerForReset:-1}}},space:{enabled:false,trigger:0,items:{spaceElevator:{require:"unobtainium",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},sattelite:{require:"titanium",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},spaceStation:{require:"oil",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},moonOutpost:{require:"uranium",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},moonBase:{require:"unobtainium",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},planetCracker:{require:"science",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},hydrofracturer:{require:"science",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},spiceRefinery:{require:"science",enabled:false,max:-1,checkForReset:true,triggerForReset:-1},researchVessel:{require:"titanium",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},orbitalArray:{require:"science",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},sunlifter:{require:"science",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},containmentChamber:{require:"science",enabled:false,max:-1,checkForReset:true,triggerForReset:-1},heatsink:{require:false,enabled:false,max:-1,checkForReset:true,triggerForReset:-1},sunforge:{require:false,enabled:false,max:-1,checkForReset:true,triggerForReset:-1},cryostation:{require:"eludium",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},spaceBeacon:{require:"antimatter",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},terraformingStation:{require:"antimatter",enabled:false,max:-1,checkForReset:true,triggerForReset:-1},hydroponics:{require:"kerosene",enabled:false,max:-1,checkForReset:true,triggerForReset:-1},hrHarvester:{require:"antimatter",enabled:false,max:-1,checkForReset:true,triggerForReset:-1},entangler:{require:"antimatter",enabled:true,max:-1,checkForReset:true,triggerForReset:-1},tectonic:{require:"antimatter",enabled:false,max:-1,checkForReset:true,triggerForReset:-1},moltenCore:{require:"uranium",enabled:false,max:-1,checkForReset:true,triggerForReset:-1}}},time:{enabled:false,trigger:0,items:{temporalBattery:{require:false,enabled:false,max:0,variant:"chrono",checkForReset:true,triggerForReset:-1},blastFurnace:{require:false,enabled:false,max:-1,variant:"chrono",checkForReset:true,triggerForReset:-1},timeBoiler:{require:false,enabled:false,max:-1,variant:"chrono",checkForReset:true,triggerForReset:-1},temporalAccelerator:{require:false,enabled:false,max:1,variant:"chrono",checkForReset:true,triggerForReset:-1},temporalImpedance:{require:false,enabled:false,max:-1,variant:"chrono",checkForReset:true,triggerForReset:-1},ressourceRetrieval:{require:false,enabled:false,max:-1,variant:"chrono",checkForReset:true,triggerForReset:-1},temporalPress:{require:false,enabled:false,max:0,variant:"chrono",checkForReset:true,triggerForReset:-1},cryochambers:{require:false,enabled:false,max:-1,variant:"void",checkForReset:true,triggerForReset:-1},voidHoover:{require:"antimatter",enabled:false,max:-1,variant:"void",checkForReset:true,triggerForReset:-1},voidRift:{require:false,enabled:false,max:-1,variant:"void",checkForReset:true,triggerForReset:-1},chronocontrol:{require:"temporalFlux",enabled:false,max:-1,variant:"void",checkForReset:true,triggerForReset:-1},voidResonator:{require:false,enabled:false,max:-1,variant:"void",checkForReset:true,triggerForReset:-1}}},timeCtrl:{enabled:false,items:{accelerateTime:{enabled:true,subTrigger:1,misc:true,label:te("option.accelerate")},timeSkip:{enabled:true,subTrigger:200,misc:true,label:te("option.time.skip"),maximum:1,0:true,1:true,2:true,3:true,4:true,5:true,6:true,7:true,8:true,9:true,spring:true,summer:false,autumn:false,winter:false,wait:false,adore:false,craft:false,moonMsg:-1}}},craft:{enabled:false,trigger:.95,shipTime:0,items:{wood:{require:"catnip",max:0,limited:true,limRat:.5,enabled:true},beam:{require:"wood",max:0,limited:true,limRat:.5,enabled:true},slab:{require:"minerals",max:0,limited:true,limRat:.5,enabled:true},steel:{require:"coal",max:0,limited:true,limRat:.5,enabled:true},plate:{require:"iron",max:0,limited:true,limRat:.5,enabled:true},alloy:{require:"titanium",max:0,limited:true,limRat:.5,enabled:true},concrate:{require:false,max:0,limited:true,limRat:.5,enabled:true},gear:{require:false,max:0,limited:true,limRat:.5,enabled:true},scaffold:{require:false,max:0,limited:true,limRat:.5,enabled:true},ship:{require:false,max:0,limited:true,limRat:.5,enabled:true},tanker:{require:false,max:0,limited:true,limRat:.5,enabled:false},parchment:{require:false,max:0,limited:false,limRat:.5,enabled:true},manuscript:{require:"culture",max:0,limited:true,limRat:.5,enabled:true},compedium:{require:"science",max:0,limited:true,limRat:.5,enabled:true},blueprint:{require:"science",max:0,limited:true,limRat:.5,enabled:true},kerosene:{require:"oil",max:0,limited:true,limRat:.5,enabled:true},megalith:{require:false,max:0,limited:true,limRat:.5,enabled:true},eludium:{require:"unobtainium",max:0,limited:true,limRat:.5,enabled:true},thorium:{require:"uranium",max:0,limited:true,limRat:.5,enabled:true}},autoConsume:{}},trade:{cache:false,enabled:false,trigger:.98,items:{dragons:{enabled:true,require:"titanium",allowCapped:false,limited:true,summer:false,autumn:true,winter:true,spring:true},zebras:{enabled:true,require:false,allowCapped:false,limited:true,summer:true,autumn:true,winter:true,spring:true},lizards:{enabled:false,require:"minerals",allowCapped:false,limited:true,summer:true,autumn:false,winter:false,spring:false},sharks:{enabled:true,require:"iron",allowCapped:false,limited:true,summer:false,autumn:false,winter:true,spring:false},griffins:{enabled:true,require:"wood",allowCapped:false,limited:true,summer:false,autumn:true,winter:false,spring:false},nagas:{enabled:true,require:false,allowCapped:false,limited:true,summer:false,autumn:false,winter:false,spring:true},spiders:{enabled:true,require:false,allowCapped:false,limited:true,summer:true,autumn:true,winter:true,spring:true},leviathans:{enabled:true,require:"unobtainium",allowCapped:true,limited:true,summer:true,autumn:true,winter:true,spring:true}}},upgrade:{enabled:false,items:{techs:{enabled:true,limited:true},upgrades:{enabled:true,limited:true,cache:false},policies:{enabled:false},races:{enabled:true},missions:{enabled:true,subTrigger:4},buildings:{enabled:true}}},options:{catnipMsg:0,enabled:true,items:{style:{enabled:true,misc:true,label:te("option.style")},hunt:{enabled:true,subTrigger:.95,require:"manpower",misc:true,label:te("option.hunt")},buildEmbassies:{enabled:true,subTrigger:.95,require:"culture",misc:true,label:te("option.embassies")},festival:{enabled:true,misc:true,label:te("option.festival")},promote:{enabled:true,misc:true,label:te("option.promote")},autofeed:{enabled:true,misc:true,label:te("option.autofeed")},observe:{enabled:true,misc:true,label:te("option.observe")},filterGame:{enabled:true,subTrigger:200,misc:true,label:"游戏日志过滤"},crypto:{enabled:false,subTrigger:1e6,misc:true,label:te("option.crypto")},fixCry:{enabled:false,misc:true,label:te("option.fix.cry")},saves:{enabled:false,misc:true,label:"导出配置文件"},donate:{enabled:false,misc:true,label:"显示捐赠原作者图标"},useWorkers:{enabled:false,misc:true,label:te("option.useWorkers")},wiki:{enabled:false,misc:true,label:"珂学家使用说明书（百科链接🐱）"},autoScientists:{enabled:false,misc:true,label:"首次自动启用珂学家"}}},distribute:{religion:false,enabled:false,items:{woodcutter:{enabled:true,max:28,limited:true},farmer:{enabled:true,max:1,limited:true},scholar:{enabled:true,max:9,limited:true},hunter:{enabled:true,max:24,limited:true},miner:{enabled:true,max:25,limited:true},priest:{enabled:true,max:3,limited:false},geologist:{enabled:true,max:40,limited:true},leader:{enabled:true,leaderJob:"woodcutter",leaderTrait:"manager"}}},filter:{enabled:true,console:{},items:{buildFilter:{enabled:false,label:te("filter.build")},researchFilter:{enabled:false,label:te("filter.research")},upgradeFilter:{enabled:false,label:te("filter.upgrade")},craftFilter:{enabled:false,label:te("filter.craft")},spaceFilter:{enabled:false,label:te("filter.space")},policyFilter:{enabled:false,label:te("filter.policy")},upgBldFilter:{enabled:false,label:te("filter.upgBld")},tradeFilter:{enabled:false,label:te("filter.trade")},embassyFilter:{enabled:false,label:te("filter.embassy")},huntFilter:{enabled:false,label:te("filter.hunt")},unicornSacrificeFilter:{enabled:false,label:te("filter.sacrifice")},faithBuildFilter:{enabled:false,label:te("filter.faithBld")},faithFilter:{enabled:false,label:te("filter.praise")},adoreFilter:{enabled:false,label:te("filter.adore")},transcendFilter:{enabled:false,label:te("filter.transcend")},accelerateFilter:{enabled:false,label:te("filter.accelerate")},tcShatterFilter:{enabled:false,label:te("filter.time.skip")},festivalFilter:{enabled:false,label:te("filter.festival")},astronomicalEventFilter:{enabled:false,label:te("filter.star")},distributeFilter:{enabled:false,label:te("filter.distribute")},leaderFilter:{enabled:false,label:te("filter.leader")},miscFilter:{enabled:false,label:te("filter.misc")}}},resources:{furs:{enabled:true,stock:350,checkForReset:false,stockForReset:Infinity},coal:{enabled:true,stock:0,consume:1},timeCrystal:{enabled:false,stock:0,checkForReset:true,stockForReset:5e5}},policies:[],cache:{dataTimer:{},cacheSum:{},resources:{},trait:{},upgrade:undefined,science:"",resUpg:{},stocks:undefined}}};let ie=game.resPool.resourceMap;const re=function(e){let t=e[1];let a=ae.auto.filter;if(a.enabled&&t){let e=a.items[t];if(e&&e.enabled){return}}const i=e.pop();e[1]=e[1]||"ks-default";let r=game.msg.apply(game,e);$(r.span).css("color",i);if(ae.debug&&console){console.log(e)}};const r=function(){let e=Array.prototype.slice.call(arguments);e.push("ks-default");e.push(ae.msgcolor);re(e)};const le=function(){let e=Array.prototype.slice.call(arguments);let t=e.length>1?e.pop():"miscFilter";e.push(t);e.push(ae.activitycolor);re(e)};const p=function(){const e=Array.prototype.slice.call(arguments);e.push("ks-summary");e.push(ae.summarycolor);re(e)};const l=function(){const e=Array.prototype.slice.call(arguments);e.unshift("Warning!");if(console){console.log(e)}};const B=function(e,t,a){r(te(e,t),a)};const se=function(e,t,a){le(te(e,t),a)};const h=function(e,t,a){p(te(e,t),a)};const E=t=>{let e=ae.auto.cache;if(!e.upgrade){e.upgrade={}}let r=e.upgrade;for(let e in t){let a=t[e];if(!r[e]){r[e]=[]}let i=r[e];for(let t in a){let e=a[t];if(i.indexOf(e)===-1){i.push(e)}}}};let ne=e=>{let t=ie[e];return t.value/t.maxValue};let oe=game.religion;let X=game.workshop;const m=function(){this.upgradeManager=new d;this.buildManager=new V;this.spaceManager=new q;this.craftManager=new t;this.bulkManager=new a;this.tradeManager=new f;this.religionManager=new C;this.timeManager=new S;this.villageManager=new e("Village");this.cacheManager=new b};m.prototype={upgradeManager:undefined,buildManager:undefined,spaceManager:undefined,craftManager:undefined,bulkManager:undefined,tradeManager:undefined,religionManager:undefined,timeManager:undefined,villageManager:undefined,cacheManager:undefined,now:undefined,loop:undefined,huntID:undefined,renderID:undefined,worker:undefined,toolText:undefined,leaderTimer:undefined,leader:0,accelerateTime:0,time:undefined,start:function(e=true){ae.interval=Math.ceil(100/game.getTicksPerSecondUI())*100;if(game.isWebWorkerSupported()&&game.useWorkers&&ae.auto.options.items.useWorkers.enabled){if(this.worker){return}const t=new Blob(["onmessage = function(e) { setInterval(function() {postMessage('miaowu')}, '"+ae.interval+"' ); }"]);const a=window.URL.createObjectURL(t);this.worker=new Worker(a);this.worker.addEventListener("message",this.iterate.bind(this));this.worker.postMessage("miaowu");if(e){r("后台珂学家上钟了~ ＞▽＜")}}else{if(this.loop){return}this.loop=setInterval(this.iterate.bind(this),ae.interval);if(e){B("status.ks.enable")}}},stop:function(e=true){if(game.isWebWorkerSupported()&&this.worker){if(e){r("后台珂学家爪巴了")}this.worker.terminate();this.worker=undefined}if(!this.loop){return}clearTimeout(this.huntID);clearTimeout(this.renderID);clearInterval(this.loop);this.loop=undefined;if(e){B("status.ks.disable")}},iterate:async function(){if(!game.mobileSaveOnPause||game.loadingSave||game.isPaused){return}let e=0;this.time=performance.now();let t=ae.auto;let a=t.options;let i=a.enabled;let r=a.items;if(i&&r.observe.enabled){this.observeStars()}if(i){this.holdFestival()}if(t.timeCtrl.enabled){e+=~~this.timeCtrl()}if(i&&r.autofeed.enabled){this.autofeed()}if(i&&r.promote.enabled){this.promote()}if(t.trade.enabled){this.trade()}if(t.upgrade.enabled){e+=~~this.upgrade()}if(t.build.enabled){e+=~~this.build()}if(t.space.enabled){e+=~~this.space()}if(t.faith.enabled){e+=~~this.worship()}if(e>0||t.cache.upgrade){this.gameUpgrade()}if(t.craft.enabled){this.craft()}if(i&&r.hunt.enabled){this.delay()}if(t.time.enabled){e+=~~this.chrono()}if(i&&r.crypto.enabled){this.crypto()}if(ae.copyTrait){this.setTrait()}if(i){e+=~~this.miscOptions()}if(t.distribute.enabled){e+=~~this.distribute()}if(e>0){this.delay("render")}this.calculateTime()},delay:function(e){if(e){let e=dojo.byId("tooltip").textContent;e=e.slice(0,Math.ceil(e.length*.4));if(ae.renderTime+6e5<Date.now()||this.toolText!==e){this.renderID=setTimeout(()=>{if(game.ui.activeTabId==="Nummon"){return}ae.renderTime=Date.now();this.toolText=e;game.ui.render()},Math.min(197,197-Date.now()+game.timer.timestampStart))}game.updateResources()}else{this.huntID=setTimeout(()=>{this.hunt()},ae.interval*.5)}},reset:async function(){},timeCtrl:function(){const v=ae.auto.timeCtrl.items;let k=0;if(v.accelerateTime.enabled&&game.science.get("calendar").researched){const e=ie["temporalFlux"];if(e.value>=Math.max(e.maxValue*v.accelerateTime.subTrigger,5)&&!game.time.isAccelerated){game.time.isAccelerated=true;this.accelerateTime=performance.now();se("act.accelerate",[],"accelerateFilter");ge("accelerate",1)}if(ae.interval!==Math.ceil(100/game.getTicksPerSecondUI())*100){O.stop(false);if(ae.auto.engine.enabled){if(ae.interval===2e3){se("act.accelerate.acl");this.accelerateTime=performance.now()}else{let a=this.accelerateTime;if(a){let e=(performance.now()-a)/1e3;let t=game.toDisplaySeconds(e);if(t&&e<61){t=t.substring(0,t.length-1);let e=game.msg(te("act.accelerate.fine",[t]),null,null,true);$(e.span).css("color","#ff589c")}this.accelerateTime=0}se("act.accelerate.slow")}O.start(false)}}}e:if(v.timeSkip.enabled&&game.workshop.get("chronoforge").researched){let a=ie["timeCrystal"].value;let t=v.timeSkip.maximum;const y=game.getEffect("heatMax");let e=game.time.heat;if(!t){return 0}let i=game.challenges.getChallenge("1000Years").researched?5:10;if(e-15*game.getEffect("heatPerTick")<.9*y){let e=50/i*game.getEffect("heatPerTick")/game.getTicksPerSecondUI();if(e>3){e=50}t=Math.ceil(Math.max(e,t))}const x=v.timeSkip.subTrigger;let r=Math.max(x,this.craftManager.getStock("timeCrystal"),t);const R=game.calendar.cycle;const w=game.calendar.year;const T=game.calendar.day;if(a<r||T<0||!v.timeSkip[R]||e>=y){break e}let l=game.prestige.getPerk("numerology").researched;if(R===5&&v.timeSkip[R]&&l&&game["nummon"]){let e=game["nummon"]["getTradeTC"]();let t=game.calendar.cycleEffectsFestival({unobtainium:1})["unobtainium"];let a=game.calendar.cycleEffectsBasics({unobtainiumPerTickSpace:1},"moonOutpost")["unobtainiumPerTickSpace"];let i=(56.5+12*game.getEffect("festivalRatio"))/50;let r=game.calendar.cycleYear;let l=e*i/(t*a);if(l<1||game.getEffect("heatPerTick")<.02){if(r!==v.timeSkip.moonMsg){v.timeSkip.moonMsg=r;se("summary.time.skip.moon",[1]);ge("time.skip.moon",1)}break e}}let s=game["timeTab"].cfPanel.children[0].children[0];if(!s.model.enabled){return s.controller.updateEnabled(s.model)}let n=game.calendar.season;let o=v.timeSkip.wait;let c=game.getEffect("shatterTCGain")*(1+game.getEffect("rrRatio"))<=1&&o!==false&&R===5;if(!v.timeSkip[game.calendar.seasons[n].name]||c){if(o===1&&R===5){v.timeSkip.wait=game.calendar.year;break e}else if(o===false||o===w||o===1){break e}else if(o!==w){v.timeSkip.wait=false}}let u=4*t*i;let g=game.time.heat>game.getEffect("heatMax")-Math.min(u,20*game.time.getCFU("blastFurnace").on+20);let m=v.timeSkip[5];if(m&&l&&v.timeSkip.wait===false&&g){v.timeSkip.wait=1;if(R===5){se("summary.moon",[1]);ge("moon",1)}}let d=game.calendar.yearsPerCycle;let f=d-game.calendar.cycleYear;let p=game.calendar.cyclesPerEra;let h=Math.min(Math.floor((y-e)/i),t);let b=0;if(h<f){b=h}else{b+=f;h-=f;let e=1;while(h>d&&v.timeSkip[(R+e)%p]){b+=d;h-=d;e+=1}if(v.timeSkip[(R+e)%p]&&h>0){b+=h}}if(b>0){b=Math.min(b,Math.max(2500,game.getEffect("temporalPressCap")*25));if(game.time.getCFU("ressourceRetrieval").val){v.timeSkip.adore=true;ae.auto.options.items.hunt.time=true;let e=v.timeSkip;if(!e.craft){const E=["catnip","coal","iron","oil","uranium","science"];let t="";E.forEach(e=>{ae.auto.craft.autoConsume[e]=true;t=t+ie[e].title+"，"});e.craft=true;le(te("summary.resource",[t]))}}let e=game.calendar.year;let t=game.time.testShatter;if(b>1&&b<50){game.time.testShatter=2;ce("lag",false,"noFilter")}this.setTrait();s.controller.doShatterAmt(s.model,b);game.time.testShatter=t;b=game.calendar.year-e;if(!b){return}ge("timeCrystal",a-ie["timeCrystal"].value,"resConsume");k=-100;se("act.time.skip",[b],"tcShatterFilter");ge("time.skip",b)}}return k},promote:function(){let r=game.village;let l=r.leader;if(l){let e=ae.auto.distribute;let t=e.items.leader;let i=this.leaderTimer>600;if(t.enabled&&l.trait.name===t.leaderTrait||i){if(!i){l.exp+=.15+5*game.getEffect("skillXP")}let t=l.rank||0;let e=this.craftManager.getStock("gold");let a=ie["gold"].value-e;if(t>=this.leader&&r.sim.expToPromote(t,t+1,l.exp)[0]){if(r.sim.goldToPromote(t,t+1,a)[0]){if(r.sim.promote(l,t+1)===1){let e=game["villageTab"].censusPanel.census;se("act.promote",[t+1,25+25*t],"leaderFilter");e.renderGovernment(e.container);game["villageTab"].censusPanel.census.update();this.leader=l.rank;this.leaderTimer=0;this.toolText=0;ge("gold",25+25*t,"resConsume");ge("promote",1);ce("changeLeader",true)}}else if(!e&&t>0&&(ie["faith"].maxValue>100||t<3)){ae.auto.cache.stocks["gold"]=25*t+25;ce("leaderGold")}}}else{this.leaderTimer++}}},distribute:function(){const c=ae.auto.distribute.items;let a=c.leader;let n=0;let u=game.village;let t=u.sim;let o=t.kittens;let g=o.length;let m=game.challenges.isActive("anarchy");let d=oe.transcendenceTier;let f=u.getFreeKittens();let e=ie["kittens"];let i=ie["catnip"];let r=i.value;let l=u.happiness;let s=e.value;let p=this.craftManager.getPotentialCatnip(false);let h=ne("catnip");let b=(500+3e3*(h<.2)+500*(h<.5))*(p-.85*Math.max(l*!m-1,.25));let v=p<=.85*l&&s<4||r+b<0;let k=v||u.jobs[1].value===0&&c["farmer"].enabled;let y=ae.auto.distribute;let x=y.religion||k&&r<=i.maxValue;if(a.enabled&&game.science.get("civil").researched&&!m&&!ae.copyTrait){let i=a.leaderTrait;let r=a.leaderJob;let l=u.leader;let e=r==="woodcutter"||r==="farmer";if(e&&i==="manager"&&d>6&&u.getJob("priest").unlocked){r="priest";if(l&&l.job!=="priest"){ce("leaderPriest")}}if(l===null&&g){return game["villageTab"].censusPanel.census.makeLeader(o[0])}let t=false;if(ae.auto.upgrade.items.policies.enabled){t=ae.policies===undefined?false:ae.policies.some(e=>e==="theocracy")}if(t||game.science.getPolicy("theocracy").researched){r="priest"}let s=u.getJob(r);if(l==null||!(l.job===r&&l.trait.name===i)){let a=o.filter(e=>e.trait.name===i);if(a.length!==0){if(s.unlocked&&s.value<u.getJobLimit(r)){let e=a.sort(function(e,t){return t.rank-e.rank===0?t.exp-e.exp:t.rank-e.rank})[0];let t;if(e.job==="farmer"){t=l.job}u.unassignJob(e);e.job=r;if(t){game.village.sim.removeJob(t,1);f=u.getFreeKittens()}u.getJob(r).value++;game["villageTab"].censusPanel.census.makeLeader(e);n+=1;this.toolText=0;se("act.distributeLeader",[te("$village.trait."+i)],"distributeFilter");ge("distribute",1)}}}}let R=u.jobs[4];let w=u.getJob("woodcutter").value;if(!f){let e=c.miner;if(e.enabled&&R.unlocked&&!R.value&&w>1&&g){t.removeJob("woodcutter")}if(x&&p<0&&game.science.get("agriculture").researched){if(r+(200+200*(ne("catnip")<.2))*(game.getResourcePerTick("catnip",true)-.85*(l*!m-1))){for(let t=g-1;t>0;t--){let e=o[t];if(e.isLeader||e.job==="farmer"){continue}u.unassignJob(e);f=u.getFreeKittens();break}}}else{return n}}if(x&&game.science.get("agriculture").researched){y.religion=false;u.assignJob(u.getJob("farmer"),1);se("act.distribute.catnip",[],"distributeFilter");se("act.distribute",[te("$village.job."+"farmer")],"distributeFilter");game["villageTab"].updateTab();u.updateResourceProduction();ge("catnip",1);return 1}let T="";let E=Infinity;let F=0;let M=oe.getSolarRevolutionRatio();let P=game.workshop.get("spaceManufacturing").researched||game.challenges.isActive("blackSky")&&game.workshop.get("orbitalGeodesy").researched||ie["unobtainium"].value&&d>5;let B=game.challenges.isActive("atheism");for(let o=u.jobs.length-1;o>=0;o--){let e=u.jobs[o];let t=e.unlocked;if(!t){continue}let a=e.name;if(a==="engineer"){continue}let i=c[a];if(!i.enabled){continue}let r=u.getJobLimit(a);let l=e.value;if(l>=r){continue}let s=Math.max(0,i.max);let n=i.limited;if(a==="hunter"){let e=game.getEffect("manpowerJobRatio");let t=e<=.75&&!game.science.get("navigation").researched;if(s===24&&game.workshop.get("railgun").researched){s=30;if(l>23&&l<30){ce("railgun")}}if(e<.5){s=u.maxKittens>10?2:0}else if(t){s=Math.round(s*.42);if(!ue.other["auto.hunter"]&&l>=s-1){let e=game.msg($I("village.job.hunter.flavor"),null,null,true);$(e.span).css("color","#ff589c");ce("hunter")}}else{ce("hunter",true)}let a=ie["manpower"];if(a.maxValue/a.perTickCached<20){s=0}}if(B){if(a!=="hunter"||a!=="farmer"){n=false}}if(a==="woodcutter"){if(game.getEffect("rankLeaderBonusConversion")){let e=u.leader;if(e&&e.job==="woodcutter"&&M<.4&&e.rank>2){s=Math.min(20,s)}}let e=ie["wood"];if(e.maxValue/e.perTickCached<30){s=0}}if(a==="geologist"){let e=game.workshop.get("geodesy").researched;if(d>9&&!m){s=Math.min(s,Math.max(30,44-d))}if(!e&&ie["iron"].perTickCached<50){s=Math.round(s*.5);if(ne("coal")>.97){s=0}}if(d<9&&e){s=Math.max(50-d,s);if(l>=40&&l<50){let e=ce("geologist");if(!e){$("#set-geologist-max")[0].innerText=te("ui.max",[Math.ceil(s)])}}}if(!game.science.get("drama").unlocked&&!e&&ne("coal")>.5){s=1}if(ie["starchart"].value>1e5&&!game["diplomacyTab"].visible){s=1}if(s>1&&ne("gold")>=1){s=1}if(!w){s=0}}if(a==="scholar"){let e=.28;if(!ie["coal"].value&&l>2){s*=.4}if(!ie["starchart"].value&&!B&&ie["science"].value>3e3+1e4*(ie["faith"].value>0)){s=0}if(game.workshop.get("rotaryKiln").researched){e=.45}if(!game.getEffect("shatterTCGain")&&P){e=.6}if(ne("science")>e&&l||!w||w<2&&!ie["paragon"].value){s=0}else if(e>.28){s=Math.max(s,Math.min(24,12+12*(game.getEffect("priceRatio")<-.07)+12*P));if(l>8&&l<s){ce("scholar")}}}if(a==="miner"){if(!game.science.get("writing").researched&&l>1){s=Math.round(s*.3)}if(!game.science.get("civil").researched&&ie["kittens"].value<10){s=1}if(game.workshop.get("geodesy").researched){if(l<Math.min(25,s)&&!P){s*=4}}else if(d<5){s=Math.round(s*.9)}let e=ie["minerals"];if(e.maxValue/e.perTickCached<20){s=0}}if(a==="priest"){if(n&&s===3){n=false;ce("defaultPriest")}if(ie["starchart"].value>1e4&&M<3){s=Math.max(s,20)}if(!M){if(d>3&&s===3&&l<3){l=0}}if(d<3){s=1}if(!w){n=true;s=0}}if(!n||l<s){F=l/s;if(F<E){E=F;T=a}}}if(T){u.assignJob(u.getJob(T),1);n=1;se("act.distribute",[te("$village.job."+T)],"distributeFilter");ge("distribute",1)}if(n){game["villageTab"].updateTab();u.updateResourceProduction();return 1}},autofeed:function(){const e=game.diplomacy.get("leviathans");const t=ie["necrocorn"];if(!(e.unlocked&&t.value>0)){return}if(e.energy===game.diplomacy.getMarkerCap()){return}if(t.value>=1){game.diplomacy.feedElders();se("act.feed",[],"unicornSacrificeFilter");ge("feed",1)}else if(.25*(1+game.getEffect("corruptionBoostRatio"))<1){ge("feed",t.value);game.diplomacy.feedElders();se("dispose.necrocorn")}},crypto:function(){let e=game.calendar.cryptoPrice;let a=ie["relic"].value;let i=ie["blackcoin"].value;if(!game.science.get("blackchain").researched&&!i>0||!game.diplomacy.get("leviathans").unlocked){return}let t=ae.auto.options.items.crypto;let r=t.subTrigger==null?"1e6-860-1060":ae.auto.options.items.crypto.subTrigger.toString().split("-");let l=parseFloat(r[0]);let s=parseFloat(r[1]);let n=parseFloat(r[2]);if(r.length!==3||!l||!s||!n){if(!l){l=1e6}ae.auto.options.items.crypto.subTrigger=l+"-881-1060";return L()}if(e<s&&a>l){game.diplomacy.buyBcoin();let e=ie["blackcoin"].value;let t=game.getDisplayValueExt(e-i);se("blackcoin.buy",[t,game.getDisplayValueExt(a)],"tradeFilter");ge("blackcoin.buy",1)}else if(e>n&&ie["blackcoin"].value>0){game.diplomacy.sellBcoin();let e=ie["relic"].value;let t=game.getDisplayValueExt(e-a);se("blackcoin.sell",[t,game.getDisplayValueExt(i)],"tradeFilter");ge("blackcoin.sell",1)}},worship:function(){const g=ae.auto.faith.items;const D=this.buildManager;const m=this.craftManager;let I=this.religionManager;const u=ae.auto.faith.addition;let d=oe;let f=0;let e,p;let h=game.prestige.getPerk("voidOrder").researched;let b=game.prestige.getParagonProductionRatio();let v=game.time.getCFU("ressourceRetrieval").val;if(u.bestUnicornBuilding.enabled){let s=this.getBestUnicornBuilding();let n=game.bld.getBuildingExt("ziggurat").meta.on;let o=ie["tears"].value;let c=ie["unicorns"].value;let a=d.getZU("blackPyramid");let u=d.getZU("sunspire").on;let e=game.prestige.getPerk("renaissance").researched;let t=!e||!o||n>27;if(s&&t){let t=!o&&c>=1e3&&n&&!game.ironWill;let i;let r=a.getEffectiveValue(game);let e=g["blackPyramid"].enabled&&a.unlocked;let l=u>1&&ie["sorrow"].value<5&&!r&&ie["unobtainium"].maxValue>5e3&&e;if(l){ce("bls");if(o>=1e4){ie["tears"].value-=1e4;ie["sorrow"].value+=1;le("小喵把眼泪炼成悲伤")}}if(s.name==="unicornPasture"&&!t&&!l){if(c>=Math.pow(s.priceRatio+game.getEffect("priceRatio"),s.val)*2){D.built(s.name,undefined,1)}}else{let a;let e=0;if(t){a=1;ce("tear")}else{i=dojo.clone(s.prices);for(p=0;p<i.length;p++){let e=i[p];e.val*=Math.pow(1.15,s.on);if(e.name==="tears"){e.val+=m.getStock("tears")+.01;a=e.val}if(e.name==="gold"){e.val*=1-game.getEffect("goldCostReduction")}}}if(r){if(g["marker"].enabled){let e=d.getZU("marker").on;let t=5e3*Math.pow(1.15,e);if(o<t&&u>Math.min(9+e,19)){a=Math.min(t,a)}}if(game.calendar.day<1&&!game.calendar.season&&Math.random()<.1){game.diplomacy.unlockElders();game["diplomacyTab"].updateTab()}}a=l?1e4:a;if(a>o){let e=Math.floor((c-m.getStock("unicorns"))/2500);let r=Math.ceil((a-o)/n);if(r<=e){let a=game["religionTab"].sacrificeBtn;if(!a||!a.model){return game["religionTab"].render()}let i=a.model.prices[0].val*r;if(c>i){let e=n*r;let t=a.controller.controllerOpts;game.resPool.addResEvent(a.model.prices[0].name,-i);game.resPool.addResEvent(t.gainedResource,e);game.stats.getStat("unicornsSacrificed").val+=i;ge("unicorns",i,"resConsume");ge("tears",e,"resGain");e=game.getDisplayValueExt(e);i=game.getDisplayValueExt(i);game.msg($I(t.logTextID,[i,e]),"notice",t.logfilterID);le(te("unicornSacrifice",[game.getDisplayValueExt(r),e]),"unicornSacrificeFilter")}}}if(!t&&!l&&game.resPool.hasRes(i)&&n){I.build(s.name,"z",1);f=1}}}}else{if(!ie["alicorn"].unlock||u.bestUnicornBuilding.confirm<2){$("#toggle-bestUnicornBuilding").click();u.bestUnicornBuilding.confirm+=1}if(ae.auto.unicorn.items.unicornPasture.enabled){this.build({unicornPasture:{require:false,enabled:true}})}e=JSON.parse(JSON.stringify(ae.auto.unicorn.items));e=Object.assign(e,ae.auto.faith.items);delete e.unicornPasture}f+=this._worship(e||g);let s=m.getResource("faith");let n=ne("faith");let k=d.getRU("transcendence");let y=k.on;let x=d.transcendenceTier;let R=y?x:0;let w=d.faith;let T=d.faithRatio;let E=d.getSolarRevolutionRatio();let F=game.getEffect("solarRevolutionLimit");let M=10+F;let l=u.adore.subTrigger;let O=M*l;let P=w/1e6*(R+1)*(R+1)*1.01;let W=T+P;let z=.01+s.value*(1+game.getUnlimitedDR(W,.1)*.1);let B=game.getLimitedDR(game.getUnlimitedDR(z,1e3)/100,M);let C=false;let t=u.autoPraise.enabled;let S=u.adore.enabled;let o=ae.auto.timeCtrl.items.timeSkip.adore;let V=o&&t&&S;let a=u.autoPraise.subTrigger;let q=game.space.getBuilding("moonOutpost").val;let A=q&&w>=1e5;let L=d.getRU("apocripha").on;let G=R||!T&&w>2e5;A=A&&L&&G&&S;let c=a<.98;let J=ue["adore"][0];if(q&&A&&c&&a){u.autoPraise.subTrigger=.98}if(Math.min(.999,Math.max(.98,a))<=n||V){if(u.transcend.enabled&&y){let c;let e=d._getTranscendTotalPrice(R+1)-d._getTranscendTotalPrice(R);let t=this.catnipForReligion(e);t=t>=0||t<0&&ie["catnip"].value+4e3*t>0;if(R>10){c=1}if(R<11&&q&&w>1e5&&L&&t){c=4}while(c){T=d.faithRatio;R=d.transcendenceTier;let e=Math.pow((R+2)/(R+1),2);let t=d._getTranscendTotalPrice(R+1)-d._getTranscendTotalPrice(R);let a=t;let i=d.getTU("blackObelisk").val;let r=((R+1)*5*i+1e3)/(R*5*i+1e3);let l=e*r;let s=(1-l+Math.sqrt(80*(l*l-1)*a+(l-1)*(l-1)))*l/(40*(l+1)*(l+1)*(l-1))+a+a/(l*l-1);let n=T>s&&w>Math.min((R-3)*1e6,0)+1e6;let o=w*2.02*R+3.03*w>1e6*t&&T>t;if(n||o){d.faithRatio-=t;d.tcratio+=t;d.transcendenceTier+=1;let e=game.challenges.getChallenge("atheism");e.calculateEffects(e,game);i=d.getTU("blackObelisk");i.calculateEffects(i,game);game.msg($I("religion.transcend.msg.success",[d.transcendenceTier]));R=d.transcendenceTier;if(R<9){C=true}for(let t=0;t<d.transcendenceUpgrades.length;t++){let e=d.transcendenceUpgrades[t];if(!e.unlocked&&R>=e.tier&&e.name!=="mausoleum"){e.unlocked=true;f=1}}c--;se("act.transcend",[game.getDisplayValueExt(t),R],"transcendFilter");ge("transcend",1)}else{c=0}}}let e=game.resPool.isStorageLimited(k.prices);let t=ae.auto.faith.items.transcendence;if(!t.enabled&&w>k.faith&&S&&e){t.enabled=true;re(["小猫贴心得无视超越按钮禁用","ks-default",ae.activitycolor])}let a=!d.faithRatio||R;let i=this.catnipForReligion();i=i>0||i<0&&ie["catnip"].value+4e3*i>0;i=x>9||i;let r=b<2?1+Math.min(2/game.prestige.getParagonProductionRatio(),.3):1;let l=.5*Math.log(d.faithRatio)+3.45;let s=a<11||v?1.3+Math.min(.6,R*.06)+Math.log1p(F):1.32;let n=game.getLimitedDR(r*s*Math.pow(Math.E,.65*l),100*M);let o=u.adore.subTrigger;let c=E*100<n;if(o===.001&&A&&c&&R){let e=Math.min(n-45-R,M*90+3*R,M*94);let t=B*100<=Math.max(1,e);if(t){A=false}else{if(E<B+.3&&B<9.6&&B>4){A=false}}n=Math.floor(n*100)/100;let a=!v||!h;if(n!==ue.other["adore.solar"]&&a&&t){le(te("summary.adore.solar",[n]));ue.other["adore.solar"]=n}}if(A&&o!==.001){A=o*10<B}if(A&&i||C){if(V){ae.auto.timeCtrl.items.timeSkip.adore=false}C=true;d._resetFaithInternal(1.01);se("act.adore",[game.getDisplayValueExt(w),game.getDisplayValueExt(P)],"adoreFilter");ue["adore"][1]+=P;ue["adore"][0]+=1}}let j=.65*(.525*Math.log(d.faithRatio)+3.45);let i=h||J?1:.3;let H=d.getRU("stainedGlass").on;i=i*game.prestige.getPerk("vitruvianFeline").researched?1:.5-.1*!H;i=d.getRU("solarchant").on>6?5-Math.sqrt(b):i;let N=q<3?95:80;let U=game.getLimitedDR(.3*Math.pow(Math.E,j)*i,N*M);u.autoPraise.expect=U*.01;let K=d.getRU("solarRevolution").on;let _=H||ie["gold"].value<180||game.getEffect("culturePerTickBase")<.9;let Y=d.getRU("basilica").on||ie["gold"].value<600||s.perTickCached<2.8||game.getEffect("culturePerTickBase")<2.7;c=!c&&a<=1;if(K&&c&&E<U*.01&&_&&Y){a=0;f+=1}let X=1+game.getUnlimitedDR(T,.1)*.1;let Z=!E&&!h;let r=s.value>(1e3-w)/X&&w<1e3;r=r||s.value>(150-w)/X&&w<150&&!h;r&=Z;let Q=K||n<.98||!h&&ie["gold"].value<400;let ee=t&&n>=a&&s.value>.001&&Q;if(ee||C||r){let e=c&&!C&&n<.98&&!o;let t=R<5?2e5:4e5;if(e&&(Date.now()>u.autoPraise.time+t||!ue.other["praise.msg"])&&E){u.autoPraise.time=Date.now();let e=game.getDisplayValueExt(U);le(te("summary.praise.msg",[e]));ue.other["praise.msg"]=e}let a=d.getApocryphaBonus();let i=s.value;let r=i*(1+a);ue["praise"][1]+=r;ue["praise"][0]+=1;ge("faith",i,"resConsume");se("act.praise",[game.getDisplayValueExt(s.value),game.getDisplayValueExt(r)],"faithFilter");let l=ie["faith"];l.value=Math.max(l.value+2*ie["faith"].perTickCached,0);d.praise()}return f},_worship:function(e){let t=ae.auto.faith.items;let r=JSON.parse(JSON.stringify(e||ae.auto.faith.items));let l=this.religionManager;let a=this.bulkManager;let i=oe.getRU("solarRevolution");let s=ue.other["auto.changeLeader"]?0:1;let n=(oe.faith>i.faith||game.prestige.getPerk("voidOrder").researched)&&ie["faith"].maxValue>750-75*s;let o=oe.transcendenceTier;let c=!i.on&&n&&oe.getRU("solarchant").on&&o?.98+.2*(ie["gold"].maxValue>470-20*s):ae.auto.faith.trigger;this.setTrait("wise");let u=1-game.getLimitedDR(.09+.01*(1+game.prestige.getBurnedParagonRatio()),1);if(!i.on&&n&&t.solarRevolution.enabled&&oe.faith>i.faith){l.build("solarRevolution","s",1)}if(!oe.getRU("solarchant").on&&ie["faith"].value>100&&oe.faith>150){l.build("solarchant","s",1)}let g=oe.getRU("basilica").on;if(!oe.getRU("sunAltar").on&&g){r["goldenSpire"].enabled=false}if(!g&&r["basilica"].enabled){let e=oe.getRU("stainedGlass").on;if(oe.faith>5e4){if(game.village.happiness>2.4){r["sunAltar"].enabled=false}r["goldenSpire"].enabled=false}if(!e&&ie["science"].maxValue>65e3){r["scholasticism"].enabled=false}}if(!game.ironWill&&game.getEffect("faithRatioReligion")<.2){r["templars"].enabled=false;if(!oe.getRU("templars").on&&ie["faith"].value>3e3&&oe.faith>75e3){ce("templars")}if(o>8&&!game.getEffect("calcinerRatio")){r["sunAltar"].enabled=false;r["goldenSpire"].enabled=false;r["scholasticism"].enabled=false}}if(o&&!oe.getRU("transcendence").on){r["apocripha"].enabled=false;if(ie["faith"].value>6e3){ce("apocripha")}}if(oe.getSolarRevolutionRatio()>9.98+.9*game.getEffect("solarRevolutionLimit")&&game.workshop.get("spaceManufacturing").researched&&ue["adore"][0]){let e=["scholasticism","goldenSpire","stainedGlass","basilica","templars"];e.forEach(e=>{r[e].max=-1})}let m=oe.getZU("marker");if(!oe.getZU("blackPyramid").getEffectiveValue(game)){if(m.unlocked){let e=r["marker"];e.enabled=false;if(game.resPool.hasRes(e.prices)){ce("marker")}if(ie["burnedParagon"].value<2e6){e.max=Math.max(80,e.max)}}if(oe.getZU("sunspire").val<2){r["blackPyramid"].enabled=false}}else if(!i.on){r["blackPyramid"].enabled=false}let d={};for(let e in r){let a=r[e];let i=l.getBuild(e,a.variant);if(a.variant==="s"){let e=i.noStackable;let t=i.on&&e||oe.faith<i.faith;if(t){a.enabled=false}if(e){a.max=1}}if(a.variant==="z"&&!game.bld.getBuildingExt("ziggurat").meta.on){a.enabled=false}if(a.variant==="c"&&!game.science.get("cryptotheology").researched){a.enabled=false}d[e]=i}const f=a.bulk(r,d,c);let p=0;let h;for(let a in f){let e=f[a];let t=e.count;if(t>0){l.build(e.id,e.variant,t);p+=1}}return p},chrono:function(){if(!game["timeTab"].visible||!game.workshop.get("chronoforge").researched){return 0}let a=0;const i=JSON.parse(JSON.stringify(ae.auto.time.items));const r=this.timeManager;const e=this.bulkManager;let t=ae.auto.time.trigger;let l=i["cryochambers"];let s=l.max;let n=game.bld.getBuildingExt("chronosphere").meta.on+game.getEffect("cryochamberSupport");l.max=s===-1?n:Math.min(n,s);let o=i["ressourceRetrieval"];let c=o.max;o.max=c===-1?100:Math.min(100,c);const u={};for(let t in i){let e=i[t];if(e.variant==="chrono"&&!game.workshop.get("chronoforge").researched){e.enabled=false}if(e.variant==="void"&&!game.science.get("voidSpace").researched){e.enabled=false}u[t]=r.getBuild(t,e.variant)}const g=e.bulk(i,u,t);for(let t in g){let e=g[t];if(e.count>0){r.build(e.id,e.variant,e.count);a=1}}return a},upgrade:function(){let n,o,c;const u=ae.auto.upgrade.items;const g=this.upgradeManager;const m=this.craftManager;const d=this.bulkManager;const f=this.buildManager;let p=game.workshop.get("geodesy").researched;let h=game.workshop.get("orbitalGeodesy").researched;let b=oe.getSolarRevolutionRatio();let v=game.prestige.getParagonProductionRatio();let k=game.getEffect("priceRatio");let y=0;let x=game.bld.getBuildingExt("pasture").meta;let R=game.bld.getBuildingExt("aqueduct").meta;this.setTrait("scientist");if(u.techs.enabled&&game["libraryTab"].visible){const e=game.science.techs;u.techs.limited=true;let a=game.science.get("nanotechnology").researched;let i=ie["titanium"].value;let r=game.science.get("acoustics").researched;let l=ie["relic"].value;let s=ie["parchment"];let n=ie["starchart"].value>1e5&&!game.science.get("drama").researched&&s.value<7500;e:for(let t of e){if(t.researched||!t.unlocked){continue}if(u.techs.limited){let e=t.name;switch(e){case"combustion":if(ie["science"].maxValue>15e4&&i<5e3&&!game.science.get("metalurgy").researched){continue}break;case"biology":{let e=ie["science"].maxValue;if(e<123e3&&game.getEffect("hunterRatio")<=3.5||e>123e3&&i<5e3){ce("biology");continue}}case"dimensionalPhysics":case"rocketry":if(n){continue}break;case"chemistry":if(X.get("titaniumAxe").researched&&!r){continue}break;case"biochemistry":if(i<7e3){continue}break;case"ecology":if(i<1e4||n){continue}break;case"ai":if(i<1e4||n){continue}break;case"physics":if(!r&&oe.transcendenceTier&&i<15&&ie["science"].maxValue>6e4&&(ie["compedium"].value<120||ie["steel"].value<100)){ce("physics");continue}break;case"particlePhysics":if(!a&&i<2e3){continue}break;case"oilProcessing":if(!a&&i<1e4){continue}break;case"drama":{if(ie["manpower"].perTickCached<14&&s.value<15e3&&!ie["eludium"].value){if(s.value>5e3){ce("drama")}continue}}break;case"antimatter":if(v>2&&!game.getEffect("beaconRelicsPerDay")||!game.workshop.get("chronoforge").researched){continue}break;case"terraformation":if(v>2&&(!R.stage||ie["sorrow"].maxValue<17)){continue}break;case"cryptotheology":if(l<105&&ie["antimatter"].value<4e3){continue}break;case"blackchain":if(l<1e6){continue}break}}let e=dojo.clone(t.prices);e=game.village.getEffectLeader("scientist",e);for(let t of e){let e=t.name;if(g.getValue(e)<t.val){continue e}}y=1;g.build(t,"science")}}if(u.upgrades.enabled&&game["workshopTab"].visible){if(!game["workshopTab"].domNode){y=2}const a=game.workshop.upgrades;let e=true;let l=[];if(e){let t=ie["starchart"];let e;l=["biofuel","gmo","invisibleBlackHand"];if(game.getEffect("shatterTCGain")<.05){l.push("steelPlants");if(v>2){l=l.concat(["amReactors","amReactorsMK2","amDrive"])}}if(!x.on||x.stage===0){l=l.concat(["photovoltaic","thinFilm","qdot"])}if(!R.on||R.stage===0){l.push("hydroPlantTurbines")}if(ie["void"].value<250){l.push("voidAspiration")}if(k){l.push("register");if(k<-.06){l=l.concat(["neuralNetworks","voidReactors"])}}let a=["factoryAutomation","advancedAutomation","pneumaticPress"];let i=game.challenges.isActive("pacifism");if(game.bld.getBuildingExt("steamworks").meta.on<1+5*k){if(!i){l=l.concat(["printingPress","offsetPress","photolithography"],a)}if(!game.bld.getBuildingExt("steamworks").meta.on){l.push("combustionEngine")}}else if(!game.opts.enableRedshift){l=l.concat(a)}if(i){l=l.concat(["bolas","huntingArmor","steelArmor","alloyArmor","nanosuits","silos"])}if(game.village.getJob("engineer").value<5){l=l.concat(["spaceEngineers","aiEngineers","chronoEngineers","amFission","factoryRobotics","factoryOptimization"])}if(!b&&ie["faith"].maxValue>=750&&oe.faith>1e3){l.push("caravanserai")}if(game.resPool.energyProd-game.resPool.energyCons<15){l=l.concat(["carbonSequestration","pumpjack"])}if(game.globalEffectsCached["titaniumPerTickAutoprod"]<.02&&ie["ship"].value<50&&b>2.4){l=l.concat(["titaniumAxe","silos","astrolabe","titaniumBarns","alloyAxe","alloyArmor","alloyBarns","alloyWarehouses"])}e=b>6||h;if(e&&!game.space.meta[0].meta[3].val&&t.value<1700){if(!ie["unobtainium"].value){l=l.concat(["geodesy","seti"])}if(!h){if(game.getEffect("calcinerRatio")>1){l.push("fuelInjectors")}l=l.concat(["titaniumWarehouses","titaniumBarns","steelSaw","titaniumSaw","cadSystems"])}}if(!p){l.push("seti");l.push("silos");if(b<6&&t.value>400){l.push("titaniumSaw")}if(ie["oil"].value<75e3&&!h){l=l.concat(["offsetPress","photolithography"]);if(ne("coal")>.8&&ne("oil")<.95){l=l.concat(["fuelInjectors","pyrolysis","combustionEngine"])}}if(b>4&&!h&&ne("coal")>.4){l.push("fuelInjectors")}if(!ie["manpower"].value){l.push("bolas")}if(!ie["ship"].value){l.push("cargoShips")}}if(!game.getEffect("smelterRatio")){l=l.concat(["concreteWarehouses","concreteBarns","barges","seti"])}if(game.bld.getBuildingExt("factory").meta.val<3){l=l.concat(["factoryLogistics","refrigeration","barges"]);if(ne("oil")>.7){if(game.getResourcePerTick("oil",true)>.5||!p){l.push("pumpjack")}l=l.concat(["oilDistillation","oilRefinery"])}}if(!game.workshop.get("mWReactor").researched){l=l.concat(["eludiumReflectors","amBases","coldFusion","amReactors","cryocomputing"]);if(v>1){l.push("lhc")}}if(game.bld.getBuildingExt("library").meta.stage===0){l=l.concat(["starlink","uplink","cryocomputing"])}if(game.bld.getBuildingExt("accelerator").meta.val<5){l=l.concat(["darkEnergy","stasisChambers","voidEnergy","tachyonAccelerators","lhc"]);if(v>4){l=l.concat(["stoneBarns","reinforcedBarns","titaniumBarns","alloyBarns","concreteBarns","titaniumWarehouses","alloyWarehouses","concreteWarehouses","storageBunkers","stasisChambers","voidEnergy","darkEnergy"])}}if(game.bld.getBuildingExt("aiCore").meta.val<5){l=l.concat(["machineLearning","aiBases"]);let e=ie["ship"].value<5e4;if(v>4){l=l.concat(["storageBunkers","tachyonAccelerators","darkEnergy","eludiumReflectors"])}if(e){l.push("thoriumEngine")}}if(!game.bld.getBuildingExt("reactor").meta.val||ie["ship"].value<169){l=l.concat(["reactorVessel","enrichedUranium"])}if(game.space.getBuilding("sattelite").val<6){l=l.concat(["solarSatellites","satelliteRadio","assistance"])}if(t.perTickCached){if(t.perTickCached<1&&game.challenges.isActive("blackSky")){l=l.concat(["geodesy"])}}else{l=l.concat(["hubbleTelescope"])}let r=game.bld.getBuildingExt("magneto").meta;if(r.val&&r.on===r.val){l.push("carbonSequestration")}if(ie["thorium"].value<11e4||game.resPool.energyProd-game.resPool.energyCons>800){l.push("thoriumReactors");if(v>2){l.push("amBases");if(t.value<1e5){l.push("eludiumReflectors")}}let e=game.getEffect("priceRatio");if(e&&e>-.07){l.push("astrophysicists")}}e=ie["science"].maxValue>2e5/(1+b)&&t.value<2075;if(e||ie["titanium"].value<5+10*b){l=l.concat(["astrolabe","unobtainiumReflectors","lhc","titaniumMirrors"])}if(game.challenges.isActive("anarchy")){l=l.concat(["logistics","augumentation","internet","neuralNetworks","register"])}if(game.ironWill){l=l.concat(["logistics","augumentation","internet","neuralNetworks","mineralHoes","ironHoes","miningDrill","mineralAxes","ironAxes","steelAxe","titaniumAxe","alloyAxe","ironwood","concreteHuts","unobtainiumHuts","eludiumHuts","geodesy","register","unobtainiumDrill","assistance","astrophysicists","register"])}else if(!game.workshop.get("concreteHuts").researched){l=l.concat(["concreteWarehouses","concreteBarns","barges","seti"]);if(!game.workshop.get("fuelInjectors").researched){l.push("offsetPress")}if(game.village.jobs[0].value>1&&v>2){if(game.getEffect("woodJobRatio")<.7){l.push("mineralHoes")}if(game.getEffect("woodJobRatio")<1.2){l.push("ironHoes")}}}}e:for(let t of a){if(t.researched||!t.unlocked){continue}let e=t.name;if(l.indexOf(e)!==-1){continue}o=dojo.clone(t.prices);o=game.village.getEffectLeader("scientist",o);for(c of o){if(g.getValue(c.name,e)<c.val){continue e}}y+=1;g.build(t,"workshop")}}if(u.policies.enabled&&game["libraryTab"].visible){(function(){const e=game.science;const i=e.policies;let r=n=0;const l=i.length;const s=[];let t=e.get("astronomy").researched||ie["burnedParagon"].value<1e4&&ie["culture"].value<400||game.getEffect("priceRatio")>-.03?1:3;for(n in ae.policies){let a=ae.policies[n];for(let t in i){t=parseInt(t);let e=i[(t+r)%l];if(e.name===a){r=t+r+1;if(!e.researched){if(e.blocked){break}if(e.unlocked){if(e.requiredLeaderJob===undefined||game.village.leader!=null&&game.village.leader.job===e.requiredLeaderJob){s.push(e)}}}break}}}e:for(n of s){for(let e of n.prices){if(m.getValueAvailable(e.name,true)<e.val*t){continue e}}g.build(n,"policy")}})()}let w=game["spaceTab"];if(u.missions.enabled&&w.visible){let a=u.missions.subTrigger;let e=game.space.meta[0].meta.length;let i=game.workshop.get("spaceManufacturing").researched;if(a===4){if(ie["starchart"].value>1e5&&k<-.07){a=5}if(ie["starchart"].value>Math.min(1e5*(1+v)*(1+b),1e9)||ie["alicorn"].value){a=7;if(ie["relic"].value>26){a=12}}}let r=0;let l=!h&&!p&&!ie["unobtainium"].value;let s=w.GCPanel;if(!s){w.render()}const T=game.space.meta[0].meta;e:for(n=0;n<e;n++){let e=T[n];if(e.val&&n!==7){r++}if(!e.unlocked||e.val||n>=a){continue}if(l){break}let t=s.children[n];if(!t||!t.model.metadata){w.render();break}if(!T[3].val&&n===2&&a!==3&&!game.challenges.isActive("blackSky")){continue}if(t.model.metadata.val||t.model.metadata.on){continue}o=t.model.prices;for(c of o){if(m.getValueAvailable(c.name,true)<c.val){continue e}}if(!t.model.enabled){t.controller.updateEnabled(t.model);continue}t.controller.build(t.model,1);i=2;F(o);if(n===7||n===12){le(te("upgrade.space.mission",[T[n].label]),"spaceFilter")}else{le(te("upgrade.space",[T[n].label]),"spaceFilter")}}if(w.planetPanels.length!==r&&!l||i>1){w.render()}}if(u.races.enabled&&game.diplomacy.hasUnlockedRaces()){let a=game.diplomacy.get("leviathans").unlocked?8:7;if(game["diplomacyTab"].racePanels.length<a){let e=function(e){if(game.diplomacy.get(e).unlocked){return}let t=m.getValueAvailable("manpower",true);if(t>=1e3){ie["manpower"].value-=1e3;a="render";se("upgrade.race",[game.diplomacy.unlockRandomRace().title],"tradeFilter");ge("manpower",1e3,"resConsume")}};if(game.challenges.isActive("pacifism")||!game.village.sim.kittens.length||ie["gold"].value>15){e("lizards");e("sharks");e("griffins")}if(ie["culture"].value>=1500){e("nagas")}if(ie["ship"].value>=1){e("zebras")}if(ie["ship"].value>=100&&ie["science"].maxValue>125e3){e("spiders")}if(game.science.get("nuclearFission").researched){e("dragons")}}if(!game["diplomacyTab"].racePanels.length||a==="render"){game["diplomacyTab"].render()}}if(u.buildings.enabled){let i=ae.auto.build.items;let r=game.calendar.season===1?game.resPool.energyProd:game.resPool.energyWinterProd;let l=game.challenges.isActive("energy");let e=1e3*(ie["starchart"].value>2e6);let s=r-10-5*v-30*(b>9)-e<game.resPool.energyCons||l;let n=x.stage===0?x.val:0;let o=R.stage===0?R.val:0;let c=(e,t)=>{let a=t.stages[1].prices;if(d.singleBuildPossible(t,a,1)){f.sellBuild(e);game.resPool.payPrices(a);t.stage=1;t.on=1;t.val=1;if(t.upgrades){if(t.updateEffects){t.updateEffects(t,game)}E(t.upgrades)}game.bld.getBuildingExt(e)._metaCache=null;f.manager.render();ae.renderTime=0;se("summary.upgrade.building."+e,[],"upgBldFilter");ge("upgrade.building."+e);ce("upg"+e.charAt(0).toUpperCase()+e.slice(1),true);return 2}};if(x.stage===0){if(x.stages[1].stageUnlocked){let e=game.bld.getBuildingExt("amphitheatre").meta.stage===1;let t=s&&e&&(game.getResourcePerTick("titanium",true)>20+v-5*p||game.workshop.get("unobtainiumDrill").researched);let a=m.getPotentialCatnip(true,0,o);a=a>0||a<0&&ie["catnip"].value+2e3*a>0;if(a&&t&&i.solarFarm.enabled&&ne("titanium")>.4){return c("pasture",x)}else{ce("upgPasture","","upgBldFilter")}}}if(R.stage===0){if(R.stages[1].stageUnlocked){if(x.stage===1){let e=250*Math.pow(x.stages[1].priceRatio+k,x.val)>ie["titanium"].maxValue||l;let t=m.getPotentialCatnip(true,n,0);let a=t>0||t<0&&ie["catnip"].value+(4e3+6e3*(b<8))*t>0;if(a&&e&&s&&i.hydroPlant.enabled){return c("aqueduct",R)}else{ce("upgAqueduct","","upgBldFilter")}}}}let u=game.bld.getBuildingExt("library").meta;if(u.stage===0){if(u.stages[1].stageUnlocked){let e=.1*u.totalEffectsCached.scienceMax/(1+v);let t=Math.max(1+game.prestige.getParagonProductionRatio(),2)/2;let a=ie["compedium"].value*3>e/(1+game.bld.getBuildingExt("biolab").meta.val*.01)&&game.bld.getEffect("scienceMax")>3e4*(1+v)*(1+b);a|=m.getTickVal(ie["concrate"])>600*t;if(a&&i.dataCenter.enabled&&ie["eludium"].value>20*(1+v)){if(r>=game.resPool.energyCons+150&&!l&&ne("science")>.8){return c("library",u)}}else{ce("upgLibrary","","upgBldFilter")}}}let t=game.bld.getBuildingExt("amphitheatre").meta;if(t.stage===0){if(t.stages[1].stageUnlocked){if(i["broadcastTower"].enabled&&(game.getResourcePerTick("titanium",true)>2||ie["ship"].value>200)){return c("amphitheatre",t)}else{ce("upgAmphitheatre","","upgBldFilter")}}}}return y},build:function(i){const N=this.buildManager;const e=this.bulkManager;let t=ae.auto.build.trigger;let r=0;let K=game.workshop.get("geodesy").researched;let _=game.village.leader!==null;let Y={};let X;if(typeof i!="object"){const Z=this.craftManager;let i=game.ironWill;let t=game.challenges.isActive("blackSky");let r=game.prestige.getPerk("vitruvianFeline").researched;let a=game.challenges.isActive("atheism");let l=game.prestige.getParagonProductionRatio();let s=game.workshop.get("orbitalGeodesy").researched;let n=game.workshop.get("spaceManufacturing").researched;let e=oe.getRU("solarRevolution");let o=oe.getSolarRevolutionRatio();let c=game.science;let u=c.get("theology").researched;X={};let g=JSON.parse(JSON.stringify(ae.auto.build.items));let m=ie["science"];let d=m.maxValue;let f=m.value/d;let p=(e,t,a)=>{let i=g[e];let r=i.max;if(e){if(f<a){i.max=r===-1?t:Math.min(t,r);if(game.bld.getBuildingExt(e).meta.val>=t&&!n){ce("scienceBld")}}else{i.max=r===-1?game.bld.getBuildingExt(e).meta.val+4:r}}};let h=ie["starchart"].value;if(o<50&&h<2e6){let e=h>1e4?150:300;p("observatory",e+game.getEffect("timeRatio")+Math.pow(3.2,l),.95);p("academy",22*(l+1),.98);p("biolab",200,.99)}let b=Z.getPotentialCatnip(false);let v=c.get("machinery").researched;let k=c.get("astronomy");if(f<.98&&(!v||k.unlocked)&&ie["minerals"].value){let e=game.stats.getStat("totalResets").val&&!k.researched;if(e){g["academy"].max=6*(l+1);if(game.getEffect("maxKittens")<12&&l>1.5){g["academy"].max=3}if(k.unlocked){ce("academy")}}}if(n&&g["barn"].max<16&&o){g["barn"].max=-1}let y=g["smelter"];let x=g["pasture"];if(!game["workshopTab"].visible&&c.get("animal").researched){y.max=0;if(x.max===150&&!game.challenges.isActive("winterIsComing")&&(b>5||ie["minerals"].value>400||game.village.jobs[0].value>3)){x.enabled=false;ce("pasture")}}if(!u){let e=game.bld.getBuildingExt("pasture").meta;if(e.val>10){x.max=6+game.bld.getBuildingExt("library").meta.val}let t=game.bld.getBuildingExt("hut").meta.val-2;let a=g["library"];a.max=t>0?Math.floor(t*11):a.max;if(v&&ne("wood")<.9&&!i){a.max=45}if(l&&b>4&&t<4&&t>1){if(oe.transcendenceTier>9&&!v){if(b>5&&game.village.jobs[0].value>1){x.max=0}g["barn"].max=0}if(!c.get("civil").researched){if(t===2){g["library"].max=13+l;g["mine"].max=1;x.max=13}let e=!game.bld.getBuildingExt("logHouse").meta.val&&r&&!i;if(t===3){a.max=30-2*l;g["academy"].max=5;if(e){g["mine"].max=7}}if(t===4){if(e){g["mine"].max=7}}}if(ie["parchment"].value>3&&!ie["culture"].value){g["workshop"].max=0}}}if(!c.get("writing").researched&&ie["minerals"].value){let e=g["workshop"];e.max=1;if(ne("minerals")>.9){e.max=3}ce("workshop")}else{ce("workshop",true)}let R=g["reactor"];let w=game.space.getBuilding("sattelite").on;if(!n&&(ie["titanium"].maxValue>125e3||!w&&r)){R.max=25+10*t}if(ie["uranium"].value<100){R.max=0}if(ie["oil"].maxValue<55e3){g["quarry"].max=35*(1+o)/(1+l)}let T=game.getEffect("priceRatio");let E=game.bld.getBuildingExt("ziggurat").meta;if(E.val>10&&!ie["alicorn"].unlocked){let e=Math.pow(E.priceRatio+T,E.val);if(ie["blueprint"].value<2.5*e){g["ziggurat"].max=0}}if(t&&ie["science"].maxValue>3e5&&!s){g["observatory"].max=3}let L=game.bld.getBuildingExt("magneto").meta;if(!game.challenges.isActive("pacifism")){let e=g["mint"];let t=ie["manpower"].maxValue;let a=game.bld.getBuildingExt("mint").meta.val;if(t<=2e4&&!game.workshop.get("unobtainiumDrill").researched){e.enabled=false}else if(!a||!w||game.getEffect("productionRatio")<.5){e.max=2;g["temple"].max=25}else if(!s){e.enabled=false}if(!n&&L.on<Math.max(1,6-l-3*_-3*(game.getEffect("calcinerRatio")>0))&&!i){let e=g["steamworks"];if(game.bld.getBuildingExt("steamworks").meta.unlocked&&e.enabled&&ie["gear"].value>19){ce("steamworks");e.enabled=false}}else{ce("steamworks",true)}}let F=g["brewery"];if(!c.get("metalurgy").researched||ie["spice"].value>1e3&&ie["spice"].value<1e4){F.max=4}if(!game.calendar.festivalDays||ie["spice"].value<1e3+500*l){F.enabled=false}let M=g["temple"];if(_&&!game.getEffect("unobtainiumPerTickSpace")&&ie["faith"].maxValue<8e3){M.max=Math.max(21+10*s,10*(1+o))}if(o<.06){if(F.max!==4){F.max=22}g["chapel"].max=19-4*l+(ie["ship"].value>100)*60;M.max=40-28*!K-3*_-l;let e=game.bld.getBuildingExt("smelter").meta.val;if(b>7*game.village.happiness*(2-1*_)){x.max=0;ce("pasture")}if(e){if(ie["wood"].perTickCached*2<e+.5*!v||ie["minerals"].perTickCached<e+1-3*u-l-5*k.researched+T){y.max=0;if(!i){ce("smelter")}}else{y.max=e+1}}}let P=game.bld.getBuildingExt("temple").meta.val;let B=g["tradepost"];let U=oe.faith>e.faith||game.prestige.getPerk("voidOrder").researched;let D=ie["gold"].value/ie["gold"].maxValue;if(game.getEffect("standingRatio")<.2&&ie["ivory"].value>1e4&&P>11){let e=game.workshop.get("caravanserai");if(e.unlocked&&!e.researched){M.enabled=false;B.max=21;ce("caravanserai")}}let I=ae.auto.faith.addition.autoPraise.expect;if(K){if(_&&!s&&ie["kittens"].maxValue<130&&game.workshop.get("concreteHuts").researched){N.built("hut",undefined,1);N.built("logHouse",undefined,1)}}else{let e=!oe.getRU("sunAltar").on||!oe.getRU("sunAltar").on||!oe.getRU("sunAltar").on||o>3&&!w&&game.getEffect("faithRatioReligion")<.2;if(e&&o){M.max=25-3*l-2*(o>3)-4*_;let e=17+2*P-5*l-3*Math.sqrt(o)-2*_;if(!i){e=Math.max(e,12)}B.max=e;ce("religion")}if(!o){B.max=40-25*(l>4)-5*_-5*a}}if(!e.on&&!a&&u){if(ae.auto.faith.items.solarRevolution.enabled){let e=ue.other["auto.changeLeader"]?0:1;if(ie["faith"].maxValue>750-75*e&&ie["gold"].maxValue>530-50*e){ce("temple");M.max=Math.floor((7.5-e*.7)/(1+game.prestige.getParagonStorageRatio()))+2*!_;if(ie["gold"].value>530&&ne("gold")>.5){M.max=P+1}}}if(oe.transcendenceTier){B.max=18-2*l+1*(ie["kittens"].value<60)-2*_-1*(ie["kittens"].value>70);if(ie["gold"].value>525){B.max=Math.min(18,game.bld.getBuildingExt("tradepost").meta.val+1)}}ce("tradepost")}else if(u){ce("temple",true);ce("tradepost",true);if(!s&&P>25){M.enabled=false}}if(!u&&c.get("philosophy").researched&&D<.96&&!a){let e=game.village.happiness<4&&P===1&&game.prestige.getPerk("renaissance").researched;M.max=e?1:Math.floor(7.5/(1+game.prestige.getParagonStorageRatio()));B.max=21-2*l-5*_-.5*(ie["kittens"].value>54);ce("tradepost")}let C=g["calciner"];let S=C.max;if(s){if(!n||!w){let e=Math.min(46+o,6*o+15+2*l+4*game.workshop.get("unobtainiumDrill").researched);C.max=S===-1?Math.min(e+e*game.getEffect("productionRatio"),95-35*t+game.space.meta[0].meta[0].on*t*10):Math.min(50,S)}}else{let e=ie["uranium"].value>250;let t=ie["oil"].value>35e3;let a=21+10*e+5*t;if(d<2e5||ie["oil"].maxValue<5e4){a=Math.min(10+l*3+2*Math.sqrt(o),a)}C.max=S===-1?a:Math.min(a,S);if(!game.workshop.get("fluidizedReactors").researched){C.max=20}if(!game.workshop.get("oxidation").researched){C.max=5+o+.2*l}g["warehouse"].max=45-200*T+50*(T<-.07)+5*c.get("electricity").researched}let V=game.bld.getBuildingExt("calciner").meta;let q=ie["oil"].perTickCached-.024*V.val;if(q<.5){C.max=1+K+1*(l>1);if(q<.1){g["magneto"].max=0}}let O=g["solarFarm"];if(ne("titanium")<.9&&game.resPool.energyProd-10>game.resPool.energyCons){O.enabled=false}let A=g["mansion"];let W=c.get("archeology").researched;let z=ie["ship"].value;let G=s||z>600;if(c.get("electronics").researched&&!n){ce("broadcastTower");A.max=80}else{ce("broadcastTower",true)}let J=ie["titanium"];let j=g["biolab"];if(!K&&!s){if(!i&&A.max){A.max=Math.min(16,5*(1+o)*(1+l)+2*(ie["ship"].value>100)+2*(game.getEffect("hunterRatio")>3.5));g["quarry"].max=o+l+5;if(C.max===25){A.max=0}}if(ie["alloy"].value>25&&c.get("biology").researched){j.max=2;ce("biolab")}}else{if(G&&!A.max&&ne("titanium")===1){A.max=45}if(n){ce("biolab",true);ce("mansion",true);ce("scienceBld",true);ce("smelter",true);if(o>.1&&s){ce("pasture",true)}}else{if(ne("titanium")<.8){j.max=Math.max(20-o-l-5*(d>25e4)-5*!r,0);if(!K){A.max=Math.max(Math.floor(17*(l+1)),135-game.village.maxKittens)}}g["ziggurat"].max=10+15*game.workshop.get("unobtainiumDrill").researched+10*r+o;if(o&&game.getEffect("faithRatioReligion")<.2){B.max=58}}}if(!c.get("electricity").researched){g["oilWell"].max=1+l+o+10*r+J.perTickCached}let $=g["broadcastTower"];if(game.space.getProgram("moonMission").on&&ne("titanium")>.9){if(ne("titanium")!==1&&ie["starchart"].value<1e6){let e=$.max;$.max=e===-1?20:Math.min(20,e)}}else if(ie["starchart"].value<1e6){$.max=8+100*!o}if(h>1e4&&!n&&!game.calendar.festivalDays&&!i&&l>1){g["observatory"].max=70;g["chapel"].max=10;g["factory"].max=0;g["amphitheatre"].max=20;g["academy"].max=60;g["harbor"].max=10;g["logHouse"].max=game.bld.getBuildingExt("logHouse").meta.val+1;g["hut"].max=game.bld.getBuildingExt("hut").meta.val+1;if(!ie["wood"].perTickCached){y.max=60}g["ziggurat"].max=1}if(T&&ie["unobtainium"].value<13e3&&game.calendar.futureSeasonTemporalParadox<0&&!game.getEffect("resStasisRatio")){g["chronosphere"].enabled=false}if(game.challenges.isActive("anarchy")){g["aiCore"].enabled=true}if(!game.getEffect("aiCoreProductivness")&&ie["burnedParagon"].value<2e4){g["aiCore"].max=25}if(t&&ae.auto.build.items.calciner.enabled&&V.unlocked&&!V.val){N.built("calciner",undefined,1)}let H=["library","academy","pasture","barn","harbor","oilWell","warehouse","broadcastTower","accelerator","mansion","quarry","aqueduct","chapel","lumberMill","biolab","mint"];for(let t in g){let e=g[t];if(!e.enabled||!e.max){continue}if(H.indexOf(t)===-1){X[t]=e}else{Y[t]=e}}}const l={};i=X||i;for(let a in i){let e=i[a];let t=N.getBuild(e.name||a).meta;if(t.almostLimited&&(!K||ie["kittens"].maxValue<110)&&_){e.enabled=false}if(t.stage!==e.stage){e.enabled=false}l[a]=t}const s=e.bulk(i,l,t,"bonfire");if(s){for(let a=0;a<s.length;a++){let e=s[a].count;let t=s[a].id;e=N.count(t,e);if(e>0){N.built(s[a].name||t,s[a].stage,e);r+=1}}}if(JSON.stringify(Y)!=="{}"){r+=this.build(Y)}return r},space:function(){if(!game["spaceTab"].visible||!game.space.meta[0].meta[0].on){return}const B=JSON.parse(JSON.stringify(ae.auto.space.items));const a=this.spaceManager;const e=this.craftManager;const t=this.bulkManager;let i=ae.auto.space.trigger;let C=game.challenges.isActive("blackSky");let S=oe.getSolarRevolutionRatio();let V=ie["starchart"].value;this.setTrait("chemist");{let T=B["spaceStation"];let E=game.getEffect("unobtainiumPerTickSpace");let F=game.getEffect("priceRatio");let M=F<-.06;let e=S>1.3&&E||S>2;if(C){B["researchVessel"].enabled=false;if(T.enabled){$("#toggle-spaceStation").click();ce("spaceStation")}}else if(!i&&e&&!game.space.meta[0].meta[3].val&&V<2400){i=9;ce("spaceTrigger")}let P=game.space.getBuilding("sattelite").val;let t=C||S>5||E&&game.workshop.get("spaceManufacturing").researched;if(!i){let e=game.resPool.energyProd;let t=game.resPool.energyCons;let a=game.prestige.getParagonProductionRatio();let i=ne("unobtainium");let r=game.space.getBuilding("spaceStation").val;let l=3e3*Math.pow(1.12,r)*(1+.2*M+8*!S);let s=2300*Math.pow(1.12,P);if(V>s&&S<2){B["sattelite"].max=P+1}let n=game.getEffect("productionRatio")<.6&&i>0&&S>5;if(V<s&&S<2&&(!game.space.meta[0].meta[3].val||P)||!game.workshop.get("orbitalGeodesy").researched||n){B["sattelite"].max=0}if(V>l){T.max=r+1}if(V<l||game.challenges.isActive("energy")||!E){if(T.enabled){ce("spaceStationStar")}T.max=0}let o=B["entangler"];if(game.getEffect("beaconRelicsPerDay")){let e=o.max;o.max=e===-1?game.getEffect("gflopsPerTickBase")/.1:e}else{if(F<-.03&&!C){B["spaceBeacon"].enabled=false}B["entangler"].enabled=false}if(!game.getEffect("lunarOutpostRatio")&&i!==1){B["spaceElevator"].max=8+a-4*(ie["unobtainium"].maxValue<500);if(!M&&i<.5||!S&&!game.ironWill&&!X.get("astrophysicists").researched){B["spaceElevator"].max=0}}else if(!S){B["spaceElevator"].max=30}let c=game.getResourcePerTick("uranium",true);if(E&&c<.7||ne("unobtainium")===1){B["moonOutpost"].max=0}if(!E){B["sattelite"].max=9+6*C}let u=game.prestige.getParagonStorageRatio();if(i<.9){B["moonBase"].max=(game.bld.getBuildingExt("aiCore").meta.val>25)*140}else{let e=game.space.getBuilding("moonBase").val;if(e.val===e.on){B["moonBase"].max=e.val+1;ce("moonBase")}}if(c>8&&V<1e6){B["planetCracker"].max=7*(V>1e5)}if(V<3e4*S+S){B["hydrofracturer"].max=100*game.getEffect("spaceRatio")-a-S-23*C}if(!S){B["hydrofracturer"].max=0;B["researchVessel"].max=42+a}if(V<1e5){B["spiceRefinery"].max=0}let g=game.space.getBuilding("cryostation").val;let m=ie["eludium"].value;let d=25*Math.pow(1.12,3*(u>1)+9*(u>100)+g+a+Math.sqrt(u*.5));if(m>d){B["cryostation"].max=g+1}if(m<d){B["cryostation"].max=0}let f=B["containmentChamber"];let p=B["heatsink"];let h=ie["antimatter"];let b=game.space.getBuilding("heatsink").val;let v=game.space.getBuilding("containmentChamber").val;p.max=b+1;f.max=v+1;let k=Math.max(50*(1+b*.01),5*v);let y=e<t+k+2;let x=game.prestige.getPerk("numerology").researched&&(game.calendar.cycle===3||game.calendar.cycle===1);if(h.value+50*game.getEffect("antimatterProduction")<h.maxValue||y||x){f.enabled=false;p.enabled=false}if(e<t+20){T.max=0;B["moonOutpost"].max=0;B["moonBase"].max=0}let R=B["orbitalArray"];let w=game["nummon"];if(w){let e=game.space.getBuilding("orbitalArray").val;if(w.getBestUnobtainiumBuilding()===$I("space.planet.piscine.orbitalArray.label")){if(!game.getEffect("shatterTCGain")||e>39||a<2){R.max=e+1}else{R.max=40}}else if(R.max<0){R.max=0}}}if(game.ironWill){T.max=0;B["terraformingStation"].max=0}if(P<3+2*(S>9.7)&&t&&game.getEffect("calcinerRatio")>2){a.build("sattelite",1);ce("sattelite")}if(t){if(!C&&game.space.getBuilding("researchVessel").val<1&&B.sattelite.enabled){a.build("researchVessel",1)}if(game.space.getBuilding("researchVessel").val<4){T.max=0}}}const r={};for(let e in B){r[e]=a.getBuild(e)}const l=t.bulk(B,r,i,"space");let s=0;for(let t in l){let e=l[t];if(e.count>0){a.build(e.id,e.count);s=1}}return s},craft:function(){const t=ae.auto.craft.items;const a=this.craftManager;const e=["ship","parchment","beam","wood","slab","alloy","gear","concrate","steel","plate","scaffold","tanker","manuscript","compedium","blueprint","kerosene","megalith","eludium","thorium"];let i=ae.auto.craft.trigger;let r=!game.science.get("construction").researched||!game.bld.getBuildingExt("workshop").meta.on;let l=ne("iron")===1;let s=i===.95&&X.get("orbitalGeodesy").researched;let n,o,c;this.setTrait("metallurgist");this.setTrait("engineer");for(const g of e){o=t[g];c=o.require?a.getResource(o.require):"noRequire";n=0;if(!o.enabled){continue}if(r&&g!=="wood"){continue}if(!a.getCraft(g).unlocked){continue}let e=i;if(s){e=.9;if(g==="uranium"){e=1}if(g==="plate"&&X.get("spaceManufacturing").researched&&l){e=0}}if(c==="noRequire"||c.value/c.maxValue>=e&&c.value<=2*c.maxValue){n=a.getLowestCraftAmount(g,o.limited,o.limRat,c.name)}else if(o.limited){n=a.getLowestCraftAmount(g,o.limited,o.limRat,false)}if(n>=1){a.craft(g,n)}}let u=ae.auto.upgrade.items.upgrades;if(u.cache&&game.workshop.get(u.cache).researched){u.cache=false}},holdFestival:function(){let t=game.prestige.getPerk("carnivals").researched;let e=t&&(ie["parchment"].value<1e4||ie["culture"].value<15e3);if(!game.science.get("drama").researched||game.calendar.festivalDays>=400){return}if((!t||e)&&game.calendar.festivalDays>1){return}if(game.village.getKittens()<5&&!ie["zebras"].value){return}if(game.ironWill&&!game.prestige.getPerk("numeromancy").researched){return}let a=this.craftManager;let i=4e3*a.getTickVal(ie["manpower"],true)>1500;let r=4e3*a.getTickVal(ie["culture"],true)>5e3;let l=4e3*a.getTickVal(ie["parchment"],true)>2500*3;let s=ie["parchment"].value>=7e3||l||ie["manpower"].perTickCached>18;if(!(i&&r&&s)){return}if(game.science.getPolicy("carnivale").researched){let e=!ie["furs"].value||!ie["ivory"].value||!ie["spice"].value;if(e){return}}let n=game["villageTab"];let o=n.festivalBtn;if(!o||!o.model){return n.render()}let c=o.model.prices;if(game.resPool.hasRes(c)){game.resPool.payPrices(c);let e=t&&ie["culture"].value>1e6?50:1;game.village.holdFestival(e);ae.auto.trade.festival=undefined;ge("festival",1);F(c);if(game.calendar.festivalDays>400){se("festival.extend",[],"festivalFilter")}else{se("festival.hold",[],"festivalFilter")}}else{if(X.get("nanosuits").researched){if(ie["parchment"].value<2500||ie["manpower"].value<1500){ae.auto.trade.festival=true}}}},observeStars:function(){let s=game.calendar;if(s.observeBtn!=null){let e=ie["science"].value;let t=ie["starchart"].value;s.observeHandler();let a="";let i=ie["science"].value-e;if(i){a+="，获得了 "+game.getDisplayValueExt(i)+" 科学"}let r=ie["starchart"].value-t;if(r){a+="，获得了 "+r+" 个星图"}se("act.observe",[a],"astronomicalEventFilter");let l=1;if(Math.random()<.15){let e=dojo.byId("observeButton");s.observeBtn=dojo.create("input",{id:"observeBtn",type:"button",value:$I("navbar.observe")},e);s.observeHandler();l=2}ge("science",i*l,"resGain");ge("starchart",r*l,"resGain");ge("stars",1)}if(game.ironWill||!ue.other["auto.changeLeader"]){let e=ie["catnip"];game.resPool.addRes(e,e.perTickCached+10)}},hunt:function(){let i=ie["manpower"];if(i.value<100||game.challenges.isActive("pacifism")){return}let a=game.getEffect("hunterRatio");if(ne("manpower")>3&&a<3){return}let r=game.bld.getBuildingExt("unicornPasture").meta.val;let l;if(!r){let e=ie["unicorns"].value;let t=game.achievements.get("unicornConspiracy").unlocked||e||a;l=!r&&t&&i.value>1e3&&e<3}let t=ae.auto.options.items.hunt;let e=t.subTrigger;game.resPool.addRes(i,Math.max(2*(e>.9)*i.perTickCached+game.getEffect("manpowerPerTickCon"),0),false);let s=Math.floor(i.value/100);let n=t.subTrigger<=i.value/i.maxValue;let o=!n&&ae.auto.trade.cache;let c=this.craftManager.getAverageHunt();let u=game.science.get("writing").researched;let g=!ie["furs"].value||ie["parchment"].value<Math.max(25,c["ivory"])||game.ironWill?Math.max(30,Math.floor(.5*s)):0;let m=u&&s>g&&g>0&&ne("culture")!==1;if(n||m||l||o||t.time){if(m){s=g;if(!game.ironWill){se("act.hunt.mint","","huntFilter")}}if(l){s=10;le(te("act.hunt.unicorn"))}if(o&&!t.time){s=Math.min(s,Math.max(Math.floor(i.perTickCached/50),1));ae.auto.trade.cache=false;se("act.hunt.trade","","huntFilter")}if(t.time){t.time=false}if(s<=0){return}let e=game.ironWill?ie["zebras"].title:$I("effectsMgr.statics.maxKittens.title");game.resPool.addResEvent("manpower",-s*100);ge("manpower",s*100,"resConsume");let a={};for(let e in c){a[e]=ie[e].value}this.setTrait("manager");game.village.gainHuntRes(s);this.setTrait();if(s>=1e3){game.challenges.getChallenge("pacifism").unlocked=true}if(ae.auto.cache.trait["manager"]){se("act.hunt",["管理者派出 "+s,e],"huntFilter");ge("hunt.manager",s)}else{ge("hunt",s);se("act.hunt",[s,e],"huntFilter")}const d={};for(let t in c){let e=ie[t].value-a[t];d[t]=e;ge(t,e,"resGain")}this.cacheManager.pushToCache({materials:d})}},trade:function(){let a={};let i=ue.other["auto.changeLeader"]?0:2;for(let t in ie){let e=ie[t];game.resPool.addRes(e,Math.max(i*e.perTickCached+game.getEffect(t+"PerTickCon"),0),false);a[t]=e.value}let r;const l=this.craftManager;const s=this.tradeManager;const e=this.cacheManager;let L=l.getResource("gold");let n=[];let t=ae.auto.trade;let o=t.trigger;if(!s.singleTradePossible(undefined)){return}let c=game.calendar;let u=c.getCurSeason().name;let g=ne("gold");let m=ne("titanium");let d=o<=g;let f;this.setTrait("merchant");let p=0;let h=oe.getSolarRevolutionRatio();let b=ie["faith"].value;let v=game.challenges.anyChallengeActive();let k=game.getEffect("priceRatio");let y=k<-.06;let x=h||v&&!b||ie["gold"].maxValue<450-y*15*(b>0);let R=X.get("spaceManufacturing").researched;let w=!game.ironWill&&R&&h&&ie["concrate"].value>1e4/(1+h);let U=oe.getRU("stainedGlass").on||!h||b<200;let D=ie["faith"].value;let T=ae.auto.faith.items;let I=oe.getRU("transcendence").on||!T.transcendence.enabled||!game.getEffect("unobtainiumPerTickSpace");let O=oe.getRU("apocripha").on||!T.apocripha.enabled||oe.faithRatio>.22||oe.faith<1e5;let W=game.workshop.get("miningDrill").researched;let z=I&&O;let G=z||oe.transcendenceTier>9||game.village.sim.kittens.length<130;let E,F,M,P;let B=t.items;for(M in B){E=B[M];F=s.getRace(M);if(!F.unlocked){continue}if(!game["diplomacyTab"].racePanels[p]){game["diplomacyTab"].render()}p++;if(M==="nagas"&&w){continue}if(M==="dragons"&&h>2&&m<.7&&ne("uranium")>.1){continue}if(M==="lizards"&&h>.2){continue}if(M==="sharks"&&!v&&h>3&&!E.limited){continue}if(!E.enabled){continue}let e=E[u];if(!e){continue}let t=s.getTradeButton(F.name);if(!t){continue}P=E.require?l.getResource(E.require):false;if((!P||o<=P.value/P.maxValue)&&d){n.push(M)}else if(E.limited&&x&&G&&U){if(M==="sharks"&&F.embassyLevel<10){continue}if(s.getProfitability(M)){n.push(M);if(M!=="leviathans"||M==="zebras"&&!ie["titanium"].value){f=true}}}}let C=ie["catnip"].value+100*game.getResourcePerTick("catnip",true);if(C<0&&game.deadKittens<1e3&&!game.ironWill){let a=game.diplomacy.get("sharks");if(a.unlocked){let e=s.getLowestTradeAmount("sharks");let t=s.getAverageTrade(a).catnip;s.trade("sharks",Math.max(Math.ceil(C/-t),e,1));se("trade.catnip")}}if(n.length===0){return}f=f&&!d?.3+.05*y+.1*!h*(1+2*game.science.get("theology").researched)+.05*game.workshop.get("geodesy").researched:1;let S=Math.floor(s.getLowestTradeAmount(undefined,true,false)*f);if(v&&game.science.get("architecture").researched&&!ie["furs"].value){return}if(t.festival&&!c.festivalDays&&ie["parchment"].value>2500){return}if(S<1){return}const V=[];for(r=0;r<n.length;r++){M=n[r];E=ae.auto.trade.items[M];P=E.require?l.getResource(E.require):false;let e=(!P||o<=P.value/P.maxValue)&&o<=g;let t=Math.floor(s.getLowestTradeAmount(M,E.limited,e)*f);if(t<1){n.splice(r,1);r--;continue}V[r]=t}let J=n.length;if(!n.length){return}let q=game.getEffect("shatterTCGain");let j=ie["steel"].value>ie["plate"].value&&!q&&c.season!==2||ne("coal")>.99;let H=J>1&&!q&&(!h&&game.getEffect("unobtainiumPerTickSpace")||ne("uranium")>.4);let N=ie["plate"].value>10*ie["steel"].value&&m>.5&&ie["titanium"].value>1e4;let K=c.season>1&&m>.5+.4*R;const A={};while(n.length>0&&S>=1){if(S<n.length){let e=Math.floor(Math.random()*n.length);if(!A[n[e]]){A[n[e]]=0}A[n[e]]+=1;S-=1;n.splice(e,1);V.splice(e,1);continue}let e=Math.floor(S/n.length);let t=0;for(r=0;r<n.length;r++){if(V[r]<e){e=V[r];t=r}}M=n[t];if(M==="spiders"&&j){e=Math.floor(.2*e)}if(M==="dragons"&&H){e=Math.floor(.2*e)}if(M==="zebras"){if(N){e=Math.floor(.3*e)}if(K){e=Math.min(Math.ceil(h),e)}}if(!A[M]){A[M]=0}A[M]+=e;S-=e;n.splice(t,1);V.splice(t,1)}if(A.length===0){return}if(g>=.98){t.cache=true}for(let e in A){if(A[e]>0){s.trade(e,A[e])}}let _=ae.auto.cache.cacheSum.manpower;const $={};let Y=d||!_?.01:1-.4*y;for(let t in ie){let e=ie[t].value-a[t];if(e){$[t]=e*Y;if(e>0){ge(t,e,"resGain")}if(e<0){ge(t,-e,"resConsume")}}}e.pushToCache({materials:$})},miscOptions:function(){const u=this.craftManager;const i=this.buildManager;const r=ae.auto.options.items;let g=0;let t=ae.auto.cache;let e=t.dataTimer;let a=game.timer.ticksTotal;let l=e.ticksTotal;let s=game.calendar.trueYear();let n=game.telemetry.guid;if(a-l<0||e["trueYear"]>s||e["saveId"]!==n){t.dataTimer={};t.cacheSum={};ae.auto.filter.console={};j();me();t.resUpg={};this.leaderTimer=0;this.leader=0;ae.auto.upgrade.items.upgrades.cache=null;let e=t.dataTimer;e["saveId"]=n;e["ticksTotal"]=a;e["trueYear"]=s}if(a-l>2e4){e.ticksTotal=a;ae.auto.cache.cacheSum={};ce("changeLeader",true)}let o=ae.auto.filter;let m=oe.transcendenceTier;if(r.filterGame.enabled&&o.enabled&&m>3){let i=o.items;let r=o.console;let l=game.console.filters;for(let a in l){let e=i[a+"Filter"];let t=l[a];if(!t.unlocked||e&&!e.enabled||r[a]){continue}t.enabled=false;r[a]=true;g=1}if(g){game.ui.renderFilters()}}e:if(r.buildEmbassies.enabled&&!!game.diplomacy.races[0].embassyPrices&&(game.ironWill||game.science.get("theology").researched)){let e=ie["culture"];let t=e.value/e.maxValue;let a=r.buildEmbassies.subTrigger;let o=t>Math.max(.97,ae.auto.craft.trigger);let c=Math.sqrt(oe.getSolarRevolutionRatio()+1);let i=e.value>5e3+5e3*(m>5)+5e3*Math.sqrt(2*oe.getSolarRevolutionRatio());if(r.buildEmbassies.subTrigger<=t&&t<2||i){let i,r,t,l;const B=game["diplomacyTab"].racePanels;let s=u.getValueAvailable("culture",true);const C={};const S=[];const V=B.length-(game.diplomacy.get("leviathans").unlocked?1:0);let a=ae.auto.trade.items;for(i=V-1;i>-1;i--){if(!B[i].embassyButton){game["diplomacyTab"].render();continue}r=B[i].race.name;t=game.diplomacy.get(r);if(!o&&!a[r].enabled){continue}let e=1-game.getEffect("embassyCostReduction");C[r]={val:0,basePrice:t.embassyPrices[0].val*e,currentEm:t.embassyLevel,priceSum:0,race:t};S.push(r)}if(S.length===0){break e}let n=game.science.get("astronomy").researched;while(S.length>0){for(i=0;i<S.length;i++){r=S[i];l=C[r];let e=l.currentEm+l.val;let t=l.basePrice*Math.pow(1.15,e+game.getEffect("embassyFakeBought"));let a=true;if(!o){if(e>14+c-10*(r==="zebras")&&n||r==="sharks"&&c>2&&!game.getEffect("unobtainiumPerTickSpace")&&ie["furs"].value||r==="dragons"&&!game.getEffect("unobtainiumPerTickSpace")){a=false}}if(t<=s&&a){s-=t;l.priceSum+=t;l.val+=1;if(o){S.splice(i,1);i--}}else{S.splice(i,1);i--}}}for(r in C){l=C[r];if(l.val===0){continue}s=u.getValueAvailable("culture",true);if(l.priceSum>s){continue}ie["culture"].value-=l.priceSum;ge("culture",l.priceSum,"resConsume");l.race.embassyLevel+=l.val;ge("embassy",l.val);g+=1;if(l.val===1){le(te("build.embassy",[l.val,l.race.title]),"embassyFilter")}else{le(te("build.embassies",[l.val,l.race.title]),"embassyFilter")}}}}if(r.fixCry.enabled&&game.time.getVSU("usedCryochambers").val>0){let e=0;const q=game["timeTab"].vsPanel.children[0].children[0];while(q.controller.buyItem(q.model,{},function(){})){e+=1}if(e>0){se("act.fix.cry",[e],"ks-fixCry");ge("fix.cry",e)}}let c;let d=(e,t,a)=>{le(te("summary."+e,[t]));ge(e,t);if(a){c=i.getBuildButton(e);if(c){c.controller.onAll(c.model)}}};let f=game.bld.getBuildingExt("mint").meta;if(f.on!==f.val&&ie["manpower"].maxValue>4e4){f.on=f.val}if(f.on>1&&ie["manpower"].maxValue<25e3&&!game.challenges.isActive("pacifism")){if(!game.opts.enableRedshift){f.on=0;d("mint")}}let p=game.bld.getBuildingExt("factory").meta;if(p.val&&p.on!==p.val&&game.workshop.get("spaceManufacturing").researched){d("factory",undefined,true)}let h=game.bld.getBuildingExt("magneto").meta;let b=game.getResourcePerTick("oil",true)>.05*h.val;let v=game.bld.cathPollution>5e6&&game.bld.cathPollutionPerTick>50;if(h.val&&!h.on&&b&&v&&!p.isAutomationEnabled){d("magneto",undefined,true)}let k=game.bld.getBuildingExt("steamworks").meta;if(k.val&&k.on!==k.val&&h.on>9){d("steamworks",undefined,true)}let y=game.bld.getBuildingExt("reactor").meta;let x=game.getResourcePerTick("uranium",true);if(y.val&&y.on!==y.val&&x>0){d("reactor",undefined,true)}let R=game.time.getCFU("temporalAccelerator");if(R.on&&!game.time.testShatter){R.isAutomationEnabled=true;game.time.testShatter=1;d("temporalAccelerator")}let w=game.resPool.energyProd;let T=game.bld.getBuildingExt("biolab").meta;let E=T.on&&game.workshop.get("biofuel").researched;let F=u.getPotentialCatnip();F=ae.auto.distribute.religion||F<0&&ie["catnip"].value+1e3*F<0;if(E&&F){le(te("summary.biolab.test",[""])+"(猫薄荷产量过低)");T.on=0}if(w&&w<game.resPool.energyCons){if(E&&T.on){let e="冬季产出电:"+game.getDisplayValueExt(w)+"，消耗电:"+game.getDisplayValueExt(game.resPool.energyCons)+"，小猫担心电不够并关闭了";let t=T.on;se("summary.biolab.test",[e+t]);T.on=0;ge("biolab.test",e+t);return 1}let e=game.bld.getBuildingExt("oilWell").meta;if(e.isAutomationEnabled&&game.workshop.get("pumpjack").researched){e.isAutomationEnabled=false;game.upgrade({buildings:["oilWell"]});game.resPool.update();d("pumpjack",1);return 1}let t=game.bld.getBuildingExt("accelerator").meta;if(t.on){t.on-=Math.ceil(t.on*.5);d("accelerator",1)}}let M=ie["spice"].value;const P=[{name:"brewery",metadata:game.bld.getBuildingExt("brewery").meta,Button:i.getBuildButton("brewery"),conditionOn:game.calendar.festivalDays&&M>1e4,conditionOff:game.bld.getBuildingExt("brewery").meta.on&&(!game.calendar.festivalDays||!M)}];if(!game.opts.enableRedshift){P.push({name:"chronocontrol",metadata:game.time.getVSU("chronocontrol"),Button:this.timeManager.getBuildButton("chronocontrol"),conditionOn:game.calendar.futureSeasonTemporalParadox<1&&game.calendar.day>98,conditionOff:game.time.getVSU("chronocontrol").on&&game.calendar.day>0});let e=game.bld.getBuildingExt("calciner").meta;if(!game.time.getCFU("ressourceRetrieval").on&&e.isAutomationEnabled){e.isAutomationEnabled=false;game.upgrade({buildings:["calciner"]});d("calciner")}}for(let e=0;e<P.length;e++){let t=P[e];if(t.metadata.val>0){if(t.conditionOn){let e=t.metadata.val-t.metadata.on;if(e){t.Button.controller.onAll(t.Button.model);le(te("summary."+t.name+"On"));ge(t.name)}}else if(t.conditionOff){t.Button.controller.offAll(t.Button.model);le(te("summary."+t.name+"Off"));ge(t.name)}}}return g},gameUpgrade:function(){let e=performance.now();let t=ae.auto;let a=t.upgrade.items.upgrades;let i=t.cache;let r=i.upgrade;if(r){game.upgrade(r);for(let e in r){delete r[e]}i.upgrade=null}else{game.updateCaches()}if(a.update){game.updateCaches();a.update=null}let l=performance.now()-e;this.time+=l},calculateTime:function(){let e=this.time;let t=performance.now()-e;ue.ksTime+=t;ue.totalTicks++;ae.auto.cache.stocks=null},setTrait:function(i){let t=game.village.leader;let e=ae.auto;let a=e.distribute;if(!e.options.items.promote.enabled||!a.enabled||!a.items.leader.enabled){if(t){return ce("changeLeader")}}if(i){if(game.science.get("civil").researched&&t&&!game.challenges.isActive("anarchy")){let a=ae.auto.cache;let e=game.village.traits.some(e=>{return e.name===i});if(!a.trait[i]){if(e){a.trait[i]=true;let e=$I("village.bonus.desc."+i);let t=["当"+e.slice(0,2)+"项目时"+$I("village.trait."+i)+"猫猫自觉顶替当前领袖，其效果为"+e];if(game.ticks>1e4){ce("leader",true)}else{ce("leader","","leaderFilter")}se("set.leader",[t],"leaderFilter")}}if(!ae.copyTrait){let e=t.trait.name;ae.copyTrait=e;a.trait[e]=true}if(!e){a.trait[i]=false}if(e||ae.copyTrait===i){t.trait.name=i}}}else if(ae.copyTrait&&t){if($I("village.trait."+ae.copyTrait)===t.trait.title){t.trait.name=ae.copyTrait;ae.copyTrait=undefined}}},catnipForReligion:function(e){let t=e||0;let a=1;let i=oe.getRU("transcendence").on;let r=i?oe.transcendenceTier:0;if(t){r+=1}let l=oe.faithRatio;let s=oe.faith/1e6*(r+1)*(r+1)*1.01;let n=l+s-t;let o=.01+ie["faith"].value*(1+game.getUnlimitedDR(n,.1)*.1);let c=game.getLimitedDR(game.getUnlimitedDR(o,1e3)/100,10+game.getEffect("solarRevolutionLimit"));if(r<10){a=game.village.getResConsumption()["catnip"]*(1+game.getEffect("catnipDemandRatio"));if(game.village.sim.kittens.length>0&&game.village.happiness>1){a+=a*Math.max(game.village.happiness*(1+game.getEffect("hapinnessConsumptionRatio"))-1,0)*(1+game.getEffect("catnipDemandWorkerRatioGlobal"))}let e=1+oe.getSolarRevolutionRatio()*(1+game.bld.pollutionEffects["solarRevolutionPollution"]);a=(ie["catnip"].perTickCached-a)*(1+c)/e+a+game.globalEffectsCached.catnipPerTickCon}if(a<0&&ie["catnip"].value+1e3*a<0){let e=ae.auto.faith;if(!ae.auto.distribute.religion){ae.auto.distribute.religion=true}if(t){se("summary.transcend.catnip",[game.getDisplayValueExt(a*5)]);ue.other["transcend.catnip"]=a*5}if(!t){se("summary.adore.catnip",[game.getDisplayValueExt(a*5)]);ue.other["adore.catnip"]=a*5}}return a},getBestUnicornBuilding:function(){let u=game.bld.getBuildingExt("unicornPasture").meta;if(!u.unlocked){return}let g=Infinity;let m="";let d=1-game.getEffect("goldCostReduction");let e=game.bld.getBuildingExt("ziggurat").meta.on;let f=Math.max(e,1);let p=game.getEffect("unicornsRatioReligion")+1;let t=500*(.9+p*.1);let h=game.prestige.getPerk("unicornmancy").researched?1.1:1;let b=game.getEffect("riftChance")*h/2e4*t;let a="unicorns";let v=ie["unicorns"];let i=v.perTickCached;let r=game.calendar.cycleEffectsFestival({unicorns:1})["unicorns"];let k=v.perTickCached*game.getTicksPerSecondUI()/r;if(!k){return u}let l=k/Math.max(1,u.val);let y=2*Math.pow(u.priceRatio+game.getEffect("priceRatio"),u.val);l=y/l;let s=1.5*game.prestige.getParagonProductionRatio()+1.5;let x=ie["tears"].value+v.value*2500/f>Math.max(1e6,s*ie["ivory"].value);x=x||ie["ivory"].perTickCached*s*r<i&&ie["manpower"].maxValue>2e4;x&=ie["alicorn"].unlocked;let R="tears";if(x){R="ivory";a="ivory"}l=x?l*3e3:l;if(l<g){g=l;m=u}e:for(let e=0;e<6;e++){let c=oe.meta[0].meta[e];if(c.unlocked){let r,l=0;let s=p;if(!c.effects["unicornsRatioReligion"]){continue}if(x&&!c.effects["alicornChance"]){continue}let n=Math.pow(1.15,c.on);for(let i=0;i<c.prices.length;i++){let e=c.prices[i];let t=e.name;let a=e.val;if(t===R){l+=a*n*2500/f;s+=c.effects["unicornsRatioReligion"]}if(t==="gold"&&a*d*n>ie["gold"].maxValue){continue e}if(t==="tears"){r=a*n*2500/f}}let e=game.getEffect("riftChance");let t=c.effects;if(t.riftChance){e+=t.riftChance}let a=50*s+450;let i=e*h/2e4*a;i-=b;let o=k*s/p;o-=k;o+=i;o=l/o;if(x&&t.tcRefineRatio){o*=.5-t.tcRefineRatio}if(o<g){g=o;m=c}if(x&&v.value>r+y){m=u}}}if(e){let e=m.label||"独角兽牧场";e+="("+te("$resources."+a+".title")+"性价比)";if(ue.other["auto.unicorn"]!==e){ue.other["auto.unicorn"]=e;se("summary.auto.unicorn",[e],"unicornSacrificeFilter")}}return m}};let e=function(e){this.setTab(e)};e.prototype={tab:undefined,render:function(){if(this.tab&&game.ui.activeTabId!==this.tab.tabId&&!this.tab._inherited){setTimeout(()=>{this.tab.render()},200+Math.max(-Date.now()+game.timer.timestampStart,-200))}},setTab:function(e){for(const t in game.tabs){if(game.tabs[t].tabId===e){this.tab=game.tabs[t];break}}this.tab?this.render():l("unable to find tab "+e)}};let C=function(){this.manager=new e("Religion");this.bulkManager=new a};C.prototype={manager:undefined,bulkManager:undefined,build:function(e,t,a){let i=this.getBuild(e,t);let r=this.getBuildButton(e,t);if(!r||!r.model.metadata){return game["religionTab"].render()}let l=r.model;if(!l.enabled){l.prices=r.controller.getPrices(l);r.controller.updateEnabled(l);if(!l.enabled){return}}a=this.bulkManager.construct(l,r,a);if(a===0){return}F(l.prices);game.stats.getStat("totalClicks").val+=1;let s=i.label;if(t==="s"){if(ae.auto.cache.trait["wise"]){ge("哲学家小猫祷告了 "+s,a,"faith");return se("act.sun.discovers.leader",[s,a],"faithBuildFilter")}if(a===1){se("act.sun.discover",[s],"faithBuildFilter")}else{se("act.sun.discovers",[s,a],"faithBuildFilter")}ge("小猫祷告了 "+s,a,"faith")}else{ge(s,a,"build");if(a===1){se("act.build",[s],"buildFilter")}else{se("act.builds",[s,a],"buildFilter")}}},getBuild:function(e,t){switch(t){case"z":return oe.getZU(e);case"s":return oe.getRU(e);case"c":return oe.getTU(e)}},getBuildButton:function(e,t){let a,i,r;switch(t){case"z":a=this.manager.tab.zgUpgradeButtons;break;case"s":a=this.manager.tab.rUpgradeButtons;break;case"c":a=this.manager.tab.children[0].children[0].children}let l=this.getBuild(e,t);for(i=0;i<a.length;i++){if(!a[i]){continue}r=a[i].model.name;if(r.indexOf(l.label)!==-1){return a[i]}}}};let S=function(){this.manager=new e("Time");this.crafts=new t;this.bulkManager=new a};S.prototype={manager:undefined,crafts:undefined,bulkManager:undefined,build:function(e,t,a){let i=this.getBuild(e,t);let r=this.getBuildButton(e,t);if(!r||!r.model.metadata){return game["timeTab"].render()}if(!r.model.enabled){return r.controller.updateEnabled(r.model)}let l=a;let s=i.label;a=this.bulkManager.construct(r.model,r,a);if(a===0){return}F(r.model.prices);ge(s,a,"build");if(a===1){se("act.build",[s],"buildFilter")}else{se("act.builds",[s,a],"buildFilter")}},getBuild:function(e,t){if(t==="chrono"){return game.time.getCFU(e)}else{return game.time.getVSU(e)}},getBuildButton:function(e,t){let a;if(t==="chrono"){a=this.manager.tab.children[2].children[0].children}else{a=this.manager.tab.children[3].children[0].children}const i=this.getBuild(e,t);for(let t in a){let e=a[t].model.name;if(e.indexOf(i.label)!==-1){return a[t]}}}};let d=function(){this.workManager=new e("Workshop");this.sciManager=new e("Science");this.crafts=new t};d.prototype={manager:undefined,crafts:undefined,build:function(t,e){let a;const i=this.getBuildButton(t,e);if(!i||!i.model.metadata){if(e==="workshop"){game["workshopTab"].render()}else{game["libraryTab"].render()}return}if(!i.model.enabled){i.model.prices=i.controller.getPrices(i.model);i.controller.updateEnabled(i.model);if(!i.model.enabled){return}}if(e==="policy"){let t=i.model.metadata;if(t.name==="theocracy"&&!game.village.leader){return}if(game.village.leader&&t.requiredLeaderJob&&game.village.leader.job!==t.requiredLeaderJob){let e=game.village.getJob(t.requiredLeaderJob).title;game.msg($I("msg.policy.wrongLeaderJobForResearch",[t.label,e]),"important");return}else if(t.name==="transkittenism"&&game.bld.getBuildingExt("aiCore").meta.effects["aiLevel"]>=15){game.msg($I("msg.policy.aiNotMerges"),"alert","ai");return}else if(t.blocked===false){for(a=0;a<t.blocks.length;a++){if(game.science.getPolicy(t.blocks[a]).researched){t.blocked=true;return}}}}let r=ae.auto.upgrade.items.upgrades;i.model.prices=i.controller.getPrices(i.model);i.controller.payPrice(i.model,{},function(){});F(i.model.prices);let l=i.model.metadata;l.researched=true;if(l.handler){l.handler(game,l)}if(l.unlocks){game.unlock(l.unlocks)}if(l.blocks){for(a in l.blocks){let e=game.science.getPolicy(l.blocks[a]);e.blocked=true}}if(l.onResearch){l.onResearch(game)}if(l.upgrades){if(e==="workshop"&&!r.update){r.update=true}E(l.upgrades)}game.stats.getStat("totalClicks").val+=1;let s=t.label;let n=ae.auto.cache.trait["scientist"];let o=n?"科学家小猫":"小猫";n=n?1:0;if(e==="workshop"){ge(s,n,"upgrade");se("upgrade.upgrade",[s,o],"upgradeFilter");let e=t.name;if(e===r.cache){r.cache=false;let t=ae.auto.cache.resUpg;for(let e in ae.auto.cache.resUpg){delete t[e]}}if(l.effects&&l.effects["hutPriceRatio"]&&game.ui.activeTabId!=="Bonfire"){game["bldTab"].render()}}else if(e==="science"){ge(s,n,"research");se("upgrade.tech",[s,o],"researchFilter")}else if(e==="policy"){se("upgrade.policy",[s],"policyFilter")}},getValue:function(e,t){let a=ae.auto.resources[e];let i=a&&a.enabled?a.stock:0;let r=ae.auto.upgrade.items.upgrades.cache;if(ae.auto.craft.oxidation&&t!=="oxidation"){if(e==="science"&&ie["steel"].value>5e3&&ie["science"].value>5e4){i+=1e5}if(e==="steel"){i+=5e3}}if(e==="titanium"&&t!=="rotaryKiln"){if(t!=="rotaryKiln"){if(!game.workshop.metaCache["rotaryKiln"].researched&&game.workshop.get("orbitalGeodesy").researched){i+=5e3}}if(r==="orbitalGeodesy"&&r!==t){if(t!=="pumpjack"){i+=1e3}else if(ie["oil"].value>3e4){i+=1e3}}if(r==="concreteHuts"&&r!==t){i+=3e3}}if(e==="iron"&&t!=="ironwood"){if(ue.other["auto.ironwood"]&&ie["science"].value>1e4){i+=3e3}}if(e==="alloy"){if(r&&r!==t){i+=ae.auto.cache.resUpg[e]}}if(e==="oil"){if(t!=="orbitalGeodesy"&&game.bld.getBuildingExt("calciner").meta.val>20&&!game.workshop.metaCache["orbitalGeodesy"].researched){i+=35e3}}return Math.max(ie[e].value-i,0)},getBuildButton:function(a,e){let i;if(e==="workshop"){i=this.workManager.tab.buttons}else if(e==="science"){i=this.sciManager.tab.buttons}else if(e==="policy"){i=this.sciManager.tab.policyPanel.children}for(let t of i){let e=t.model.name;if(e===a.label){return t}}}};let V=function(){this.manager=new e("Bonfire");this.crafts=new t;this.bulkManager=new a};V.prototype={manager:undefined,crafts:undefined,bulkManager:undefined,built:function(e,t,a){let i=this.getBuild(e);let r=this.getBuildButton(e,t);if(!i.meta.unlocked){return}if(!r||!r.model.metadata){game["bldTab"].activeGroup="all";if(!r||!r.model.metadata){return game["bldTab"].render()}}if(!r.model.enabled){return r.controller.updateEnabled(r.model)}let l=i.meta.label?i.meta.label:i.meta.stages[t].label;a=this.bulkManager.construct(r.model,r,a);if(a===0){return}F(r.model.prices);ge(l,a,"build");game.stats.getStat("totalClicks").val+=1;if(a===1){se("act.build",[l],"buildFilter")}else{se("act.builds",[l,a],"buildFilter")}},count:function(s,n){if(!n){return}let r;let o=X.get("geodesy").researched;let l=X.get("orbitalGeodesy").researched;let c=X.get("spaceManufacturing").researched;let a=game.getEffect("priceRatio");let u=a<-.06;let e=ne("titanium")>.9;let i=oe.getSolarRevolutionRatio();let t=e=>{if(u){if(!l&&game.bld.getBuildingExt(e).meta.val){r=true;ce("lower")}else if(l){ce("lower",true)}}};switch(s){case"hut":case"logHouse":{let e=ie["catnip"];let t=this.crafts.getPotentialCatnip(false);let a=game.challenges.isActive("anarchy");let i=game.village.happiness;let r=e.value<3e3+i*100&&e.perTickCached<1.7*i*(1+2*a)&&(!game.science.get("agriculture").researched||a);let l=t<1&&e.value+t*1e3*(ne("catnip")<.1)-1e3<0;if((r||l)&&!o){n=0;ce("kittens")}else{ce("kittens",true)}if(s==="logHouse"){let e=game.bld.getBuildingExt("amphitheatre").meta;if(e.val<5&&!e.stage&&e.unlocked&&game.village.happiness<3&&game.village.maxKittens>25){ce("logHouse");return 0}}break}case"workshop":if(!l&&u){let e=game.bld.getBuildingExt("amphitheatre").meta;if(!e.stage&&ie["parchment"].value>3*Math.pow(e.stages[0].priceRatio+game.getEffect("priceRatio"),e.val)&&e.val<8+5*(a<-.08)&&ne("minerals")<.9&&!game.ironWill){r=true}}break;case"pasture":if(!l&&(o||ie["wood"].perTickCached&&u)){if(ne("wood")<.9){if(u&&!i){n*=.5}r=true;ce("pasture")}}break;case"aiCore":n=1;break;case"temple":if(ne("gold")<.8&&X.get("miningDrill").researched&&l){r=true;n*=.4}else{n=1}break;case"mint":if(ne("gold")<.95&&game.getEffect("manpowerPerTickCon")<-2){r=true;n*=.2+.1*c+.1*e}break;case"field":if(!l&&game.bld.getBuildingExt(s).meta.val>35+85*u){if(ie["catnip"].value<3e3+game.village.happiness*100){n=Math.floor(n*.3);r=true}}else{return n}break;case"chapel":if(s==="chapel"){if(game.bld.getBuildingExt(s).meta.val<19+i+2*o){break}else{if(!game.calendar.festivalDays){n=0}if(!l){n*=.4-.06*o;r=true}}}break;case"aqueduct":{if(this.crafts.getPotentialCatnip(false)<4*game.village.happiness&&ne("catnip")<.6||game.challenges.isActive("winterIsComing")){break}else if(!c){if(ie["slab"].value<4e5*(1+i)){n=Math.floor(n*.4-.05*u);ce("aqueduct")}}t(s)}break;case"library":{if(s==="library"&&!game.science.get("writing").unlocked){break}}case"academy":if(s==="academy"&&ie["paragon"].value&&ne("science")<1&&!l){if(game.bld.getBuildingExt(s).meta.val>20+20*u){r=true;n*=.9}if(u&&i<1){n*=.5}}case"barn":{if(s==="barn"&&ie["minerals"].maxValue<1600){break}let e=ie["minerals"].value>ie["minerals"].maxValue*.94;let t=ie["wood"].value>ie["wood"].maxValue*.94;if(e&&t){break}}case"warehouse":if(s==="warehouse"){if(ie["minerals"].maxValue<5e4){if(X.get("deepMining").researched||game.bld.getBuildingExt(s).meta.val<20){break}}else if(u&&!c){n=Math.floor(n*.3)}}case"lumberMill":if(s==="lumberMill"){if(game.bld.getBuildingExt(s).meta.val<55-12*u-10*!o){if(!game.getEffect("lumberMillRatio")&&game.bld.getEffect("woodRatio")>3.1&&ie["iron"].maxValue>1200){n=0}if(ie["gold"].value||game.getEffect("ironPerTickAutoprod")<.3){break}if(u&&!game.science.get("astronomy").researched&&ie["faith"].value){r=true}}else if(!c&&ne("iron")<.5-3*a){r=true;ce("lumberMill")}}case"oilWell":if(s==="oilWell"){let e=game.bld.getBuildingExt(s).meta.val;let t=ie["oil"];let a=t.value;let i=t.maxValue;if(e<9+u||t.maxValue<2e4){break}if(!c){let e=game.getEffect("calcinerRatio");if(e>1){if(!l&&a<3e4||e>2&&i<5e4){return n}}}if(e<199){if(i>9e4){n=Math.floor(n*.5)}else if(i>2e4&&game.getEffect("calcinerRatio")<2){r=true}}}t(s);break;case"quarry":if(X.get("nuclearSmelters").researched&&!c){n*=.5;r=true}t(s);break;case"harbor":if(s==="harbor"){let e=game.bld.getBuildingExt(s).meta.val;let t=game.bld.getBuildingExt("reactor").meta.val;if(e<6&&i<1){return 1}if(e<15){ce("harbor");r=true}else if(t<30){r=true;if(i>7.5){n*=.2}}else if(c){ce("harbor",true)}if(e>60+t&&ne("iron")<.9){n=Math.floor(n*.5)}}break;case"biolab":if(c){if(ie["starchart"].value<2e6){n*=.5;r=true}}else{if(a&&ie["starchart"].value<1e6){r=true;if(u){n*=.3}}}break;case"factory":{let t=game.bld.getBuildingExt(s).meta.val;if(c){if(!game.space.getBuilding("sattelite").val&&t&&!i){ae.auto.space.items["sattelite"].enabled=true;n=0}if(game.getEffect("productionRatio")<1){r=true;if(game.getEffect("productionRatio")<.5){return 0}}}else{if(!e){if(t){let e=game.getEffect("productionRatio");if(i&&X.get("nuclearSmelters").researched){if(e>.6||o){if(t<11+e-2*u){return n}}}n*=.7+(2+3*(t>6))*a;r=true;ce("factory")}else{n=1}}}break}case"accelerator":if(!X.get("energyRifts").researched){n=0}if(!c){if(!e){n*=.9;r=true}if(ie["titanium"].maxValue>13e4){n=0}}else if(!game.space.getProgram("piscineMission").on){n=0}else if(!e&&ie["titanium"].maxValue>13e4){r=true}break;case"mansion":u=u||!u&&o&&game.village.sim.kittens.length>140;if(!e&&u){if(!c&&game.prestige.getParagonProductionRatio()>1){ce("mansion");r=true}if(ie["kittens"].value>200){n*=.5;r=true}if(ie["starchart"].perTickCached<4&&s==="mansion"){r=true}}break}if(r){n=Math.floor(n*.5)}else if(!i&&!o){n=Math.ceil(n*.5)}return n},getBuild:function(e){return game.bld.getBuildingExt(e)},getBuildButton:function(e,t){let a=this.manager.tab.children;let i=this.getBuild(e);let r=typeof t==="undefined"?i.meta.label:i.meta.stages[t].label;for(const l in a){let e=a[l].model.name;if(e.indexOf(r)!==-1){return a[l]}}},getSumPrices:function(e,t){let a=e.priceRatio?e.priceRatio:e.stages[e.stage].priceRatio;let i=a+game.getEffect("priceRatio");return(t.val-t.val*Math.pow(i,e.val-1))/(1-i)},sellBuild:function(e){let i=this.getBuild(e).meta;let r=i.stages[i.stage].prices;for(let a=0;a<r.length;a++){let t=r[a];let e=ie[t.name];if(e.isRefundable()&&!t.isTemporary&&i.val){let e=this.getSumPrices(i,t);game.resPool.addResEvent(t.name,e*.5)}}i.on=0;i.val=0}};let q=function(){this.manager=new e("Space");this.crafts=new t;this.bulkManager=new a};q.prototype={manager:undefined,crafts:undefined,bulkManager:undefined,build:function(e,t){let a=this.getBuild(e);let i=this.getBuildButton(e);if(!a.unlocked||!ae.auto.space.items[e].enabled){return}if(!i||!i.model.metadata){return game["spaceTab"].render()}if(!i.model.enabled){return i.controller.updateEnabled(i.model)}let r=t;let l=a.label;t=this.bulkManager.construct(i.model,i,t);if(t===0){return}F(i.model.prices);ge(l,t,"build");game.stats.getStat("totalClicks").val+=1;if(t===1){se("act.build",[l],"spaceFilter")}else{se("act.builds",[l,t],"spaceFilter")}},getBuild:function(e){return game.space.getBuilding(e)},getBuildButton:function(t){const a=this.manager.tab.planetPanels;for(const i in a){for(let e in a[i].children){if(a[i].children[e].id===t){return a[i].children[e]}}}}};let t=function(){this.cacheManager=new b};t.prototype={craft:function(t,a){a=Math.floor(a);if(!t||a<1){return}if(!this.canCraft(t,a)){return}let e=this.getCraft(t);let i=game.getResCraftRatio(e.name)+1;let r=ae.auto.cache.trait["engineer"]&&game.village.leader;let l=r?"工匠小猫制作了 ":"小猫制作了 ";a=Math.ceil(a);let s=a*i;let n=dojo.clone(game.workshop.getCraftPrice(e));for(let t=n.length-1;t>=0;t--){let e=n[t];e.val*=a;ge(e.name,e.val,"resConsume")}if(r){let e=game.village.getEffectLeader("engineer",0);if(ie[t].tag==="metallurgist"&&ae.auto.cache.trait["metallurgist"]){s+=a*e;l="冶金学家小猫制作了 "}if(ie[t].tag==="chemist"&&ae.auto.cache.trait["chemist"]){s+=.5*a*e;l="化学家小猫制作了 "}}game.resPool.payPrices(n);game.resPool.addResEvent(e.name,s);if(e.upgrades){E(e.upgrades)}let o=game.stats;o.getStat("totalCrafts").val++;o.getStatCurrent("totalCrafts").val++;o.getStat("totalClicks").val+=1;let c=ie[t].title;a=s;if(r){ge(c,a,"craftLeader")}else{ge(c,a,"craft")}se("act.craft",[l+game.getDisplayValueExt(a),c],"craftFilter")},canCraft:function(e,r){let t=this.getCraft(e);let l=false;if(t.unlocked){l=true;let i=game.workshop.getCraftPrice(t);for(let a in i){let e=i[a];let t=ie[e.name].value;if(t<e.val*r){l=false}}}return l},getCraft:function(e){return game.workshop.getCraft(e)},getLowestCraftAmount:function(m,a,e,i){let s=Number.MAX_VALUE;let d=game.science;let f=game.workshop;let p=f.get("geodesy").researched;let r=this.getMaterials(m);if(!r){return 0}let l=ie[m];let t=l.maxValue;let h=l.value;if(h===Infinity){return 0}let n=this.getLimRat(m,a,e);let b=this.getValueAvailable(m,true);let o,v,c;const u=game.bld.getBuildingExt("temple").meta;let g=game.getEffect("priceRatio");let k=Math.pow(u.priceRatio+g,u.val);let y=game.prestige.getPerk("renaissance").researched;let x=this.getCraft(m);let R=ae.auto.craft;let w=game.getResCraftRatio(x.name)+1;let T=R.trigger;if(m==="ship"&&a){v=h<100||ie["science"].maxValue>95e3||d.get("archeology").researched;let e=oe.getSolarRevolutionRatio();let a=oe.transcendenceTier;let t=!f.get("oxidation").researched&&!R.oxidation||!e||a<6||!h;if(!t){v=false}if(v){let t=40/Math.max(.2,Math.log1p(e))+5*e;if(e<.15){t=Math.min(16/Math.log1p(e),176)}if(p&&(ie["science"].maxValue>119e3||h<200)){ce("shipGeodesy");t=243;if(oe.faith>9e4&&ie["science"].maxValue>11e4){if(a<6&&p){t=-103*a+750-250*!a}}}if(h<t&&w>3){if(h&&(Date.now()>R.shipTime+8e5||!ue.other["auto.ship"])&&ie["starchart"].value>24&&!p){R.shipTime=Date.now();let e=game.getDisplayValueExt(t);le(te("summary.auto.ship",[e]));ue.other["auto.ship"]=e}s=1}else{v=false}}}let E=Number.MAX_VALUE/w+Number.MAX_VALUE/Math.pow(2,53)/w;let F=d.meta[0];let M=d.get("navigation").researched;let P;let B=ae.auto.cache;if(m==="beam"||m==="slab"){o=Object.keys(r)[0];if(ne(o)<2){R.autoConsume[o]=0;if(ie["scaffold"].value>500&&T>.9&&a){R.autoConsume[o]=1;T=.9}if(!h&&ie["slab"].value>3){v=true}if(m==="slab"){if(!ie["concrate"].unlocked&&game.science.get("mechanization").researched&&ie["steel"].value>25){let e=Math.ceil((2500-b)/w);if(e>0&&ie["minerals"].value>e*250){s=e;v=true}}if(p&&!game.ironWill&&ie["kittens"].maxValue<135&&f.get("concreteHuts").researched){let e=game.bld.getBuildingExt("mansion").meta;let t=Math.pow(e.priceRatio+g,e.val);if(ie["titanium"].value>25*t&&ie["steel"].value>75*t){let e=Math.ceil((185*t-h)/w);if(e>0&&ie["minerals"].value>e*250){this.craft(m,e)}}}}}}if(m==="megalith"&&a){let e=!l.unlocked&&game.diplomacy.get("nagas").embassyLevel>15&&!game.calendar.season&&!b;let t=ie["unicorns"].value>2500&&!ie["tears"].value&&h<50;let a=ie["culture"].maxValue<15e3&&game.bld.getBuildingExt("factory").meta.val&&h<80;if(e||t||a){s=1;v=true}}let C=ae.auto.options.items.hunt;let S=C.time==="fullIron"&&C.enabled;if(m==="plate"&&a){let a=game.getResourcePerTick("coal",true);let e=game.bld.getBuildingExt("reactor").meta;let t=Math.pow(g+e.priceRatio,e.val);let i=ie["titanium"].value>3500*t&&ie["uranium"].value>300&&b<5e3*t;if(a>0&&ie["iron"].value!==ie["iron"].maxValue&&b>150&&!i){if(this.getValueAvailable("plate")/this.getValueAvailable("steel")>.8&&R.items["steel"].enabled){let e=this.getResource("coal").maxValue*T;let t=(e-this.getValue("coal"))/a*Math.max(game.getResourcePerTick("iron",true),0);s=Math.max(.008*(this.getValueAvailable("iron")-Math.max(e-t,0)),.1*ie["iron"].perTickCached)}}if(i){s=Math.min(Math.ceil((5e3*t-b)/w),ie["iron"].value/125);v=true}if(b<150){if(ie["faith"].maxValue<750&&ie["gold"].value>30&&h<k*15){let e=game.village.leader;if(w>2.8||ie["iron"].value/125*w>10||e&&e.rank>3){v=true;s=3}}if(!game.getEffect("warehouseRatio")&&h<50&&ie["iron"].value>700&&ie["science"].maxValue>3e4){v=true;s=1}if(!ie["ship"].value&&w>3&&ie["starchart"].value>24){s=Math.ceil(Math.min(ie["iron"].value/100,(150-b)/w));v=true}}if(S){v=true}}let V=this.getValueAvailable("science",true);let q=ne("science");let A=ne("culture");let L=e=>{let t=B.science?B.science:"科学";v=true;if(t==="油气处理"){return}if(!ae.auto.filter.items.miscFilter.enabled){let e=game.msg(te("craft.force",[l.title,t]),null,null,true);$(e.span).css("color","#ff589c")}ge("craft"+U(e),1)};if(m==="manuscript"&&a){let l=B.resources["manuscript"];P=l?17:19;for(o=16;o<P;o++){let i=F.meta[o];let r=l||i.prices[1].val;if(!i.researched||l>0){let t=o===16&&game.village.happiness<4&&u.val===1&&w>4;t=t||ie["faith"].maxValue>750||h>20;let e=10*k;r=t||h>e?r:10*k;s=Math.ceil((r-b)/w);let a=game.getEffect("manuscriptCultureCost")?1:0;if(s>=1){let e=this.getValueAvailable("culture",true)>(400-100*a)*s;if(this.getValueAvailable("parchment",true)>s*(25-5*a)&&e){B.science=l>0?B.science:i.label;B.science=t?B.science:"神殿";L("manuscript");B.resources["manuscript"]=0}}break}}if(A<2&&b<1e3){if(ie["manpower"].perTickCached<14&&A>.97||A>.9&&!M&&h<40){v=true;s=1}}if(!game.calendar.festivalDays&&ie["unobtainium"].value&&d.get("drama").unlocked){s=0}if(ie["science"].maxValue<71250&&d.get("archeology").researched&&!d.get("electricity").researched){s=0}}if(m==="compedium"&&a&&M){let r=B.resources["compedium"];P=r?19:27;if(!i&&w<3){s=0}for(o=18;o<P;o++){if(game.prestige.getPerk("numerology").researched&&!game.calendar.festivalDays&&game.science.get("drama").unlocked){break}let i=F.meta[o];if(!i.researched||r>0){if(i.name==="metaphysics"||i.name==="drama"){continue}if(o<23&&h>35&&!d.get("physics").researched){continue}if(i.prices[1].name===m||r){let e=r||i.prices[1].val;s=Math.ceil((e-b)/w);let t=this.getValueAvailable("manuscript",true);let a=V>1e4*s||q>=1;if(t>s*50&&s>=1&&a){B.science=r>0?B.science:i.label;if(q<1){L("compedium")}B.resources["manuscript"]=0;B.resources["compedium"]=0}else if(s>=1){B.resources["manuscript"]=s*50;B.science=r>0?B.science:i.label}}break}}if(o===20&&h<60&&!d.get("acoustics").researched){v=true;s=1}if(!d.get("metalurgy").researched&&b<100&&q>.98){if(!d.get("electricity").researched&&b<85&&A>.92){v=true;s=1}let e=ie["science"].maxValue;if(A>.96){if(e>81e3){v=true;s=1}if(ie["titanium"].value>3e3&&e>119e3&&!f.get("concreteHuts").researched&&ie["kittens"].maxValue){s=0}}}if(game.getEffect("scienceMaxCompendia")&&game.getEffect("alicornChance")>.004){let e=this.getCompendiaMax();let t=h*10;if(t<Math.max(2e4,e)){v=i;s=(e-t)/(w*10)}}}if(m==="blueprint"&&a&&d.get("electricity").researched){for(o=30;o<44;o++){let r=F.meta[o];if(!r.researched){let e=r.name;let t=["quantumCryptography","blackchain","ecology","ai"];let a=r.prices;if(t.indexOf(e)>-1||ie["science"].maxValue<a[0].val*.95){continue}let i=a[1];if(i.name===m){s=Math.ceil((i.val-b)/w);let e=this.getValueAvailable("compedium",true);let t=V>25e3*s||q>=1;if(e>s*25&&s>=1&&t){B.science=r.label;L("blueprint");B.resources["manuscript"]=0;B.resources["compedium"]=0}else if(s>=1){B.resources["compedium"]=s*25;B.science=r.label}}break}}if(!d.get("metalurgy").researched&&b<60&&q>.98&&ie["science"].maxValue>119e3){v=true;s=1}if(game.getEffect("scienceMaxCompendia")&&game.getEffect("alicornChance")>.004){let e=this.getCompendiaMax();let t=ie["compedium"].value*10;if(t>Math.max(2e4,e)){s=(t-e)/250;v=i}else{n=.1}}}if(m==="concrate"&&!ie["concrate"].unlocked){v=true;s=1}if(m==="parchment"){a=w<2.2-game.getEffect("priceRatio")+.2*y;if(w>2&&ie["furs"].value<350){return}if(ie["minerals"].value>600*(1-g)){if(h<6.1&&w>1.5||h<10&&w>2){v=true;s=1}}if(!M){if(b>120){a=true;ce("parchment")}if(!v){s=2*(500-b)/w}}}for(o in r){c=0;let e=r[o];let t=!a||v||ie[o].maxValue>0&&i;if(t){c=this.getValueAvailable(o,v)/e}else{c=n*((this.getValueAvailable(o,true)+e/w*b)/e)-b/w}E=Math.min(c,E,s)}if(m==="steel"&&a){let s=game.bld.getBuildingExt("calciner").meta;let n=h;let e=this.getValueAvailable("steel");if(!R.oxidation&&R.items["plate"].enabled&&e){let e=M?1:0;let t=Math.max(1*!e,.3*Math.min(1,ie["coal"].perTickCached/ie["iron"].perTickCached));if(ie["plate"].value<Math.max(75+75*e*(w>3),1.25*t*ie["steel"].value)){if(!d.get("theology").researched||h>30){E=0}}if(!game.getEffect("warehouseRatio")&&h<50&&ie["plate"].value>50&&ie["science"].maxValue>3e4){v=true;E=1;if(R.items["scaffold"].enabled&&ie["scaffold"].value<25){this.craft("scaffold",1)}}}let o=ae.auto.upgrade.items.upgrades;let c=(i,r)=>{let l;if(i){l=f.get(i);r=l.prices;if(!l.unlocked){return}}if(!i||!l.researched){let a;for(let t in r){let e=r[t];if(e.name==="steel"){a=e.val}if(e.name==="science"&&ie["science"].value<.95*e.val){return}}let e=Math.ceil((a-n)/w);let t=ie["iron"].value>100*e&&ie["coal"].value>100*e;if(e>0&&t){E=e;v=true;if(i){le(te("craft.forceSteel",[l.label]))}}}};if(!o.cache&&!R.oxidation&&!game.ironWill){c("steelAxe");c("steelArmor")}let u=this.getUnResearched("oxidation");let g=s.on;if(g){if(s.isAutomationEnabled){if(game.time.getCFU("ressourceRetrieval").on<5){ce("ironFactory")}}else{let e=.0015*(1+game.bld.getBuildingExt("reactor").meta.on*.1)*(game.getEffect("calcinerRatio")+1)*game.bld.getAutoProductionRatio()*(game.getEffect("ironPolicyRatio")+1)*game.calendar.cycleEffectsFestival({iron:1})["iron"]*g;E=Math.max(0,E)+e;if(n<125){E+=1}let t=Math.min(ie["coal"].value,ie["iron"].value)*.01;if(E>t||R.oxidation){E=t}if(g===47&&!game.getEffect("productionRatio")&&ie["uranium"].value>250){E=0}}c("oxidation");let a=ie["titanium"].value;if(u){let e=0;if(ae.auto.resources[m]){e=ae.auto.resources[m].stock}let t=Math.ceil((5e3-h+e)/w);let a=(t*100-ie["coal"].value)/ie["coal"].perTickCached;let i=(t*100-ie["iron"].value)/ie["iron"].perTickCached;let r=ie["science"].value>2e4||ie["starchart"].value<1e4;let l=6e3-1500*!p+200*(g>2)+300*(g>3)+ +500*(g>4)+300*(g>6);if(a<l&&i<l&&r){R.oxidation=true;ce("oxidation")}}let i=ie["alloy"].value;let e=this.getUnResearched("fluidizedReactors");let t=this.getUnResearched("orbitalGeodesy");if(t&&ie["oil"].value>3e4&&ie["oil"].maxValue>35e3&&ie["uranium"].value<1e3&&!e){let e=Math.ceil((1e3-i)/w);let t=ie["titanium"].value>e*10||ie["alloy"].value>300&&g>20||(e*10-a)/ie["titanium"].perTickCached<600||g>19;if(e>0&&t){ae.auto.cache.resUpg["alloy"]=1e3;if(o.cache!=="orbitalGeodesy"){le(te("craft.CacheSteel",["轨道测地学"]))}o.cache="orbitalGeodesy"}}if(e&&!o.cache){let e=Math.ceil((200-i)/w);let t=a>e*10||ie["alloy"].value>100||(e*10-a)/ie["titanium"].perTickCached<600||g>13;if(e>0&&g>6&&t){ae.auto.cache.resUpg["alloy"]=200;o.cache="fluidizedReactors";le(te("craft.CacheSteel",["流化反应器"]))}}let r=this.getUnResearched("miningDrill");if(r&&ie["science"].value>1e5&&b>1750&&p&&!o.cache){c("miningDrill")}let l=ae.auto.cache.resUpg["alloy"];if(l){let e=Math.ceil((l-i)/w);c("",[{name:"steel",val:e*75}])}}else if(game.challenges.isActive("blackSky")){c("",[{name:"steel",val:1100}])}if(!u){R.oxidation=null;ce("oxidation",true)}if(C.time&&ne("iron")>.98){C.time="fullIron"}}if(m==="alloy"&&a){let e=(e,t)=>{let a=f.get(e);if(a.researched||!a.unlocked){return}let i=Math.ceil((t-ie["alloy"].value)/w);if(i>1&&ie["steel"].value>i*75&&ie["titanium"].value>i*10&&!R.oxidation){let e=ae.auto.resources["titanium"];if(!e||e&&ie["titanium"].value-t>e.stock){E=i;v=true;if(oe.getSolarRevolutionRatio()<5.5||t>25){le(te("craft.forceSteel",[a.label]))}}}};if(!game.getEffect("unobtainiumPerTickSpace")&&ae.auto.upgrade.items.upgrades.cache!=="geodesy"){if(ie["oil"].value>35e3){e("orbitalGeodesy",1e3)}e("fluidizedReactors",200);if(f.get("alloyAxe").researched){if(game.getEffect("hunterRatio")){e("alloyArmor",25);e("nanosuits",250)}}else if(ie["wood"].perTickCached){e("alloyAxe",25)}e("alloySaw",75);if(ie["oil"].value>5e4){if(ie["starchart"].perTickCached){e("hubbleTelescope",1250)}if(game.village.leader&&ie["uranium"].value>250){e("photolithography",1250)}}}}if(m==="eludium"&&a&&!i){if(S&&game.time.getCFU("ressourceRetrieval").on>8-y*2){E=Math.max(E,1)}}if(E<1){return 0}if(t>0&&E*w>t-h){E=(t-h)/w}if(a&&!v&&(!i||i==="noRequire")){E*=Math.max(Math.min(Math.log(w-1),1),.2)}return E},getMaterials:function(e){let t={};let a=this.getCraft(e);if(!a){return}let i=game.workshop.getCraftPrice(a);for(const r in i){let e=i[r];t[e.name]=e.val}return t},getTickVal:function(e,t){let a=e.name;let s=game.getResourcePerTick(a,true);if(a==="timeCrystal"){let e=game.getEffect("alicornChance");let t=game.getResourcePerTick("alicorn");let a=.04*(1+game.getEffect("tcRefineRatio"));e*=1+game.getLimitedDR(game.getEffect("alicornPerTickRatio"),1.2);let i=Math.min(e,1)*.2;s+=(i+t)*a}if(e.craftable){let i=Number.MAX_VALUE;let r=this.getMaterials(a);let l=1+game.getResCraftRatio(a);for(let a in r){let e=l/r[a];let t=this.getTickVal(this.getResource(a));i=Math.min(t*e,i)}s+=i===Number.MAX_VALUE?0:i}let i=a==="spice"||a==="blueprint";if(s<=0&&i){return"ignore"}if(!t){let e=1;if(a==="unobtainium"&&oe.getSolarRevolutionRatio()>9){e=.6-Math.max(.3,2*game.getEffect("shatterTCGain"));if(game.calendar.cycle===5){e-=.25}}s+=this.cacheManager.getResValue(a)*e}return s},getAverageHunt:function(){let e={};let t=game.getEffect("hunterRatio")+game.village.getEffectLeader("manager",0);e["furs"]=40+32.5*t;e["ivory"]=50*Math.min(.225+.01*t,.5)+40*t*Math.min(.225+.01*t,.5);e["unicorns"]=.05;if(this.getValue("zebras")>=10){e["bloodstone"]=this.getValue("bloodstone")===0?.05:5e-4}if(game.ironWill&&game.workshop.get("goldOre").researched){e["gold"]=.625+.625*t}return e},getResource:function(e){let t=ie[e];if(t){return t}l("unable to find resource "+e);return null},getValue:function(e){return this.getResource(e).value},getStock:function(e){let t=ae.auto;let a=t.resources[e];let i=a?a.stock:0;let r=t.cache.stocks;if(!r){this.getAutoStocks();r=t.cache.stocks}if(r[e]){i+=r[e]}return i},getAutoStocks:function(){let u=game.workshop;let o=ae.auto;let g=o.cache;g.stocks={};if(u.get("spaceManufacturing").researched){return}let m=u.get("orbitalGeodesy").researched;let d=game.village.leader;let f=game.ironWill;let p=game.village.sim.kittens.length;let h=g.resUpg["alloy"];let b=(e,t,a)=>{g.stocks[a]+=e;ce(t)};["wood","minerals","iron","alloy","titanium","steel","gear","beam","blueprint"].forEach(c=>{g.stocks[c]=0;let s=0;let n=ie["titanium"];switch(c){case"wood":{if(this.getUnResearched("ironwood")&&ie["iron"].value>2800&&p>20){s+=15e3}break}case"minerals":{if(p<130&&u.get("concreteHuts").researched&&!f&&!game.getEffect("priceRatio")&&ne(c)<1&&game.getEffect("craftRatio")>=3){let e=game.bld.getBuildingExt("logHouse").meta;s+=250*Math.pow(e.priceRatio+game.getEffect("priceRatio"),e.val)}break}case"iron":{let n=game.getEffect("priceRatio");let o=game.bld.getBuildingExt("lumberMill").meta;let e=game.bld.getBuildingExt("temple").meta;let t=ie["gold"].value<50*Math.pow(n+e.priceRatio,e.val);o=o.val>19-40*n;if(e.on>2||ie["faith"].maxValue>749||t&&o||ie["plate"].value>18){let i=ie[c].value;let e=ie[c].maxValue;let t=(e,t,a)=>{if(e&&i<1e4&&p<115){b(t,a,c)}};let a=this.getUnResearched("reinforcedSaw")&&i>200&&e>1e3;let r=ie["burnedParagon"].value<1e5;let l=this.getUnResearched("crossbow")&&o&&e>1500&&r;let s=this.getUnResearched("ironwood")&&i>700*(1-n)&&e>3e3&&ie["science"].maxValue>3e4&&p>20&&r;t(a,1e3,"reinforcedSaw");t(l,1500,"crossbow");t(s,3e3,"ironwood");if(u.get("spaceManufacturing").researched){ce("ironwood",true);ce("crossbow",true);ce("ironwood",true)}}break}case"alloy":{if(h){s+=h}break}case"steel":{let e=game.challenges.isActive("blackSky");let t=ie[c].value;let a=this.getUnResearched("steelAxe")&&ie["coal"].value>3e3;if(a&&!f&&(game.bld.getBuildingExt("lumberMill").meta.val>30||t>10)){b(75,"steelAxe",c)}let i=this.getUnResearched("steelSaw")&&t>250&&!g.stocks["titanium"]&&!e;if(i){b(750,"steelSaw",c)}if(ae.auto.craft.oxidation&&this.getUnResearched("oxidation")){s+=5e3}if(e&&!n.perTickCached&&t<1100&&ie["oil"].value>6e3){s+=1100}let r=o.upgrade.items.upgrades;if(r.cache==="miningDrill"&&n.value>1750){s+=750}let l=g.resUpg["steel"];if(l){s+=l}if(h){s+=Math.max(0,h-ie["alloy"].value)*75/(1+game.getEffect("craftRatio"))}break}case"titanium":{let e=game.bld.getBuildingExt("calciner").meta.val;if(this.getUnResearched("rotaryKiln")&&(e>22&&u.get("geodesy").researched||m)){b(5e3,"rotaryKiln",c)}let t=oe.getSolarRevolutionRatio();let a=t<3.3&&(e||n.value>100)&&d;let i=game.challenges.isActive("anarchy")&&t<6;let r=this.getUnResearched("geodesy");if(!f&&r&&ie["starchart"].value>300+150*i&&(a||i)){s+=250;ce("titaniumGeodesy");let e=ae.auto.upgrade.items.upgrades;if(!e.cache){e.cache="geodesy"}}let l=game.workshop.get("geodesy").researched;if(l){let e=this.getUnResearched("miningDrill");if(e&&n.value>675){let e=ae.auto.upgrade.items.upgrades;if(!e.cache){e.cache="miningDrill"}s+=1750}}if(this.getUnResearched("concreteHuts")&&p<150+30*i&&!f&&ie["concrate"].value>45&&ie["science"].maxValue>12e4&&ie["uranium"].value<250){if(l&&n.value>750||r&&n.value>1e3){s+=3e3;let e=ae.auto.upgrade.items.upgrades;if(!e.cache){e.cache="concreteHuts"}}}if(this.getUnResearched("spaceManufacturing")&&game.bld.getBuildingExt("reactor").meta.val>24&&n.maxValue>125e3){s+=13e5}if(h){s+=5*h}break}case"gear":if(this.getUnResearched("rotaryKiln")&&n.value>4e3){s+=500}if(this.getUnResearched("fuelInjectors")&&ie["oil"].value>2e4&&(game.getEffect("calcinerRatio")<1||ie["coal"].value<3e3)&&oe.getSolarRevolutionRatio()<5){s+=250}if(this.getUnResearched("pumpjack")&&n.value>200&&(ne("oil")<.8||ie["oil"].perTickCached<1)){s+=125}if(this.getUnResearched("logistics")&&ie["scaffold"].value>1e3&&d){s+=100}if(this.getUnResearched("oilRefinery")&&n.value>1250&&ie["science"].maxValue>125e3){s+=500}break;case"beam":if(this.getUnResearched("deepMining")&&ie["iron"].value>1200){s+=5e3}break;case"blueprint":if(ie["alloy"].value>75&&!game.science.get("nanotechnology").researched&&ie["science"].maxValue>2e5&&u.get("rotaryKiln").researched&&!ie["unobtainium"].value){s+=150}if(!game.science.get("orbitalEngineering").researched&&ne("unobtainium")===1&&game.getEffect("ProductionRatio")>.5){s+=250}break}g.stocks[c]+=s})},getValueAvailable:function(i,e,r){let l=this.getValue(i);let s=this.getStock(i);let t;if(!r&&r!==0){if(r===undefined){t=1}else{t=ae.auto.craft.trigger}}else{t=r}if(i==="catnip"){let a=this.getPotentialCatnip(false);let e=game.calendar.season!==0||this.getResource(i).maxValue*t<l||game.getResourcePerTick("catnip",true)<0;if(a<0&&e){let e=game.calendar;let t=game.calcResourcePerTick("catnip");s-=a*1500;if(t>0){s=Math.max(0,s-10*game.calcResourcePerTick("catnip")*!e.season*(100-e.day))}if(ae.auto.options.catnipMsg+4e6<Date.now()||!ue.other["auto.craftCatnip"]){if(game.stats.getStat("totalResets").val<5){le(te("msg.catnip"))}ce("craftCatnip");ae.auto.options.catnipMsg=Date.now()}}}l=Math.max(l-s,0);let n=r&&!e?l:this.getResource(i).maxValue;if(!e&&n>0){let e=ae.auto.resources[i];let t=e&&e.enabled&&e.consume!==undefined?e.consume:ae.consume;let a=ae.auto.craft.autoConsume;if(a[i]&&!r||i==="coal"){t=1}l-=Math.min(n,l)*(1-t);if(i==="unobtainium"&&l+s<1e3&&this.getResource(i).value===n&&this.getResource(i).value>=1e3){l=this.getResource(i).value}}return l},getUnResearched:function(e){let t=game.workshop.metaCache[e];return!t.researched&&t.unlocked},getLimRat:function(l,e,o){if(!e){return o}let a=game.science.get("navigation");let c=ie[l];let u=ie["ship"].value;let r=game.space;let s=r.getProgram("piscineMission");let g=game.bld;let n=g.getBuildingExt("reactor").meta;let m=game.getEffect("priceRatio");let i=m<-.07;let d=g.getBuildingExt("steamworks").meta;let f=g.getBuildingExt("magneto").meta;const p=g.getBuildingExt("temple").meta;let h=Math.pow(p.priceRatio+m,p.val);let b=oe.getSolarRevolutionRatio();let v;switch(l){case"wood":{let e=ie["catnip"];let t=.09+c.perTickCached<e.perTickCached/game.workshop.getCraft("wood").prices[0].val;let a=!game.getEffect("scienceRatio")&&e.value>1e3&&game.ironWill;o=t||a?1:.5-.1*(e.perTickCached<10);let i=g.getBuildingExt("field").meta;let r=Math.pow(i.priceRatio+m,i.val);o=e.maxValue>10*r&&b>1&&!game.ironWill&&c.value||!this.getValueAvailable(l,true)&&c.value?0:o;break}case"beam":{let e=a.unlocked||ie["gold"].maxValue<500||ie["iron"].value>1e3&&!ie["coal"].value;o=ie["scaffold"].value<500+500*b+4500*!b?o:.02;o=e?o:.005;break}case"slab":{let e=c.value;let t=ie["faith"].maxValue<750&&e<51&&ie["gold"].value>35;let a=ie["scaffold"].value;o=a||t||n.val&&e<2500?o:.005;o=a<500||a>500&&e<615?o:.1;o=a>2500&&c.value>2500*(1+b)*(1+.05*n.on)*(1+b)?.04:o;break}case"ship":{let e=5*n.val+225;let t=ie["titanium"].maxValue;let a=!s.on&&r.getBuilding("sattelite").val<9&&c.value;let i=a&&b>5.5&&t<125e3&&!s.val;a=a&&b>6&&t>12e4;o=game.workshop.get("geodesy").researched&&u<2.5*e&&b<5?.7:.4;o=u>e*.75&&b>3&&ie["starchart"].value<1e5?.3:o;o=i||ne("titanium")>.8?.05:o;o=a&&(!game.workshop.get("satnav").researched||t>123e3)&&ie["starchart"].value<1e4?0:o;o=u>Math.max(400,t)?0:o;break}case"plate":{let e=ie["titanium"].value>3500&&ie["uranium"].value>250&&!n.val;let t=p.on&&p.on<15-3*i&&b&&c.value<h*15;o=game.getEffect("calcinerRatio")||t?o:.35;o=c.value<150&&a.researched&&ie["starchart"].value>10&&ie["scaffold"].value>50||e?.92:o;o=ae.auto.craft.oxidation&&!game.workshop.get("oxidation").researched?0:o;break}case"alloy":{let e=game.globalEffectsCached["titaniumPerTickAutoprod"];let t=g.getBuildingExt("calciner").meta.val;v=Math.pow(f.priceRatio+m,f.val);o=d.on<f.on||t<2||t<3&&!ie["titanium"].value<22-b?.45:.76;let a=!n.val&&f.val>31;o=c.value>Math.max(1250,10*v)&&ae.auto.build.items.magneto.enabled||a?.01:o;let i=t<6&&game.challenges.isActive("blackSky");o=ie["titanium"].value<17&&!t||i||!game.science.get("electricity").researched?0:o;break}case"steel":{let e=ae.auto;o=e.craft.oxidation?1:.65;break}case"eludium":{let e=game.time.getCFU("ressourceRetrieval").on>5;o=e?.1:.6;o=c.value<125&&game.getEffect("hutPriceRatio")>-1.06?1:o;break}case"megalith":{let e=g.getBuildingExt("ziggurat").meta;v=Math.pow(e.priceRatio+m,e.val);let t=Math.pow(n.priceRatio+m,n.val);o=game.workshop.get("spaceManufacturing").researched?o:.15;o=c.value>Math.max(100,50*v)?.005:o;o=ie["plate"].value<Math.max(5e3,50*t)?.1:o;if(c.value>50||e.on||ie["unicorns"].value<1e3){if(!game.workshop.get("orbitalGeodesy").researched){o=.001}}break}case"concrate":{let e=r.getBuilding("moonOutpost").val;e=150*Math.pow(1.12,e);v=Math.pow(n.priceRatio+m,n.val);let t=g.getBuildingExt("library").meta;let a=Math.pow(t.priceRatio+m,t.val)*t.stage;o=n.val?.6:.15;o=c.value>Math.max(e,50*v,10*a)?.01:o;break}case"gear":{v=Math.pow(d.priceRatio+m,d.val);let e=this.getUnResearched("logistics")&&ie["scaffold"].value>1e3;let t=this.getUnResearched("fuelInjectors")&&ie["oil"].value>1e4&&ne("coal")<.5&&c.value<250&&ie["titanium"].value>200;let a=game.getEffect("calcinerRatio")&&b>2;o=t||e?.75:.3+.15*a;o=c.value>Math.max(500,20*v)?.005:o;o=d.val||game.science.get("chemistry").researched||game.challenges.isActive("pacifism")&&c.value<50?o:0;break}case"kerosene":o=.25;o=!s.val&&ie["starchart"].value>1400&&c.value<250&&b>3?.8:o;o=!s.on&&c.value>250?0:o;o=r.getProgram("moonMission").val?o:0;break;case"manuscript":{o=game.prestige.getPerk("numeromancy").researched&&!game.calendar.festivalDays&&game.science.get("drama").unlocked?.25:.49;o=n.val?.4:o;let e=g.getBuildingExt("chapel").meta;e=Math.pow(e.priceRatio+m,e.val);let t=g.getBuildingExt("brewery").meta;if(ie["culture"].maxValue>750*Math.pow(t.priceRatio+m,t.val)&&ne("culture")>.5){o=ie["parchment"].value>Math.max(1e6,260*e)&&n.val?1:o}break}case"compedium":o=b?o:.3;o=game.science.get("architecture").unlocked?o:0;o=ie["manuscript"].value>Math.max(1e4,100*h)?.9:o;break;case"blueprint":o=game.science.get("industrialization").unlocked?o:0;break;case"scaffold":{let t=c.value;let e=g.getBuildingExt("observatory").meta;v=Math.pow(game.getLimitedDR(e.priceRatio+m,.15)+e.priceRatio,e.val);let a=t<50*v&&ie["iron"].value>750*v;let i=ie["science"].maxValue;let r=game.village.leader;let l=c.value<1e3&&this.getUnResearched("logistics")&&r&&r.rank>2&&i>1e5;let s=ie["plate"].value>150&&t<100;o=a||l||s?.75+.1*(i<6e4):o;let n=game.science.get("navigation").unlocked;if(game.science.get("navigation").unlocked){o=ie["iron"].value>750||game.science.get("chemistry").researched?o:0;let e=t<880&&i<11e4+9e3*(ie["culture"].maxValue>15e3)&&u>243;o=e||game.getEffect("priceRatio")>-.06&&s?1:o}else{o=0}break}case"tanker":o=.1;break;case"thorium":o=c.value?.01:1e-4;break}return o},getCompendiaMax:function(){let a=game.bld.getEffect("scienceMax");let e=game.getEffect("scienceMaxCompendia");if(game.ironWill){a*=10}if(game.prestige.getPerk("codexLeviathanianus").researched){let e=oe.getTU("blackLibrary");let t=1+e.val*(e.effects["compendiaTTBoostRatio"]+game.getEffect("blackLibraryBonus"));a*=1+.05*t*oe.transcendenceTier}return a+e},getPotentialCatnip:function(e,t,a){let i=game.getEffect("catnipPerTickBase");if(e){i*=.1;i*=1+game.getLimitedDR(game.getEffect("coldHarshness"),1);if(game.getEffect("factoryCostReduction")){i=0}}else{let e=game.calendar.year<4?0:.15;i*=game.calendar.seasons[3].modifiers.catnip-e}if(!game.village.resourceProduction){game.village.updateResourceProduction()}let r=game.village.resourceProduction["catnip"];let l=r?r*(1+game.getEffect("catnipJobRatio")):0;let s=i+l;if(a===undefined){s*=1+game.getEffect("catnipRatio")}else{let e=game.space.getBuilding("hydroponics");let t=e.effects["catnipRatio"];s*=1+game.bld.getBuildingExt("aqueduct").meta.stages[0].effects["catnipRatio"]*a+t*e.val}let n=game.challenges.isActive("winterIsComing")?0:game.prestige.getParagonProductionRatio();s*=1+n;s*=1+oe.getSolarRevolutionRatio()*(1+game.bld.pollutionEffects["solarRevolutionPollution"]);s*=1+game.getEffect("blsProductionBonus")*ie["sorrow"].value;s=game.calendar.cycleEffectsFestival({catnip:s})["catnip"];s*=1+game.bld.pollutionEffects["catnipPollutionRatio"];let o=game.village.getResConsumption()["catnip"];let c=game.bld.getBuildingExt("unicornPasture").meta.val;if(t===undefined){o*=1+game.getEffect("catnipDemandRatio")}else{o*=1+game.getLimitedDR(t*-.005+c*-.0015,1)}if(game.village.sim.kittens.length>0&&game.village.happiness>1){let e=Math.max(game.village.happiness*(1+game.getEffect("hapinnessConsumptionRatio"))-1,0);if(game.challenges.isActive("anarchy")){o*=1+e*(1+game.getEffect("catnipDemandWorkerRatioGlobal"))}else{o*=1+e*(1+game.getEffect("catnipDemandWorkerRatioGlobal"))*(1-game.village.getFreeKittens()/game.village.sim.kittens.length)}}s+=o+.2*!ue.other["auto.changeLeader"];s+=game.getResourcePerTickConvertion("catnip");return s}};let a=function(){this.craftManager=new t};a.prototype={craftManager:undefined,bulk:function(t,a,i,g){let s,m,d,n,o;const f=[];const p=[];let c=0;for(const u in t){o=t[u];if(!o.enabled){continue}s=a[u];if(o.max!==-1&&o.max<=s.val){continue}if(s.unlocked===false){continue}let e=o.require?ie[o.require]:false;if(!e||i<=e.value/e.maxValue){let i=s.stages?s.stages[s.stage].prices:s.prices;if(o.variant==="s"){i=game.village.getEffectLeader("wise",dojo.clone(s.prices))}d=this.getPriceRatio(s,g);f[c]={};let e=f[c];e.id=u;e.label=o.label;e.name=o.name;e.stage=o.stage;e.variant=o.variant;p[c]={};let r=p[c];r.id=u;r.name=o.name;r.count=0;r.spot=c;r.prices=[];let t=game.getLimitedDR(game.getEffect(u+"CostReduction"),1);let l=1-t;for(n in i){let e=i[n];let t=game.getLimitedDR(game.getEffect(e.name+"CostReduction"),1);let a=1-t;r.prices.push({val:e.val*l*a,name:e.name})}r.priceRatio=d;r.source=g;r.limit=isNaN(o.max)?-1:o.max;r.val=s.val;if(this.singleBuildPossible(s,r.prices,d,g)){c++}else{p.pop()}}}if(p.length===0){return}let h={};for(let e in ie){h[e]=this.craftManager.getValueAvailable(e,true)}let r=0;let b;while(p.length!==0){e:for(let u=0;u<p.length;u++){let o=p[u];s=a[o.id];let e=s.val;let c=r+e;m=o.prices;d=o.priceRatio||Number.MAX_VALUE;g=o.source;for(let n=0;n<m.length;n++){let t=m[n];let e,a,i,r=false;let l=t.name;let s=h[l];if(g==="space"&&l==="oil"){e=true;i=t.val*(1-game.getLimitedDR(game.getEffect("oilReductionRatio"),.75))}else if(o.id==="cryochambers"&&l==="karma"){a=true;r=t.val*(1-game.getLimitedDR(.01*game.prestige.getBurnedParagonRatio(),1))}if(e){b=h["oil"]<i*Math.pow(1.05,c)}else if(a){b=h["karma"]<r*Math.pow(d,c)}else{let e=t.val*Math.pow(d,c);b=s<e}if(b){for(let e=0;e<n;e++){let t=m[e];let a=t.name;if(g==="space"&&a==="oil"){let e=t.val*(1-game.getLimitedDR(game.getEffect("oilReductionRatio"),.75));h["oil"]+=e*Math.pow(1.05,c)}else if(o.id==="cryochambers"&&a==="karma"){let e=t.val*(1-game.getLimitedDR(.01*game.prestige.getBurnedParagonRatio(),1));h["karma"]+=e*Math.pow(d,c)}else{let e=t.val*Math.pow(d,c);h[a]+=a==="void"?Math.ceil(e):e}}if(o.limit!==-1){o.count=Math.max(0,Math.min(o.count,o.limit-o.val))}f[o.spot].count=o.count;p.splice(u,1);u--;continue e}if(e){h["oil"]-=i*Math.pow(1.05,c)}else if(a){h["karma"]-=r*Math.pow(d,c)}else{let e=t.val*Math.pow(d,c);h[l]-=l==="void"?Math.ceil(e):e;if(!h[l]){h[l]=0}}}o.count++}r++}return f},construct:function(e,t,a){const i=e.metadata;let r=0;if(typeof i.limitBuild=="number"&&i.limitBuild-i.val<a){a=i.limitBuild-i.val}if(!e.enabled){t.controller.updateEnabled(e)}if(e.enabled&&t.controller.hasResources(e)||game.devMode){while(t.controller.hasResources(e)&&a>0){e.prices=t.controller.getPrices(e);t.controller.payPrice(e);t.controller.incrementValue(e);r++;a--}if(i.breakIronWill){game.ironWill=false;let e=game.science.getPolicy("liberty");e.calculateEffects(e,game)}if(i.unlockScheme&&i.val>=i.unlockScheme.threshold){game.ui.unlockScheme(i.unlockScheme.name)}if(i.unlocks){game.unlock(i.unlocks)}if(i.upgrades){if(i.updateEffects){i.updateEffects(i,game)}E(i.upgrades)}}return r},getPriceRatio:function(e,t){let a=e.stages?e.priceRatio||e.stages[e.stage].priceRatio:e.priceRatio;let i=0;if(t==="bonfire"){i=game.getEffect(e.name+"PriceRatio")+game.getEffect("priceRatio")+game.getEffect("mapPriceReduction");i=game.getLimitedDR(i,a-1)}return a+i},singleBuildPossible:function(s,n,o,c){let e=game.getLimitedDR(game.getEffect(s.name+"CostReduction"),1);let u=1-e;for(let l in n){let e=n[l];let t=e.name;let a=game.getLimitedDR(game.getEffect(t+"CostReduction"),1);let i=1-a;let r=e.val*u*i;if(s.name==="cryochambers"&&t==="karma"){r*=1-game.getLimitedDR(.01*game.prestige.getBurnedParagonRatio(),1)}if(c==="space"&&t==="oil"){r*=1-game.getLimitedDR(game.getEffect("oilReductionRatio"),.75);o=1.05}if(this.craftManager.getValueAvailable(t,true)<r*Math.pow(o,s.val)){return false}}return true}};let f=function(){this.craftManager=new t;this.manager=new e("Trade")};f.prototype={craftManager:undefined,manager:undefined,trade:function(e,t){if(!e||t<1){l(e+"-"+t+"贸易可能出点问题")}let a=this.getRace(e);let i=this.getTradeButton(a.name);let r=ae.auto.cache.trait["merchant"]?"商人小猫与 ":"小猫与 ";if(!i.model.enabled){return i.controller.updateEnabled(i.model)}if(e!=="sharks"&&!ae.auto.trade.items[e].enabled){l("贸易可能出点问题")}game.diplomacy.tradeMultiple(a,t);game.stats.getStat("totalClicks").val+=1;ge(r+" "+a.title,t,"trade");se("act.trade",[t,r+U(a.title)],"tradeFilter")},getProfitability:function(e){let a,l;let i=this.getRace(e);if(e==="leviathans"){if(i.duration<400&&(ie["relic"].value<5||ie["timeCrystal"].value<200)&&ne("unobtainium")>.5){return true}}let s=oe.getSolarRevolutionRatio();let t=this.getMaterials(e);let r=0;let n=false;for(let e in t){if(e==="ivory"){continue}a=this.craftManager.getTickVal(this.craftManager.getResource(e),n);if(e==="slab"&&s>.03){a*=1.05}if(a<=0){return false}r+=t[e]/a}let o=this.getAverageTrade(i);let c=0;for(let t in o){let e=ie[t];a=this.craftManager.getTickVal(e);if(a==="ignore"||!a||t==="catnip"){continue}if(a<0){l=true}c+=e.maxValue>0?Math.min(o[t],Math.max(e.maxValue-e.value,0))/a:o[t]/a}let u=true;let g=game.calendar.season;let m=ie["spice"].value+100*game.getResourcePerTick("spice",true)<0;let d=ne("titanium");if(e==="nagas"){if(!ie["concrate"].unlocked&&!game.ironWill){u=false}if(i.embassyLevel<10&&!game.ironWill){return false}let e=1+game.prestige.getParagonProductionRatio();let t=ie["concrate"].value;if(t<100*e*(1+s)&&i.embassyLevel>10&&t&&(ie["titanium"].value>30*e||m&&game.calendar.festivalDays||t<50)){l=true}if(t>250*(1+s)*e*(1+s)&&d<.8&&ie["slab"].value>3e3){u=false}}let f=ie["titanium"];let p=f.value;if(e==="griffins"){if(g===2){if(ie["iron"].value<1200&&ie["gold"].value>100+600*game.getEffect("priceRatio")&&!game.science.get("theology").researched&&game.getEffect("priceRatio")>-.05&&ne("iron")<.9){l=true}if(p<500&&s>1.3&&s){u=false}if(game.challenges.isActive("blackSky")&&p<500&&oe.getRU("basilica").on){l=true}if(ie["steel"].value>5*ie["plate"].value&&p>500){l=true}}else{if(ie["ship"].value&&(ie["ship"].value>200||game.getEffect("productionRatio"))){u=false}}l=l||m&&game.calendar.festivalDays}if(e==="zebras"){let e=game.bld.getBuildingExt("calciner").meta.val;let t=ae.auto.trade.items.griffins;if(t.enabled&&t.autumn&&g===2&&e>2&&u){let e=this.craftManager.getTickVal(ie["iron"]);let t=Math.min(Math.max(f.maxValue-p,0),o["titanium"])/f.perTickCached;let a=this.getAverageTrade(this.getRace("griffins"))["iron"]/e<o["iron"]/e+t;u=a&&d<.3}let a=ie["gold"].value>200||ie["faith"].value>40&&oe.faith>1e4;if(a&&!oe.getRU("stainedGlass").on&&s){return}let i=oe.getRU("basilica").on;if(i){if(p<30||ae.auto.cache.resUpg["alloy"]<1e3){l=true}}else{if(e&&s>3.5){u=false}}let r=X.get("geodesy").researched;if(g===1){if(r&&ne("titanium")<.5&&ie["slab"].value>1e4){l=true}if(ie["ship"].value>240){if(ie["steel"].value>ie["plate"].value||d<.5){l=true}}}if(r){if(s&&!i){return false}let e=game.getEffect("calcinerRatio");if(e&&e<2.7||this.craftManager.getUnResearched("concreteHuts")||game.getEffect("productionRatio")&&p*1.35<ie["plate"].value&&ne("titanium")<.93){l=true}}if(p&&!this.craftManager.getValueAvailable("titanium",true)){l=true}if(!X.get("caravanserai").researched&&s<4&&o["titanium"]<1){return false}l=l||m&&game.calendar.festivalDays}if(e==="spiders"){if(g===2){u=d>.4}else{u=d>.5&&ne("coal")<.5}if(g===3){u=d>.9&&ne("coal")<.5&&ne("gold")>.95}if(!l){let e=game.prestige.getParagonProductionRatio()+1;let t=ne("coal")<1&&ie["steel"].value<.8*e*ie["plate"].value;l=t&&f.value>600*(1+s)*e&&ie["iron"].value>1e4+1e4*s;if(!u&&!l){l=game.challenges.isActive("atheism")&&i.embassyLevel>4}}if(ie["scaffold"].value<7e3+7e3*s){return false}}if(e==="dragons"){let e=game.science.get("nanotechnology").researched;u=game.space.getProgram("centaurusSystemMission").on&&d>.5||e&&ne("uranium")<.35&&ne("iron")>.1||ie["ship"].value>200&&!s;l=l&&e&&ie["titanium"].value>5e3*s}if(e==="sharks"){if(game.prestige.getParagonProductionRatio()>2&&!ie["titanium"].value&&ie["furs"].value){return false}}return l||r<=c&&u},getAverageTrade:function(s){let e=game.getEffect("standingRatio")+game.diplomacy.calculateStandingFromPolicies(s.name,game);let n=1+s.energy*.02;let o=1+game.diplomacy.getTradeRatio()+game.diplomacy.calculateTradeBonusFromPolicies(s.name,game)+game.challenges.getChallenge("pacifism").getTradeBonusEffect(game);let t=s.standing<0?s.standing+e:0;let c=t<0?1+t:1;let u=s.standing>0?Math.min(s.standing+e/2,1):0;let g={};for(let l of s.sells){if(!this.isValidTrade(l,s)){continue}let e=l.minLevel?l.chance*(1+game.getLimitedDR(.01*s.embassyLevel,.75)):l.chance;let t=l.seasons?1+l.seasons[game.calendar.getCurSeason().name]:1;let a=(c-u)*Math.min(e,1);let i=u*Math.min(e,1);let r=(a+1.25*i)*l.value*n*t*o;g[l.name]=r}if(s.name==="zebras"){let e=ie["ship"].value;let t=game.getEffect("zebraRelationModifier")*game.bld.getBuildingExt("tradepost").meta.effects["tradeRatio"];let a=Math.min(.15+e*.0035,1);g["titanium"]=(1.5+e*.03)*(1+t)*a*c;if(oe.getSolarRevolutionRatio()<1&&e<50&&game.getEffect("titaniumPerTickAutoprod")<.003){g["titanium"]*=.5}}let a=s.embassyPrices?.35*(1+.01*s.embassyLevel):.35;let i=c*Math.min(a,1);g["spice"]=25*i+50*i*o/2;g["blueprint"]=.1*c;return g},isValidTrade:function(e,t){return!(e.minLevel&&t.embassyLevel<e.minLevel)&&(ie[e.name].unlocked||e.name==="titanium"||e.name==="uranium"||t.name==="leviathans")},getLowestTradeAmount:function(e,t,a){let i,r,s,l;let n=this.getMaterials(e);let o=this.getRace(e);for(l in n){if(l==="manpower"){i=this.craftManager.getValueAvailable(l,true)/n[l]}else{i=this.craftManager.getValueAvailable(l,!t,ae.auto.trade.trigger)/n[l]}r=r===undefined||i<r?i:r}r=Math.floor(r);if(r===0){return 0}if(o===null||ae.auto.trade.items[e].allowCapped){return r}let c=ie["plate"].value>ie["steel"].value||!a;let u=this.getAverageTrade(o);let g=o.sells;for(let l in g){let e=g[l].name;let t=this.craftManager.getResource(e);if(!t.maxValue){continue}let a=u[e];let i=c||e!=="iron"?1:0;let r=Math.max((t.maxValue-t.value-Math.max(0,i*(ae.interval/200+2)*t.perTickCached))/a,0);s=r<s?s:r}s=Math.ceil(s);if(s===0){return 0}r=s<r?Math.max(s-1,1):r;return Math.floor(r)},getMaterials:function(e){let t=game.challenges.isActive("postApocalypse")?game.bld.getPollutionLevel():1;let a={manpower:t*(50-game.getEffect("tradeCatpowerDiscount")),gold:t*(15-game.getEffect("tradeGoldDiscount"))};if(e===undefined){return a}let i=this.getRace(e).buys;for(const r in i){let e=i[r];a[e.name]=e.val}return a},getRace:function(e){if(e===undefined){return null}else{return game.diplomacy.get(e)}},getTradeButton:function(a){for(let t in this.manager.tab.racePanels){let e=this.manager.tab.racePanels[t];if(e.race.name===a){return e.tradeBtn}}},singleTradePossible:function(e){let t=this.getMaterials(e);for(let e in t){if(this.craftManager.getValueAvailable(e,true)<t[e]){return false}}return true}};let b=function(){};b.prototype={pushToCache:function(e){let t=ae.auto.cache.cacheSum;let a=e["materials"];for(let e in a){if(!t[e]){t[e]=0}t[e]+=a[e]}},getResValue:function(e){let t=ae.auto.cache;let a=t.dataTimer;let i=t.cacheSum;if(!i[e]){return 0}let r=a.ticksTotal;let l=game.timer.ticksTotal;let s=i[e]/(l-r);return s}};let i=function(e){const t=document.styleSheets;t[0].insertRule(e,0)};if(i){let e="body[data-ks-style]:not(.scheme_sleek)";i("body {"+"font-family: inherit;"+"font-size: inherit;"+"}");i(e+" #game {"+"min-width: 1300px;"+"top: 32px;"+"}");i(e+" .column {"+"min-height: inherit;"+"max-width: inherit !important;"+"padding: 1%;"+"margin: 0;"+"overflow-y: auto;"+"}");i(e+" #leftColumn {"+"height: 92%;"+"width: 26%;"+"}");i(e+" #midColumn {"+"height: 90%;"+"width: 49%;"+"}");i(e+" #rightColumn {"+"overflow-y: auto;"+"height: 92%;"+"width: 19%;"+"top: 5px;"+"font-size: 12px;"+"font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,Helvetica,Arial,PingFang SC,Hiragino Sans GB,Microsoft YaHei,sans-serif;"+"}");i("body #gamePageContainer #game #rightColumn {"+"overflow-y: auto;"+"}");i(e+" #gameLog {"+"overflow-y: hidden !important;"+"width: 100% !important;"+"padding-top: 5px !important;"+"}");i(e+" #resContainer .maxRes {"+"color: #676766;"+"}");i(e+" #game .btn {"+"border-radius: 0px;"+"font-family: monospace;"+"font-size: 12px !important;"+"margin: 0 5px 7px 0;"+"width: 290px;"+"}");i(e+" #game .map-viewport {"+"height: 340px;"+"max-width: 500px;"+"overflow: visible;"+"}");i(" #game .map-dashboard {"+"height: 120px;"+"width: 292px;"+"}");i("#ks-options ul {"+"list-style: none;"+"margin: 0 0 5px;"+"padding: 0;"+"}");i("#ks-options ul:after {"+"clear: both;"+'content: " ";'+"display: block;"+"height: 0;"+"}");i("#ks-options ul li {"+"display: block;"+"float: left;"+"width: 100%;"+"}");i("#ks-options #toggle-list-resources .stockWarn *,"+"#ks-options #toggle-reset-list-resources .stockWarn * {"+"color: "+ae.stockwarncolor+";"+"}");i(".right-tab {"+"height: unset !important;"+"}")}let v=3;let A;let W=()=>{A={version:v,toggles:{},items:{},resources:{},triggers:{},reset:{reset:false,times:0,paragonLastTime:0,paragonTotal:0,karmaLastTime:0,karmaTotal:0},policies:[]}};W();let z=["build","space","craft","upgrade","trade","faith","time","timeCtrl","distribute","options","filter"];let G=function(){z.forEach(e=>{$("#items-list-"+e).find("input[id^='toggle-']").each(function(){let e=$(this);if($(this).attr("type")!=="radio"){A.items[e.attr("id")]=e.prop("checked")}})});A.items["toggle-leaderJob-woodcutter"]=true;A.items["toggle-leaderTrait-manager"]=true;if(!game.ironWill){if(game.stats.getStat("totalResets").val>1){game.msg("注意：非钢铁意志模式，故勾上了喵喵建筑","alert")}["hut","logHouse","mansion"].forEach(e=>{if(!ae.auto.build.items[e].enabled){$("#toggle-"+e).click()}})}L()};let L=function(){A.toggles={build:ae.auto.build.enabled,space:ae.auto.space.enabled,craft:ae.auto.craft.enabled,upgrade:ae.auto.upgrade.enabled,trade:ae.auto.trade.enabled,faith:ae.auto.faith.enabled,time:ae.auto.time.enabled,timeCtrl:ae.auto.timeCtrl.enabled,distribute:ae.auto.distribute.enabled,options:ae.auto.options.enabled,filter:ae.auto.filter.enabled};A.resources=ae.auto.resources;A.triggers={faith:ae.auto.faith.trigger,time:ae.auto.time.trigger,build:ae.auto.build.trigger,space:ae.auto.space.trigger,craft:ae.auto.craft.trigger,trade:ae.auto.trade.trigger};A.policies=ae.policies;localStorage["cbc.kitten-scientists"]=JSON.stringify(A)};let J=function(){let e=JSON.parse(localStorage["cbc.kitten-scientists"]||"null");if(!e||e.version>v){return G()}if(e.version===1){e.version=2;e.reset={reset:false,times:0,paragonLastTime:0,paragonTotal:0,karmaLastTime:0,karmaTotal:0}}if(e.version===2){e.version=3;e.policies=[]}if(e.version===v){A=e;let t;if(e.toggles){for(const r in e.toggles){if(r!=="engine"&&ae.auto[r]){ae.auto[r].enabled=!!e.toggles[r];t=$("#toggle-"+r);t.prop("checked",ae.auto[r].enabled)}}}for(const l in A.items){let a=A.items[l];t=$("#"+l);let e=t.data("option");let i=l.split("-");if(e===undefined){delete A.items[l];continue}if(i[0]==="set"){t[0].title=a;if(i[i.length-1]==="max"){t.text(te("ui.max",[a]))}else if(i[i.length-1]==="min"){t.text(te("ui.min",[a]))}}else{t.prop("checked",a)}if(i.length===2){e.enabled=a}else if(i[1]==="reset"&&i.length>=4){let e=i[2];let t=i[3];switch(i[0]){case"toggle":ae.auto[e].items[t].checkForReset=a;break;case"set":ae.auto[e].items[t].triggerForReset=a;break}}else{if(i[1]==="limited"){e.limited=a}else if(i[1]==="leaderJob"&&a){e[i[1]]=i[2]}else if(i[1]==="leaderTrait"&&a){e[i[1]]=i[2]}else{e[i[2]]=a}}}let a=$("#toggle-list-resources");let i=$("#toggle-reset-list-resources");for(const s in A.resources){let e=A.resources[s];if(e.enabled){if($("#resource-"+s).length===0){a.append(I(s))}if("stock"in e){x(s,e.stock)}if("consume"in e){R(s,e.consume)}}if(e.checkForReset){if($("#resource-reset-"+s).length===0){i.append(I(s,undefined,true))}if("stockForReset"in e){x(s,e.stockForReset?e.stockForReset:Infinity,true)}}}if(e.triggers){ae.auto.faith.trigger=e.triggers.faith;ae.auto.time.trigger=e.triggers.time;ae.auto.build.trigger=e.triggers.build;ae.auto.space.trigger=e.triggers.space;ae.auto.craft.trigger=e.triggers.craft;ae.auto.trade.trigger=e.triggers.trade;$("#trigger-faith")[0].title=ae.auto.faith.trigger;$("#trigger-time")[0].title=ae.auto.time.trigger;$("#trigger-build")[0].title=ae.auto.build.trigger;$("#trigger-space")[0].title=ae.auto.space.trigger;$("#trigger-craft")[0].title=ae.auto.craft.trigger;$("#trigger-trade")[0].title=ae.auto.trade.trigger}ae.policies=e.policies}};let U=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};let k=function(e){return+(Math.round(+(e+"e+2"))+"e-2")};let D={cursor:"pointer",display:"inline-block",float:"right",paddingRight:"5px",textShadow:"3px 3px 4px gray"};let y=function(t,e,a=false){let i=a?"#resource-reset-"+t:"#resource-"+t;$(i).removeClass("stockWarn");let r=game.resPool.resources.filter(e=>e.name===t)[0].maxValue;if(e>r&&!(r===0)||e===Infinity){$(i).addClass("stockWarn")}};let x=function(e,t,a=false){let i;let r=Number(t);if(isNaN(r)||r<0){l("ignoring non-numeric or invalid stock value "+t);return}if(!ae.auto.resources[e]){ae.auto.resources[e]={}}if(a){i="#resource-reset-"+e+" #stock-value-"+e;r=r<0?Infinity:r;ae.auto.resources[e].checkForReset=true;ae.auto.resources[e].stockForReset=r}else{i="#resource-"+e+" #stock-value-"+e;ae.auto.resources[e].enabled=true;ae.auto.resources[e].stock=r}$(i).text(te("resources.stock",[r===Infinity?"∞":game.getDisplayValueExt(r)]));y(e,r,a)};let R=function(e,t){let a=parseFloat(t);if(isNaN(a)||a<0||a>1){l("ignoring non-numeric or invalid consume rate "+t);return}if(!ae.auto.resources[e]){ae.auto.resources[e]={}}ae.auto.resources[e].consume=a;$("#consume-rate-"+e).text(te("resources.consume",[a.toFixed(2)]))};let w=function(e,t=false){let a=ae.auto.resources[e];if(t){a.checkForReset=false}else{a.enabled=false}if(!a.enabled&&!a.checkForReset){delete ae.auto.resources[e]}};let I=function(a,i,e=false){let t;let r=ie[a];i=i||r.title||U(a);let l=ae.auto.resources[a];if(e&&l&&l.stockForReset){t=l.stockForReset}else if(!e&&l&&l.stock){t=l.stock}else{t=0}let s=l&&l.consume!==undefined?l.consume:ae.consume;let n=$("<div/>",{id:(e?"resource-reset-":"resource-")+a,css:{display:"inline-block",width:"100%"}});let o;if(r.type==="uncommon"){o="#FF7F50"}if(r.type==="rare"){o="#FFA500"}o=r.color||o;let c=$("<div/>",{id:"resource-label-"+a,text:i,css:{display:"inline-block",color:o,width:"95px"}});t=$("<div/>",{id:"stock-value-"+a,text:te("resources.stock",[t===Infinity?"∞":game.getDisplayValueExt(t)]),css:{cursor:"pointer",display:"inline-block",width:"80px"}});s=$("<div/>",{id:"consume-rate-"+a,text:te("resources.consume",[s.toFixed(2)]),css:{cursor:"pointer",display:"inline-block"}});let u=$("<div/>",{id:"resource-delete-"+a,text:te("resources.del"),css:D});if(e){n.append(c,t,u)}else{n.append(c,t,s,u)}if(l!==undefined&&l.stock!==undefined){y(a,l.stock)}(function(e,t){e.on("click",function(){O.stop(false);let e=window.prompt(te("resources.stock.set",[i]));if(ae.auto.engine.enabled){O.start(false)}if(e!==null){x(a,e,t);L()}})})(t,e);s.on("click",function(){O.stop(false);let e=window.prompt(te("resources.consume.set",[i]));if(ae.auto.engine.enabled){O.start(false)}if(e!==null){R(a,e);L()}});(function(e,t){e.on("click",function(){if(i==="毛皮"){return}if(window.confirm(te("resources.del.confirm",[i]))){n.remove();w(a,t);L()}})})(u,e);return n};let T=true;if(T){let e=true;if(e){["workshopTab","libraryTab","villageTab"].forEach(e=>{if(game[e]&&game.ui.activeTabId!==game[e].tabId&&!game[e]._inherited){game[e].render()}});let e=()=>{let e,t,a,i;let r=new C;let l=ae.auto.faith.items;for(e in l){i=l[e];a=r.getBuild(i.name||e,i.variant);if(a){l[e].label=a.label}}let s=new S;l=ae.auto.time.items;for(e in l){i=l[e];a=s.getBuild(i.name||e,i.variant);if(a){l[e].label=a.label}}let n=new V;l=ae.auto.build.items;for(e in l){i=l[e];a=n.getBuild(i.name||e);if(a){if("stage"in i){l[e].label=a.meta.stages[i.stage].label}else{l[e].label=a.meta.label}}}let o=new q;l=ae.auto.space.items;for(t in l){a=o.getBuild(t);if(a){let e=a.title?a.title:a.label;l[t].label=e}}};e();e=null}let l=function(r){let l=[];let s=r?"#resource-reset-":"#resource-";let n=game.resPool.resources;let o=ae.auto.resources;let c=["elderBox","burnedParagon","blackcoin","gflops","hashrates","wrappingPaper","kittens","paragon","alicorn","zebras"];for(let t in n){let a=n[t];let i=a.name;let e=o[i];e=e&&e.enabled;if(!r&&(c.indexOf(a.name)>-1||e)){continue}if(i&&$(s+i).length===0){let e;if(a.type==="uncommon"){e="#FF7F50"}if(a.type==="rare"){e="#FFA500"}e=a.color||e;let t=$("<div/>",{id:"resource-add-"+i,text:U(a.title?a.title:i),css:{cursor:"pointer",color:e}});(function(e,t,a){t.on("click",function(){t.remove();if(!o[i]){o[i]={}}if(a){o[i].checkForReset=true;o[i].stockForReset=Infinity;$("#toggle-reset-list-resources").append(I(i,e.title,a))}else{o[i].enabled=true;o[i].stock=0;o[i].consume=ae.consume;$("#toggle-list-resources").append(I(i,e.title,a))}L()})})(a,t,r);l.push(t)}}return l};let h=function(a=false){let i=$("<ul/>",{id:a?"toggle-reset-list-resources":"toggle-list-resources",css:{display:"none",paddingLeft:"20px"}});let e=$("<div/>",{id:"resources-add",text:te("resources.add"),css:{cursor:"pointer",display:"inline-block",textShadow:"3px 3px 4px gray",borderBottom:"1px solid rgba(185, 185, 185, 0.7)"}});let r=$("<ul/>",{id:"available-resources-list",css:{display:"none",paddingLeft:"20px"}});(function(e,t){e.on("click",function(){r.toggle();r.empty();if(r[0].style.display!=="none"){l(t).forEach(e=>{r.append(e)})}})})(e,a);if(a){i.append(e,r)}else{i.append(e,r)}for(let t in ae.auto.resources){let e=ae.auto.resources[t];if(a&&e.checkForReset||!a&&e.enabled){i.append(I(t,undefined,a))}}return i};let b=function(e){let t=$("<ul/>",{id:"items-list-"+e,css:{display:"none",paddingLeft:"20px"}});if(e==="distribute"){return t}let a=$("<div/>",{id:"toggle-all-items-"+e,text:te("ui.disable.all"),css:{cursor:"pointer",display:"inline-block",textShadow:"3px 3px 4px gray",marginRight:"8px"}});a.on("click",function(){let e=t.children().children(":checkbox");e.prop("checked",false);e.change();t.children().children(":checkbox").change()});t.append(a);let i=$("<div/>",{id:"toggle-all-items-"+e,text:te("ui.enable.all"),css:{cursor:"pointer",display:"inline-block",textShadow:"3px 3px 4px gray"}});i.on("click",function(){let e=t.children().children(":checkbox");e.prop("checked",true);e.change();t.children().children(":checkbox").change()});t.append(i);return t};let v=function(){let e="faith-addition";let i=b(e);let r=ae.auto.faith.addition;for(let a in r){let t=y(a,r[a]);if(a==="bestUnicornBuilding"){t.children("label").prop("title",te("option.faith.best.unicorn.desc"));let e=t.children("input");e.unbind("change");e.on("change",e=>{let t=r.bestUnicornBuilding;if(e.target.checked&&!t.enabled){t.enabled=true;B("status.sub.enable",[te("option.faith.best.unicorn")]);B("option.faith.best.unicorn.desc")}else if(!e.target.checked&&t.enabled){t.enabled=false;B("status.sub.disable",[te("option.faith.best.unicorn")])}A.items[e.target.id]=t.enabled;L()})}if(r[a].subTrigger!==undefined){let e=$("<div/>",{id:"set-"+a+"-subTrigger",text:te("ui.trigger"),title:r[a].subTrigger,css:D}).data("option",r[a]);(function(t,a){if(t==="adore"){a.on("click",function(){let e;O.stop(false);e=window.prompt(te("adore.trigger.set"),r[t].subTrigger);if(ae.auto.engine.enabled){O.start(false)}if(e!==null){r[t].subTrigger=parseFloat(e);A.items[a[0].id]=r[t].subTrigger;L();a[0].title=r[t].subTrigger}})}else if(t==="autoPraise"){a.on("click",function(){let e;O.stop(false);e=window.prompt(te("praise.trigger.set",[te("option.praise")]),r[t].subTrigger);if(ae.auto.engine.enabled){O.start(false)}if(e!==null){r[t].subTrigger=parseFloat(e);A.items[a[0].id]=r[t].subTrigger;L();a[0].title=r[t].subTrigger}})}})(a,e);t.append(e)}i.append(t)}return i};let s=function(a){let e,t,i,r;let l=U(te("ui."+a));let s=ae.auto[a];let n=$("<li/>",{id:"ks-"+a});let o=$("<label/>",{for:"toggle-"+a,text:l});let c=$("<input/>",{id:"toggle-"+a,type:"checkbox"});if(s.enabled){c.prop("checked",true)}if(a!=="engine"){c.on("change",function(){if(c.is(":checked")&&!s.enabled){s.enabled=true;if(a==="filter"||a==="options"){B("status.sub.enable",[l])}else{B("status.auto.enable",[l])}L()}else if(!c.is(":checked")&&s.enabled){s.enabled=false;if(a==="filter"||a==="options"){B("status.sub.disable",[l])}else{B("status.auto.disable",[l])}L()}})}n.append(c,o);if(s.items){n.css("borderBottom","1px  solid rgba(185, 185, 185, 0.7)");i=$("<div/>",{css:{display:"inline-block",float:"right"}});r=$("<div/>",{id:"toggle-items-"+a,text:te("ui.items"),css:D});n.append(r);e=b(a);if(a==="faith"){for(t in ae.auto.unicorn.items){e.append(y(t,ae.auto.unicorn.items[t]))}}for(t in s.items){switch(a){case"trade":e.append(k(t,s.items[t]));break;case"craft":e.append(w(t,s.items[t]));break;case"timeCtrl":e.append(T(t,s.items[t]));break;case"options":e.append(E(t,s.items[t]));break;case"upgrade":e.append(x(t,s.items[t]));break;case"distribute":e.append(F(t,s.items[t]));break;case"build":case"faith":case"space":e.append(R(t,s.items[t]));break;case"time":e.append(R(t,s.items[t]));break;default:e.append(y(t,s.items[t]));break}}r.on("click",function(){e.toggle()})}if(s.trigger!==undefined){let t=$("<div/>",{id:"trigger-"+a,text:te("ui.trigger"),title:s.trigger,css:D});t.on("click",function(){let e;O.stop(false);if(a==="faith"){e=window.prompt(te("ui.trigger.set",[l+"("+$I("resources.faith.title")+")"]),s.trigger.toString())}else if(a==="trade"){e=window.prompt(te("ui.trigger.set",[l+" 的触发值\n需同时满足 种族触发资源 和 "+$I("resources.gold.title")+" 的"]),s.trigger.toString())}else{e=window.prompt(te("ui.trigger.set",[l]),s.trigger.toString())}if(ae.auto.engine.enabled){O.start(false)}if(e!==null){s.trigger=parseFloat(e);L();t[0].title=s.trigger}});n.append(t)}if(a==="craft"){const u=$("<div/>",{id:"toggle-resource-controls",text:te("ui.craft.resources"),css:D});const g=h();r.on("click",function(){g.toggle(false)});u.on("click",function(){e.toggle(false);g.toggle()});n.append(u);n.append(g)}else if(a==="faith"){const m=$("<div/>",{id:"toggle-addition-controls",text:te("ui.faith.addtion"),title:"太阳教团的自动化项目",css:D});const d=v();r.on("click",function(){d.toggle(false)});m.on("click",function(){e.toggle(false);d.toggle()});n.append(m);for(const f in ae.auto.unicorn.items){const p=e.children().children("#toggle-"+f);p.on("change",function(e){if(!$(e.target).is(":checked")){const t=$("#toggle-bestUnicornBuilding");t.prop("checked",false);t.trigger("change")}})}n.append(d)}if(s.items){n.append(i,e)}return n};let k=function(e,t){let a=U(te("$trade.race."+e));let i=y(e,t,a);i.css("borderBottom","1px solid rgba(185, 185, 185, 0.7)");let r=$("<label/>",{for:"toggle-limited-"+e,title:te("trade.limited",[a]),text:te("ui.tradeLimit")});let l=$("<input/>",{id:"toggle-limited-"+e,type:"checkbox"}).data("option",t);if(t.limited){l.prop("checked",true)}l.on("change",function(){if(l.is(":checked")&&t.limited===false){t.limited=true;B("trade.limited",[a])}else if(!l.is(":checked")&&t.limited){t.limited=false;let e=t.require?"需同时满足资源黄金和"+ie[t.require].title+"的触发条件才":"资源满足黄金的触发条件就会";B("trade.unlimited",[a,e])}A.items[l.attr("id")]=t.limited;L()});i.append(l,r);let s=$("<div/>",{id:"toggle-seasons-"+e,text:te("trade.seasons"),css:D});let n=$("<ul/>",{id:"seasons-list-"+e,css:{display:"none",paddingLeft:"20px"}});n.append(o(e,"spring",t));n.append(o(e,"summer",t));n.append(o(e,"autumn",t));n.append(o(e,"winter",t));s.on("click",function(){n.toggle()});i.append(s,n);return i};let o=function(e,t,a){let i=U(te("$trade.race."+e));let r=U(te("$calendar.season."+t));let l=$("<li/>");let s=$("<label/>",{for:"toggle-"+e+"-"+t,text:U(r)});let n=$("<input/>",{id:"toggle-"+e+"-"+t,type:"checkbox"}).data("option",a);if(a[t]){n.prop("checked",true)}n.on("change",function(){if(n.is(":checked")&&!a[t]){a[t]=true;B("trade.season.enable",[i,r])}else if(!n.is(":checked")&&a[t]){a[t]=false;B("trade.season.disable",[i,r])}A.items[n.attr("id")]=a[t];L()});l.append(n,s);return l};let c=function(e,t){let a=U(te("$calendar.season."+e));let i=$("<li/>");let r=$("<label/>",{for:"toggle-timeSkip-"+e,text:U(a)});let l=$("<input/>",{id:"toggle-timeSkip-"+e,type:"checkbox"}).data("option",t);if(t[e]){l.prop("checked",true)}l.on("change",function(){if(l.is(":checked")&&!t[e]){t[e]=true;B("time.skip.season.enable",[a])}else if(!l.is(":checked")&&t[e]){t[e]=false;B("time.skip.season.disable",[a])}A.items[l.attr("id")]=t[e];L()});i.append(l,r);return i};let y=function(e,t,a){let i=$("<li/>");let r=a||t.label||U(e);let l=t.require;l=l?game.resPool.get(t.require).title:te("ui.none");let s=te("ui.trigger.resource")+": "+l;if(t.require===undefined){s=null}let n=$("<label/>",{for:"toggle-"+e,text:r,title:s,css:{display:"inline-block",minWidth:"80px"}});let o=$("<input/>",{id:"toggle-"+e,type:"checkbox"}).data("option",t);if(t.enabled){o.prop("checked",true)}o.on("change",function(){if(o.is(":checked")&&!t.enabled){t.enabled=true;if(e.indexOf("Filter")>-1){B("filter.enable",[r])}else if(t.misc){B("status.sub.enable",[r])}else{B("status.auto.enable",[r]);if(e==="wood"){B("msg.catnip")}}}else if(!o.is(":checked")&&t.enabled){t.enabled=false;if(e.indexOf("Filter")>-1){B("filter.disable",[r])}else if(t.misc){B("status.sub.disable",[r])}else{B("status.auto.disable",[r])}}A.items[o.attr("id")]=t.enabled;if(e!=="saves"){L()}});i.append(o,n);return i};let n=function(e){let a=[];for(let t in ae.policies){let e=ae.policies[t];if(e==="authocracy"){e="autocracy"}a.push($("<div/>",{id:"policy-"+e,text:te("$policy."+e+".label"),css:{cursor:"pointer",textShadow:"3px 3px 4px gray"}}))}return a};let x=function(a,i){let r=te("ui.upgrade."+a);let l=y(a,i,r);if(a==="policies"){let i=$("<ul/>",{id:"items-list-policies",css:{display:"none",paddingLeft:"20px"}});let e=$("<a/>",{id:"toggle-upgrade-policies-wiki",text:"百科政策推荐",href:"https://petercheney.gitee.io/baike/?file=000-%E7%8C%AB%E5%9B%BD%E8%90%8C%E6%96%B0%E6%8C%87%E5%AF%BC/02-%E6%94%BF%E7%AD%96%E6%95%88%E6%9E%9C%E8%A7%A3%E6%9E%90#%E5%86%85%E4%BA%8B",target:"_blank",css:D});let t=$("<div/>",{id:"toggle-upgrade-policies-load",text:te("ui.upgrade.policies.load"),css:D});let a=$("<div/>",{id:"toggle-upgrade-policies-show",text:te("ui.upgrade.policies.show"),css:D});t.on("click",function(){const t=[];for(const a in game.science.policies){let e=game.science.policies[a];if(e.researched){t.push(e.name)}}ae.policies=t;L();i.empty();n().forEach(e=>{i.append(e)})});a.on("click",function(){i.toggle();i.empty();n().forEach(e=>{i.append(e)})});l.append(a,t,e,i)}if(i.subTrigger!==undefined&&a==="missions"){let t=$("<div/>",{id:"set-"+a+"-subTrigger",text:te("ui.trigger"),title:i.subTrigger,css:D}).data("option",i);t.on("click",function(){let e;O.stop(false);if(a==="missions"){e=window.prompt(te("ui.trigger.missions.set"),i.subTrigger.toString())}else{e=window.prompt(te("ui.trigger.set"),i.subTrigger.toString())}if(ae.auto.engine.enabled){O.start(false)}if(e!==null){i.subTrigger=parseFloat(e);A.items[t.attr("id")]=i.subTrigger;L();t[0].title=i.subTrigger}});l.append(t)}if(a==="upgrades"||a==="techs"){let e=$("<label/>",{for:"toggle-limited-"+a,text:te("ui.upgradesLimit")});let t=$("<input/>",{id:"toggle-limited-"+a,type:"checkbox"}).data("option",i);if(i.limited){t.prop("checked",true)}t.on("change",function(){if(t.is(":checked")&&!i.limited){i.limited=true;B("upgrade.limited",[r])}else if(!t.is(":checked")&&i.limited){i.limited=false;B("upgrade.unlimited",[r])}A.items[t.attr("id")]=i.limited;L()});l.append(t,e)}return l};let R=function(e,t,a){let i=$("<li/>");let r=a||t.label||U(e);let l=t.require;l=l?game.resPool.get(t.require).title:te("ui.none");let s=l;let n=$("<label/>",{for:"toggle-"+e,text:r,title:te("ui.trigger.resource")+": "+s,css:{display:"inline-block",minWidth:"80px"}});let o=$("<input/>",{id:"toggle-"+e,type:"checkbox"}).data("option",t);if(t.enabled){o.prop("checked",true)}o.on("change",function(){if(o.is(":checked")&&!t.enabled){t.enabled=true;if(e.indexOf("Filter")>-1){B("filter.enable",[r])}else if(t.misc){B("status.sub.enable",[r])}else{B("status.auto.enable",[r]);if(e==="field"){B("msg.catnip")}}}else if(!o.is(":checked")&&t.enabled){t.enabled=false;if(e.indexOf("Filter")>-1){B("filter.disable",[r])}else if(t.misc){B("status.sub.disable",[r])}else{B("status.auto.disable",[r])}}A.items[o.attr("id")]=t.enabled;L()});let c=$("<div/>",{id:"set-"+e+"-max",text:te("ui.max",[t.max]),title:t.max,css:D}).data("option",t);c.on("click",function(){let e;O.stop(false);e=window.prompt(te("ui.max.set",[t.label])+"\n -1为没有上限",t.max.toString());if(ae.auto.engine.enabled){O.start(false)}if(e!==null){t.max=parseInt(e);A.items[c.attr("id")]=t.max;L();c[0].title=t.max;c[0].innerText=te("ui.max",[t.max])}});i.append(o,n,c);return i};let w=function(e,t){let a=U(te("$resources."+e+".title"));if(e==="ship"){a=U(te("$workshop.crafts."+e+".label"))}let i=y(e,t,a);if(e==="parchment"){return i}let r=$("<label/>",{for:"toggle-limited-"+e,title:te("craft.limitedTitle"),text:te("ui.craftLimit")});let l=$("<input/>",{id:"toggle-limited-"+e,type:"checkbox"}).data("option",t);if(t.limited){l.prop("checked",true)}l.on("change",function(){if(l.is(":checked")&&!t.limited){t.limited=true;B("craft.limited",[a]);ce("craftLimited")}else if(!l.is(":checked")&&t.limited){t.limited=false;let e=t.require?ie[t.require].title+"满足触发资源的触发条件才会制作，":"无，当资源满足制作条件就会制作";B("craft.unlimited",[a,e])}A.items[l.attr("id")]=t.limited;L()});i.append(l,r);return i};let u=function(e,t){let a=game.calendar.cycles[e];let i=$("<li/>");let r=$("<label/>",{for:"toggle-timeSkip-"+e,text:a.title});let l=$("<input/>",{id:"toggle-timeSkip-"+e,type:"checkbox"}).data("option",t);if(t[e]){l.prop("checked",true)}l.on("change",function(){if(l.is(":checked")&&!t[e]){t[e]=true;B("time.skip.cycle.enable",[a.title])}else if(!l.is(":checked")&&t[e]){t[e]=false;B("time.skip.cycle.disable",[a.title])}A.items[l.attr("id")]=t[e];L()});i.append(l,r);return i};let m=function(e,t,a){let i=$("<li/>");let r=a.label;let l=$("<label/>",{for:"toggle-reset-"+t+"-"+e,text:r,css:{display:"inline-block",minWidth:"80px"}});let s=$("<input/>",{id:"toggle-reset-"+t+"-"+e,type:"checkbox"}).data("option",a);if(a.checkForReset){s.prop("checked",true)}s.on("change",function(){if(s.is(":checked")&&!a.checkForReset){a.checkForReset=true;B("status.reset.check.enable",[r])}else if(!s.is(":checked")&&a.checkForReset){a.checkForReset=false;B("status.reset.check.disable",[r])}A.items[s.attr("id")]=a.checkForReset;L()});let n=$("<div/>",{id:"set-reset-"+t+"-"+e+"-min",text:te("ui.min",[a.triggerForReset]),title:a.triggerForReset,css:D}).data("option",a);n.on("click",function(){let e;e=window.prompt(te("reset.check.trigger.set",[a.label]),a.triggerForReset.toString());if(e!==null){a.triggerForReset=parseInt(e);A.items[n.attr("id")]=a.triggerForReset;L();n[0].title=a.triggerForReset;n[0].innerText=te("ui.min",[a.triggerForReset])}});i.append(s,l,n);return i};let T=function(l,s){let n;let g=y(l,s);if(l==="timeSkip"){n=$("<div/>",{id:"set-timeSkip-subTrigger",text:te("ui.trigger"),title:s.subTrigger,css:D}).data("option",s);n.on("click",function(){let e;O.stop(false);e=window.prompt(te("time.skip.trigger.set",[]),s.subTrigger);if(ae.auto.engine.enabled){O.start(false)}if(e!==null){s.subTrigger=parseFloat(e);A.items[n.attr("id")]=s.subTrigger;L();n[0].title=s.subTrigger}});let t=$("<div/>",{id:"set-timeSkip-maximum",text:te("ui.maximum"),title:s.max,css:D}).data("option",s);t.on("click",function(){let e;O.stop(false);e=window.prompt(te("ui.max.set",["每次燃烧时间水晶"]),s.maximum.toString());if(ae.auto.engine.enabled){O.start(false)}if(e!==null){s.maximum=parseFloat(e);A.items[t.attr("id")]=s.maximum;L();t[0].title=s.maximum}});let e=$("<div/>",{id:"toggle-cycle-"+l,text:te("ui.cycles"),css:D});let a=$("<ul/>",{id:"cycles-list-"+l,css:{display:"none",paddingLeft:"20px"}});for(let e in game.calendar.cycles){a.append(u(e,s))}let i=$("<div/>",{id:"toggle-seasons-"+l,text:te("trade.seasons"),css:D});let r=$("<ul/>",{id:"seasons-list-"+l,css:{display:"none",paddingLeft:"20px"}});r.append(c("spring",s));r.append(c("summer",s));r.append(c("autumn",s));r.append(c("winter",s));e.on("click",function(){a.toggle();r.toggle(false)});i.on("click",function(){a.toggle(false);r.toggle()});g.append(e,i,t,n,a,r)}else if(l==="reset"){let e;let t=b("reset-build");let a=b("reset-space");let i=h(true);let r=b("reset-religion");let l=b("reset-time");for(e in ae.auto.build.items){t.append(m(e,"build",ae.auto.build.items[e]))}for(e in ae.auto.space.items){a.append(m(e,"space",ae.auto.space.items[e]))}for(e in ae.auto.unicorn.items){r.append(m(e,"unicorn",ae.auto.unicorn.items[e]))}for(e in ae.auto.faith.items){r.append(m(e,"faith",ae.auto.faith.items[e]))}for(e in ae.auto.time.items){l.append(m(e,"time",ae.auto.time.items[e]))}let s=$("<div/>",{id:"toggle-reset-build",text:te("ui.build"),css:{cursor:"pointer",display:"inline-block",float:"right",paddingRight:"5px",textShadow:"3px 3px 4px gray"}});let n=$("<div/>",{id:"toggle-reset-space",text:te("ui.space"),css:{cursor:"pointer",display:"inline-block",float:"right",paddingRight:"5px",textShadow:"3px 3px 4px gray"}});let o=$("<div/>",{id:"toggle-reset-resources",text:te("ui.craft.resources"),css:{cursor:"pointer",display:"inline-block",float:"right",paddingRight:"5px",textShadow:"3px 3px 4px gray"}});let c=$("<div/>",{id:"toggle-reset-religion",text:te("ui.faith"),css:{cursor:"pointer",display:"inline-block",float:"right",paddingRight:"5px",textShadow:"3px 3px 4px gray"}});let u=$("<div/>",{id:"toggle-reset-time",text:te("ui.time"),css:{cursor:"pointer",display:"inline-block",float:"right",paddingRight:"5px",textShadow:"3px 3px 4px gray"}});s.on("click",function(){t.toggle();a.toggle(false);i.toggle(false);r.toggle(false);l.toggle(false)});n.on("click",function(){t.toggle(false);a.toggle();i.toggle(false);r.toggle(false);l.toggle(false)});o.on("click",function(){t.toggle(false);a.toggle(false);i.toggle();r.toggle(false);l.toggle(false)});c.on("click",function(){t.toggle(false);a.toggle(false);i.toggle(false);r.toggle();l.toggle(false)});u.on("click",function(){t.toggle(false);a.toggle(false);i.toggle(false);r.toggle(false);l.toggle()});g.append(s,n,o,c,u,t,a,i,r,l)}else{n=$("<div/>",{id:"set-"+l+"-subTrigger",text:te("ui.trigger"),title:s.subTrigger,css:D}).data("option",s);n.on("click",function(){let e;e=window.prompt(te("ui.trigger.set",[s.label]),s.subTrigger);if(e!==null){s.subTrigger=parseFloat(e);A.items[n.attr("id")]=s.subTrigger;L();n[0].title=s.subTrigger}});g.append(n)}return g};let E=function(a,i){let r;let l=y(a,i);if(a==="style"){r=l.children("input");r.unbind("change");r.on("change",function(e){i.enabled=r.prop("checked");A.items[r.attr("id")]=i.enabled;if(e.isTrusted){L()}let t=document.getElementById("toggleCenter").style;if(i.enabled){document.body.setAttribute("data-ks-style","");game.ui.fullWidth=true;if(!game.ui.isCenter){t.display="none"}}else{document.body.removeAttribute("data-ks-style");t.display="";game.ui.fullWidth=undefined}})}if(a==="useWorkers"){r=l.children("input");r.on("click",function(){let e=confirm(te("ui.trigger.useWorkers.alert"));if(e&&!i.enabled){O.stop();i.enabled=true;A.items[r.attr("id")]=i.enabled;if(ae.auto.engine.enabled){O.start()}}else if(e&&i.enabled){O.stop();i.enabled=false;A.items[r.attr("id")]=i.enabled;if(ae.auto.engine.enabled){O.start()}}})}if(a==="saves"){r=l.children("input");r.on("click",function(){O.stop(false);let e=window.confirm("点击确认会导出珂学家的配置.txt文件");if(e){let e=$("#download-link");let t=JSON.stringify(window.localStorage["cbc.kitten-scientists"]);let a=game.compressLZData(t,false);let i=new Blob([a],{type:"text/plain"});e.attr("href",window.URL.createObjectURL(i));let r="小猫珂学家配置"+(game.stats.getStat("totalResets").val+1)+"周目";e.attr("download",r+".txt");e.get(0).dispatchEvent(new MouseEvent("click"))}if(ae.auto.engine.enabled){O.start(false)}});let e=$("<div/>",{id:"loadKS",text:"导入配置",css:D}).data("option",i);e.on("click",function(){O.stop(false);let t=window.prompt("窗口内填入后你需要导入的珂学家配置，确认后会导入配置","");if(ae.auto.engine.enabled){O.start(false)}if(t&&t.length>=10){let e;if(t.charAt(0)!=="{"){e=JSON.parse(LZString.decompressFromBase64(t))}window.localStorage["cbc.kitten-scientists"]=e;J()}});let t=$("<div/>",{id:"ressetKS",text:"恢复初始默认配置",css:{cursor:"pointer",display:"inline-block",float:"right",paddingRight:"5px",color:"#FF6347"}});t.on("click",function(){if(confirm("确定要初始化珂学家配置吗，点击确认后初始化珂学家配置(最好刷新下页面)\n为了照顾钢铁模式，默认配置小屋、木屋、宅邸默认不勾，请有需要的自行勾上")){O.stop();let e=sessionStorage.getItem("options");delete localStorage["cbc.kitten-scientists"];if(e){$("#ks-options").remove();ae.auto=JSON.parse(e).auto;W();M=$("<div/>",{id:"ks-options",css:{marginBottom:"10px"}});P=$("<ul/>");P.append(s("engine"));z.forEach(e=>{P.append(s(e))});M.append(P);p.prepend(M);Q();G()}else{game.save();window.location.reload()}}});l.append(e);l.append(t)}if(a==="donate"){r=l.children("input");r.unbind("change");r.on("change",function(e){i.enabled=r.prop("checked");A.items[r.attr("id")]=i.enabled;if(e.isTrusted){L()}let t=document.getElementById("ks-donate").style;if(i.enabled){t.display="block"}else{t.display="none"}t=null})}if(a==="wiki"){let e=$("<label/>",{css:{display:"inline-block",transformOrigin:"bottom",fontStyle:"italic",transform:"scale(0.63)"},text:"Cheney"});l.append(e);r=l.children("input");r.on("click",function(){let e=window.open();e.location="https://petercheney.gitee.io/baike/?file=004-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%B7%A5%E5%85%B7/02-%E5%B0%8F%E7%8C%AB%E7%A7%91%E5%AD%A6%E5%AE%B6";re(["如果还有问题可以在猫国群询问，有BUG或意见可以联系Cheney。初始默认配置即推荐挂机高效配置","ks-default",ae.activitycolor])})}if(i.subTrigger!==undefined){let t=$("<div/>",{id:"set-"+a+"-subTrigger",text:te("ui.trigger"),title:i.subTrigger,css:D}).data("option",i);t.on("click",function(){let e;O.stop(false);if(a==="crypto"){e=window.prompt(te("ui.trigger.crypto.set",[i.label]),i.subTrigger)}else if(a==="filterGame"){e=window.prompt(te("ui.trigger.filterGame.set"),i.subTrigger)}else{e=window.prompt(te("ui.trigger.set",[i.label]),i.subTrigger)}if(ae.auto.engine.enabled){O.start(false)}if(e!==null){if(a==="crypto"){i.subTrigger=e}else if(a==="filterGame"){i.subTrigger=parseFloat(e);ee()}else{i.subTrigger=parseFloat(e)}A.items[t.attr("id")]=i.subTrigger;L();t[0].title=i.subTrigger}});l.append(t)}return l};let F=function(e,a){if(e==="leader"){return g(e,a)}let t=U(te("$village.job."+e));let i=y(e,a,t);i.css("borderBottom","1px solid rgba(185, 185, 185, 0.7)");let r=$("<label/>",{for:"toggle-limited-"+e,text:te("ui.distributeLimit")});let l=$("<input/>",{id:"toggle-limited-"+e,type:"checkbox"}).data("option",a);if(a.limited){l.prop("checked",true)}l.on("change",function(){if(l.is(":checked")&&!a.limited){a.limited=true;B("distribute.limited",[t])}else if(!l.is(":checked")&&a.limited){a.limited=false;B("distribute.unlimited",[t])}A.items[l.attr("id")]=a.limited;L()});i.append(l,r);let s=$("<div/>",{id:"set-"+e+"-max",text:te("ui.max",[a.max]),title:a.max,css:D}).data("option",a);(function(t){s.on("click",function(){let e;O.stop(false);e=window.prompt(te("ui.max.set",[t])+" （按max比例分配）",a.max.toString());if(ae.auto.engine.enabled){O.start(false)}if(e!==null){a.max=Math.max(0,parseInt(e));A.items[s.attr("id")]=a.max;L();s[0].title=a.max;s[0].innerText=te("ui.max",[a.max])}})})(t);i.append(s);return i};let g=function(e,t){let a;let i=U(te("distribute.makeLeader"));let r=y(e,t,i);r.css("borderBottom","1px solid rgba(185, 185, 185, 0.7)");let l=$("<ul/>",{id:"items-list-traits",css:{display:"none",paddingLeft:"20px"}});let s=$("<div/>",{id:"toggle-leaderTrait"+e,text:te("$village.trait.filter.all"),css:D});for(a in window["com"]["nuclearunicorn"].game.village.Kitten().traits){l.append(f(a,t))}s.on("click",function(){n.toggle(false);l.toggle()});let n=$("<ul/>",{id:"items-list-jobs",css:{display:"none",paddingLeft:"20px"}});let o=$("<div/>",{id:"toggle-leaderJob"+e,text:te("$village.panel.job"),css:D});for(a in game.village.jobs){n.append(d(a,t))}o.on("click",function(){l.toggle(false);n.toggle()});r.append(s,o,l,n);return r};let d=function(e,t){let a=game.village.jobs;let i=a[e];let r=$("<li/>");let l=$("<label/>",{for:"toggle-leaderJob-"+i.name,text:i.title,css:{cursor:"pointer",textShadow:"3px 3px 4px gray"}});let s=$("<input/>",{id:"toggle-leaderJob-"+i.name,name:"leaderJob",value:i.name,type:"radio"}).data("option",t);if(s.prop("value")===t.leaderJob){s.prop("checked",true)}s.on("change",function(){B("distribute.leaderJob",[i.title]);t.leaderJob=$("input[name='leaderJob']:checked").val();a.forEach(e=>{delete A.items["toggle-leaderJob-"+e.name]});A.items["toggle-leaderJob-"+t.leaderJob]=true;L()});r.append(s,l);return r};let f=function(e,t){let a=window["com"]["nuclearunicorn"].game.village.Kitten().traits;const i=a[e];const r=$("<li/>");const l=$("<label/>",{for:"toggle-leaderTrait-"+i.name,text:i.title,css:{cursor:"pointer",textShadow:"3px 3px 4px gray"}});const s=$("<input/>",{id:"toggle-leaderTrait-"+i.name,name:"leaderTrait",value:i.name,type:"radio"}).data("option",t);if(s.prop("value")===t.leaderTrait){s.prop("checked",true)}s.on("change",function(){B("distribute.leaderTrait",[i.title]);t.leaderTrait=$(this).val();a.forEach(e=>{delete A.items["toggle-leaderTrait-"+e.name]});A.items["toggle-leaderTrait-"+t.leaderTrait]=true;L()});r.append(s,l);return r};let p=$("#rightColumn");let M=$("<div/>",{id:"ks-options",css:{marginBottom:"10px"}});let P=$("<ul/>");P.append(s("engine"));z.forEach(e=>{P.append(s(e))});let t=function(){const e="1HDV6VEnXH9m8PJuT4eQD7v8jRnucbneaq";let t=$("<li/>",{id:"ks-donate"}).append($("<a/>",{href:"bitcoin:"+e+"?amount=0.00048&label=Kittens Donation",target:"_blank",text:e})).prepend($('<img alt="bit" src="https://s1.ax1x.com/2022/04/30/OSmUAK.png" height="15px" />',{css:{height:"15px",width:"15px",padding:"3px 4px 0 4px",verticalAlign:"bottom"}}));t.css("padding","5px");P.append(t)};t();M.append(P);p.prepend(M)}let s=ae.auto.build.items;ae.auto.build.items=Object.assign({amphitheatre:s["amphitheatre"],reactor:s["reactor"],magneto:s["magneto"],steamworks:s["steamworks"]},s);s=null;let ce=(e,t,a)=>{if(t){ue.other["auto."+e]=null}else{if(ue.other["auto."+e]){return true}else{if(!a){a="miscFilter"}le(te("summary.auto."+e),a);ge("auto."+e)}}};let F=a=>{for(let t in a){let e=a[t];ge(e.name,e.val,"resConsume")}};let ue;let j=function(){let e=game.calendar;ue={lastYear:e.year,lastTrueYear:e.trueYear(),lastDay:e.day,lastSeason:e.season,ksTime:0,totalTicks:0,praise:[0,0],adore:[0,0],craft:{},trade:{},build:{},other:{},resGain:{},resConsume:{},research:{}}};j();let ge=function(e,t,a){if(t===undefined){t=1}if(a===undefined){a="other"}if(ue[a]===undefined){ue[a]={}}if(ue[a][e]===undefined){ue[a][e]=parseFloat(t)}else{ue[a][e]+=parseFloat(t)}};let M=function(){if(game.console.messages.length>game.console.maxMessages-250){game.clearLog()}me();let a="=".repeat(24);let e,i,r;let t=ue.resGain;for(i in t){let e=t[i];if(!e){continue}r=game.msg("小喵共获得了 "+game.getDisplayValueExt(e)+" "+$I("resources."+i+".title"),null,null,true);$(r.span).css("color","#ff589c")}if(r){game.msg(a,"notice");r=null}let l=ue.resConsume;let s=game.resPool.resources;for(let t=s.length-1;t>0;t--){if(!l){break}i=s[t].name;let e=l[i];if(!e){continue}r=game.msg("小喵共消耗了 "+game.getDisplayValueExt(e)+" "+$I("resources."+i+".title"),null,null,true);$(r.span).css("color","#DC143C")}if(r){game.msg(a,"notice")}let n=ue.other;for(const f in n){let e=n[f];if(e){e=typeof e==="number"?game.getDisplayValueExt(e):e;h("summary."+f,[e])}}P("praise");P("adore");let o=ue.research;for(i in o){e=o[i];e=e?"科学家":"";h("summary.tech",[e+"小猫研究了 "+U(i)])}for(i in ue.upgrade){e=ue.upgrade[i];e=e?"科学家":"";h("summary.upgrade",[e+"小猫发明了 "+U(i)])}let c=["faith","build","craft","craftLeader","trade"];c.forEach(t=>{let a=ue[t];for(let e in a){h("summary."+t,[game.getDisplayValueExt(a[e]),U(e)])}});let u=ue.lastYear;let g=ue.lastDay;if(u+g){let t=game.calendar;let e=t.year-u;let a=t.day-g;let i=t.trueYear()-ue.lastTrueYear;let r=t.season-ue.lastSeason;let l=t.daysPerSeason;let s=t.seasonsPerYear;a+=e*400;a+=r*l;let n="";if(a>=400){n+=e+" ";n+=e===1?te("summary.year"):te("summary.years")}if(a>=0){if(e>0){n+=te("summary.separator")}n+=k(a%400)+" ";n+=a===1?te("summary.day"):te("summary.days")}h("summary.head",[n]);if(i>0){let e=game.toDisplaySeconds(i*s*l*t.ticksPerDay/game.ticksPerSecond);if(e){p("总共 "+e+" 的小喵种田时间")}}}let m=ae.auto.filter;if(!m.enabled||!m.items["craftFilter"].enabled||!m.items["buildFilter"].enabled||game.console.filters["faith"].enabled||game.console.filters["astronomicalEvent"].enabled){game.msg("喵喵提示：游戏(珂学家)日志消耗性能会比较多!","alert")}let d=ue.ksTime;if(d){let e=ue.totalTicks;let i=Math.pow(10,2+game.opts.forceHighPrecision);let t=e=>{let t=Math.round(e*i)/i;let a=Math.round(e%1e3*i)/i;if(e>1e3){a=game.toDisplaySeconds(Math.floor(t/1e3))+a}return a};p(te("time.ks",[e,t(d),Math.round(d*i/e)/i]));p(a)}j()};let P=e=>{let t=ue[e];let a=t[0];let i=game.getDisplayValueExt(t[1]);if(a){h("summary."+e,[game.getDisplayValueExt(a),i])}};let H=$("<div/>",{id:"activity-box",css:{display:"inline-block",verticalAlign:"top"}});let N=$("<a/>",{id:"showActivityHref",text:te("summary.show"),href:"#",css:{verticalAlign:"top"}});N.on("click",M);H.append(N);$("#clearLog").append(H);const n=$("<div/>",{id:"important-msg-box",class:"dialog help",css:{display:"none",width:"auto",height:"auto"}});let K=$("<a/>",{text:te("ui.close"),href:"#",css:{position:"absolute",top:"10px",right:"15px"}});K.on("click",function(){n.toggle()});let _=$("<h1/>",{id:"mb-title",text:"test text"});let Y=$("<h1/>",{id:"mb-content",text:"test text"});n.append(K,_,Y);$("#gamePageContainer").append(n);let Z=(e,t)=>{_.html(e);Y.html(t);n.toggle()};let O=new m;let o;let Q=()=>{o=$("#toggle-engine");o.on("change",function(){let e=ae.auto.engine;if(o.is(":checked")){e.enabled=true;O.start();me();setTimeout(()=>{if(e.enabled){r("如需查看小喵做过什么，可以点击小猫总结(清空日志旁边)")}},2e3);if(game.getEffect("priceRatio")>-.03&&oe.transcendenceTier<4){ce("ksHelp",false,"noFilter");ce("ksHelp2",false,"noFilter");if(!game.stats.getStat("totalResets").val&&oe.faith>1e4){ce("ksHelp3",false,"noFilter")}ce("ksHelp4",false,"noFilter")}}else{e.enabled=false;O.stop()}});let e=$("<a/>",{css:{display:"inline-block",textShadow:"1px 1px 1px gray",transformOrigin:"bottom",fontStyle:"italic",transform:"scale(0.8)",paddingLeft:"3px"},text:c,target:"_blank",href:"https://petercheney.gitee.io/scientists/updateLog.html?v="+(new Date).getDate()});$("#ks-engine").append(e)};Q();ae.auto.cache.dataTimer["trueYear"]=game.calendar.trueYear();ae.auto.cache.dataTimer["ticksTotal"]=game.timer.ticksTotal;ae.auto.cache.dataTimer["saveId"]=game.telemetry.guid;sessionStorage.setItem("options",JSON.stringify(ae));J();let ee=()=>{game.console.maxMessages=Math.min(Math.max(300,ae.auto.options.items.filterGame.subTrigger),2e3)};ee();$("#toggle-style").trigger("change");$("#toggle-donate").trigger("change");$("#ks-donate")[0].style.display="none";if(console&&console.log){console.log(u+" loaded")}game._publish("kitten_scientists/ready",u);let me=()=>{let e=ae.auto.resources;let i;for(let a in e){let t=e[a];if(t.enabled){if(t.stock){if(a==="furs"&&t.stock===350){continue}i=true;let e=game.msg($I("resources."+a+".title")+"库存："+game.getDisplayValueExt(t.stock),null,null,true);$(e.span).css("color","#ff589c")}else if(t.consume===.6){delete ae.auto.resources[a]}}}if(i){le("小喵留下设置好的库存：");r("可爱的猫猫珂学家提示设置库存会影响挂机效率")}if(location.origin.indexOf("cheney")<0&&location.origin.indexOf("lolita")<0&&!ae.net){setTimeout(()=>{r("珂学家在Cheney的网站可以在没网的时候加载");ae.net=true},1e3)}};if(A.reset&&A.reset.reset){A.reset.karmaTotal+=ie["karma"].value-Number(A.reset.karmaLastTime);A.reset.paraonTotal+=ie["paragon"].value-Number(A.reset.paragonLastTime);A.reset.reset=false;Z(te("summary.time.reset.title",[A.reset.times]),te("summary.time.reset.content",[A.reset.karmaTotal,A.reset.paragonTotal]));o.prop("checked",true);o.trigger("change");B("reset.after")}else{A.reset={reset:false,times:0,paragonLastTime:0,paragonTotal:0,karmaLastTime:0,karmaTotal:0}}L();i18nLang.messages["time.reset.instructional"]="重启时间线将使游戏从零开始。统计和成就将会保留，也可能获得各种游戏奖励。<br><br>此时重置，重置后将会得到奖励:";const de=function(){if(!ae.auto.engine.enabled&&ae.auto.options.items.autoScientists.enabled){let e=ae.countdown;if(e===0){o.click();clearInterval(fe);B("reset.after")}else if(e>10){if(e%60===0){B("auto.tip")}if(e%10===0){se("auto.countdown",[e])}ae.countdown-=1}else if(e<=10){B("reset.countdown."+e);ae.countdown-=1}}else{clearInterval(fe)}};let fe=setInterval(de,1e3)};window.loadTest=function(){if(typeof gamePage==="undefined"||typeof i18nLang==="undefined"){setTimeout(function(){window.loadTest()},1e3)}else{let a=game.workshop.upgrades;for(let t in a){let e=a[t];game.workshop.metaCache[e.name]=e}game.workshop.metaCache["undefined"]=null;delete game.workshop.metaCache["undefined"];if(localStorage["zh.kgp.enable"]!=="disable"){$('<style id="KGPBorder">.res-table { border-spacing: 0 3px; }</style>').appendTo("head")}window.run();window.loadTest=null;window.run=null}};setTimeout(function(){window.loadTest()},1e3);